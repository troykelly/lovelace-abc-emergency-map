{"version":3,"file":"abc-emergency-map-card.js","sources":["../node_modules/.pnpm/@rollup+plugin-typescript@12.3.0_rollup@4.54.0_tslib@2.8.1_typescript@5.9.3/node_modules/tslib/tslib.es6.js","../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/css-tag.js","../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/reactive-element.js","../node_modules/.pnpm/lit-html@3.3.2/node_modules/lit-html/lit-html.js","../node_modules/.pnpm/lit-element@4.2.2/node_modules/lit-element/lit-element.js","../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/decorators/custom-element.js","../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/decorators/property.js","../node_modules/.pnpm/@lit+reactive-element@2.1.2/node_modules/@lit/reactive-element/decorators/state.js","../src/styles.ts","../src/types.ts","../src/geometry-utils.ts","../src/leaflet-loader.ts","../src/tile-providers.ts","../src/entity-markers.ts","../src/zone-renderer.ts","../src/bounds-manager.ts","../src/history-trails.ts","../src/incident-polygons.ts","../src/editor.ts","../src/abc-emergency-map-card.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=globalThis,e=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&\"adoptedStyleSheets\"in Document.prototype&&\"replace\"in CSSStyleSheet.prototype,s=Symbol(),o=new WeakMap;class n{constructor(t,e,o){if(this._$cssResult$=!0,o!==s)throw Error(\"CSSResult is not constructable. Use `unsafeCSS` or `css` instead.\");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const s=this.t;if(e&&void 0===t){const e=void 0!==s&&1===s.length;e&&(t=o.get(s)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),e&&o.set(s,t))}return t}toString(){return this.cssText}}const r=t=>new n(\"string\"==typeof t?t:t+\"\",void 0,s),i=(t,...e)=>{const o=1===t.length?t[0]:e.reduce((e,s,o)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if(\"number\"==typeof t)return t;throw Error(\"Value passed to 'css' function must be a 'css' function result: \"+t+\". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.\")})(s)+t[o+1],t[0]);return new n(o,t,s)},S=(s,o)=>{if(e)s.adoptedStyleSheets=o.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const e of o){const o=document.createElement(\"style\"),n=t.litNonce;void 0!==n&&o.setAttribute(\"nonce\",n),o.textContent=e.cssText,s.appendChild(o)}},c=e?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e=\"\";for(const s of t.cssRules)e+=s.cssText;return r(e)})(t):t;export{n as CSSResult,S as adoptStyles,i as css,c as getCompatibleStyle,e as supportsAdoptingStyleSheets,r as unsafeCSS};\n//# sourceMappingURL=css-tag.js.map\n","import{getCompatibleStyle as t,adoptStyles as s}from\"./css-tag.js\";export{CSSResult,css,supportsAdoptingStyleSheets,unsafeCSS}from\"./css-tag.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const{is:i,defineProperty:e,getOwnPropertyDescriptor:h,getOwnPropertyNames:r,getOwnPropertySymbols:o,getPrototypeOf:n}=Object,a=globalThis,c=a.trustedTypes,l=c?c.emptyScript:\"\",p=a.reactiveElementPolyfillSupport,d=(t,s)=>t,u={toAttribute(t,s){switch(s){case Boolean:t=t?l:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,s){let i=t;switch(s){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},f=(t,s)=>!i(t,s),b={attribute:!0,type:String,converter:u,reflect:!1,useDefault:!1,hasChanged:f};Symbol.metadata??=Symbol(\"metadata\"),a.litPropertyMetadata??=new WeakMap;class y extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,s=b){if(s.state&&(s.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((s=Object.create(s)).wrapped=!0),this.elementProperties.set(t,s),!s.noAccessor){const i=Symbol(),h=this.getPropertyDescriptor(t,i,s);void 0!==h&&e(this.prototype,t,h)}}static getPropertyDescriptor(t,s,i){const{get:e,set:r}=h(this.prototype,t)??{get(){return this[s]},set(t){this[s]=t}};return{get:e,set(s){const h=e?.call(this);r?.call(this,s),this.requestUpdate(t,h,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??b}static _$Ei(){if(this.hasOwnProperty(d(\"elementProperties\")))return;const t=n(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(d(\"finalized\")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(d(\"properties\"))){const t=this.properties,s=[...r(t),...o(t)];for(const i of s)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const s=litPropertyMetadata.get(t);if(void 0!==s)for(const[t,i]of s)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,s]of this.elementProperties){const i=this._$Eu(t,s);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(s){const i=[];if(Array.isArray(s)){const e=new Set(s.flat(1/0).reverse());for(const s of e)i.unshift(t(s))}else void 0!==s&&i.push(t(s));return i}static _$Eu(t,s){const i=s.attribute;return!1===i?void 0:\"string\"==typeof i?i:\"string\"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,s=this.constructor.elementProperties;for(const i of s.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return s(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,s,i){this._$AK(t,i)}_$ET(t,s){const i=this.constructor.elementProperties.get(t),e=this.constructor._$Eu(t,i);if(void 0!==e&&!0===i.reflect){const h=(void 0!==i.converter?.toAttribute?i.converter:u).toAttribute(s,i.type);this._$Em=t,null==h?this.removeAttribute(e):this.setAttribute(e,h),this._$Em=null}}_$AK(t,s){const i=this.constructor,e=i._$Eh.get(t);if(void 0!==e&&this._$Em!==e){const t=i.getPropertyOptions(e),h=\"function\"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:u;this._$Em=e;const r=h.fromAttribute(s,t.type);this[e]=r??this._$Ej?.get(e)??r,this._$Em=null}}requestUpdate(t,s,i,e=!1,h){if(void 0!==t){const r=this.constructor;if(!1===e&&(h=this[t]),i??=r.getPropertyOptions(t),!((i.hasChanged??f)(h,s)||i.useDefault&&i.reflect&&h===this._$Ej?.get(t)&&!this.hasAttribute(r._$Eu(t,i))))return;this.C(t,s,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(t,s,{useDefault:i,reflect:e,wrapped:h},r){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,r??s??this[t]),!0!==h||void 0!==r)||(this._$AL.has(t)||(this.hasUpdated||i||(s=void 0),this._$AL.set(t,s)),!0===e&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,s]of this._$Ep)this[t]=s;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[s,i]of t){const{wrapped:t}=i,e=this[s];!0!==t||this._$AL.has(s)||void 0===e||this.C(s,void 0,i,e)}}let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),this._$EO?.forEach(t=>t.hostUpdate?.()),this.update(s)):this._$EM()}catch(s){throw t=!1,this._$EM(),s}t&&this._$AE(s)}willUpdate(t){}_$AE(t){this._$EO?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(t=>this._$ET(t,this[t])),this._$EM()}updated(t){}firstUpdated(t){}}y.elementStyles=[],y.shadowRootOptions={mode:\"open\"},y[d(\"elementProperties\")]=new Map,y[d(\"finalized\")]=new Map,p?.({ReactiveElement:y}),(a.reactiveElementVersions??=[]).push(\"2.1.2\");export{y as ReactiveElement,s as adoptStyles,u as defaultConverter,t as getCompatibleStyle,f as notEqual};\n//# sourceMappingURL=reactive-element.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=globalThis,i=t=>t,s=t.trustedTypes,e=s?s.createPolicy(\"lit-html\",{createHTML:t=>t}):void 0,h=\"$lit$\",o=`lit$${Math.random().toFixed(9).slice(2)}$`,n=\"?\"+o,r=`<${n}>`,l=document,c=()=>l.createComment(\"\"),a=t=>null===t||\"object\"!=typeof t&&\"function\"!=typeof t,u=Array.isArray,d=t=>u(t)||\"function\"==typeof t?.[Symbol.iterator],f=\"[ \\t\\n\\f\\r]\",v=/<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))/g,_=/-->/g,m=/>/g,p=RegExp(`>|${f}(?:([^\\\\s\"'>=/]+)(${f}*=${f}*(?:[^ \\t\\n\\f\\r\"'\\`<>=]|(\"|')|))|$)`,\"g\"),g=/'/g,$=/\"/g,y=/^(?:script|style|textarea|title)$/i,x=t=>(i,...s)=>({_$litType$:t,strings:i,values:s}),b=x(1),w=x(2),T=x(3),E=Symbol.for(\"lit-noChange\"),A=Symbol.for(\"lit-nothing\"),C=new WeakMap,P=l.createTreeWalker(l,129);function V(t,i){if(!u(t)||!t.hasOwnProperty(\"raw\"))throw Error(\"invalid template strings array\");return void 0!==e?e.createHTML(i):i}const N=(t,i)=>{const s=t.length-1,e=[];let n,l=2===i?\"<svg>\":3===i?\"<math>\":\"\",c=v;for(let i=0;i<s;i++){const s=t[i];let a,u,d=-1,f=0;for(;f<s.length&&(c.lastIndex=f,u=c.exec(s),null!==u);)f=c.lastIndex,c===v?\"!--\"===u[1]?c=_:void 0!==u[1]?c=m:void 0!==u[2]?(y.test(u[2])&&(n=RegExp(\"</\"+u[2],\"g\")),c=p):void 0!==u[3]&&(c=p):c===p?\">\"===u[0]?(c=n??v,d=-1):void 0===u[1]?d=-2:(d=c.lastIndex-u[2].length,a=u[1],c=void 0===u[3]?p:'\"'===u[3]?$:g):c===$||c===g?c=p:c===_||c===m?c=v:(c=p,n=void 0);const x=c===p&&t[i+1].startsWith(\"/>\")?\" \":\"\";l+=c===v?s+r:d>=0?(e.push(a),s.slice(0,d)+h+s.slice(d)+o+x):s+o+(-2===d?i:x)}return[V(t,l+(t[s]||\"<?>\")+(2===i?\"</svg>\":3===i?\"</math>\":\"\")),e]};class S{constructor({strings:t,_$litType$:i},e){let r;this.parts=[];let l=0,a=0;const u=t.length-1,d=this.parts,[f,v]=N(t,i);if(this.el=S.createElement(f,e),P.currentNode=this.el.content,2===i||3===i){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(r=P.nextNode())&&d.length<u;){if(1===r.nodeType){if(r.hasAttributes())for(const t of r.getAttributeNames())if(t.endsWith(h)){const i=v[a++],s=r.getAttribute(t).split(o),e=/([.?@])?(.*)/.exec(i);d.push({type:1,index:l,name:e[2],strings:s,ctor:\".\"===e[1]?I:\"?\"===e[1]?L:\"@\"===e[1]?z:H}),r.removeAttribute(t)}else t.startsWith(o)&&(d.push({type:6,index:l}),r.removeAttribute(t));if(y.test(r.tagName)){const t=r.textContent.split(o),i=t.length-1;if(i>0){r.textContent=s?s.emptyScript:\"\";for(let s=0;s<i;s++)r.append(t[s],c()),P.nextNode(),d.push({type:2,index:++l});r.append(t[i],c())}}}else if(8===r.nodeType)if(r.data===n)d.push({type:2,index:l});else{let t=-1;for(;-1!==(t=r.data.indexOf(o,t+1));)d.push({type:7,index:l}),t+=o.length-1}l++}}static createElement(t,i){const s=l.createElement(\"template\");return s.innerHTML=t,s}}function M(t,i,s=t,e){if(i===E)return i;let h=void 0!==e?s._$Co?.[e]:s._$Cl;const o=a(i)?void 0:i._$litDirective$;return h?.constructor!==o&&(h?._$AO?.(!1),void 0===o?h=void 0:(h=new o(t),h._$AT(t,s,e)),void 0!==e?(s._$Co??=[])[e]=h:s._$Cl=h),void 0!==h&&(i=M(t,h._$AS(t,i.values),h,e)),i}class R{constructor(t,i){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:i},parts:s}=this._$AD,e=(t?.creationScope??l).importNode(i,!0);P.currentNode=e;let h=P.nextNode(),o=0,n=0,r=s[0];for(;void 0!==r;){if(o===r.index){let i;2===r.type?i=new k(h,h.nextSibling,this,t):1===r.type?i=new r.ctor(h,r.name,r.strings,this,t):6===r.type&&(i=new Z(h,this,t)),this._$AV.push(i),r=s[++n]}o!==r?.index&&(h=P.nextNode(),o++)}return P.currentNode=l,e}p(t){let i=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(t,s,i),i+=s.strings.length-2):s._$AI(t[i])),i++}}class k{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,i,s,e){this.type=2,this._$AH=A,this._$AN=void 0,this._$AA=t,this._$AB=i,this._$AM=s,this.options=e,this._$Cv=e?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const i=this._$AM;return void 0!==i&&11===t?.nodeType&&(t=i.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,i=this){t=M(this,t,i),a(t)?t===A||null==t||\"\"===t?(this._$AH!==A&&this._$AR(),this._$AH=A):t!==this._$AH&&t!==E&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):d(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==A&&a(this._$AH)?this._$AA.nextSibling.data=t:this.T(l.createTextNode(t)),this._$AH=t}$(t){const{values:i,_$litType$:s}=t,e=\"number\"==typeof s?this._$AC(t):(void 0===s.el&&(s.el=S.createElement(V(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===e)this._$AH.p(i);else{const t=new R(e,this),s=t.u(this.options);t.p(i),this.T(s),this._$AH=t}}_$AC(t){let i=C.get(t.strings);return void 0===i&&C.set(t.strings,i=new S(t)),i}k(t){u(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let s,e=0;for(const h of t)e===i.length?i.push(s=new k(this.O(c()),this.O(c()),this,this.options)):s=i[e],s._$AI(h),e++;e<i.length&&(this._$AR(s&&s._$AB.nextSibling,e),i.length=e)}_$AR(t=this._$AA.nextSibling,s){for(this._$AP?.(!1,!0,s);t!==this._$AB;){const s=i(t).nextSibling;i(t).remove(),t=s}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class H{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,i,s,e,h){this.type=1,this._$AH=A,this._$AN=void 0,this.element=t,this.name=i,this._$AM=e,this.options=h,s.length>2||\"\"!==s[0]||\"\"!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=A}_$AI(t,i=this,s,e){const h=this.strings;let o=!1;if(void 0===h)t=M(this,t,i,0),o=!a(t)||t!==this._$AH&&t!==E,o&&(this._$AH=t);else{const e=t;let n,r;for(t=h[0],n=0;n<h.length-1;n++)r=M(this,e[s+n],i,n),r===E&&(r=this._$AH[n]),o||=!a(r)||r!==this._$AH[n],r===A?t=A:t!==A&&(t+=(r??\"\")+h[n+1]),this._$AH[n]=r}o&&!e&&this.j(t)}j(t){t===A?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??\"\")}}class I extends H{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===A?void 0:t}}class L extends H{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==A)}}class z extends H{constructor(t,i,s,e,h){super(t,i,s,e,h),this.type=5}_$AI(t,i=this){if((t=M(this,t,i,0)??A)===E)return;const s=this._$AH,e=t===A&&s!==A||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,h=t!==A&&(s===A||e);e&&this.element.removeEventListener(this.name,this,s),h&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){\"function\"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class Z{constructor(t,i,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=i,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){M(this,t)}}const j={M:h,P:o,A:n,C:1,L:N,R,D:d,V:M,I:k,H,N:L,U:z,B:I,F:Z},B=t.litHtmlPolyfillSupport;B?.(S,k),(t.litHtmlVersions??=[]).push(\"3.3.2\");const D=(t,i,s)=>{const e=s?.renderBefore??i;let h=e._$litPart$;if(void 0===h){const t=s?.renderBefore??null;e._$litPart$=h=new k(i.insertBefore(c(),t),t,void 0,s??{})}return h._$AI(t),h};export{j as _$LH,b as html,T as mathml,E as noChange,A as nothing,D as render,w as svg};\n//# sourceMappingURL=lit-html.js.map\n","import{ReactiveElement as t}from\"@lit/reactive-element\";export*from\"@lit/reactive-element\";import{render as e,noChange as r}from\"lit-html\";export*from\"lit-html\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const s=globalThis;class i extends t{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=e(r,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return r}}i._$litElement$=!0,i[\"finalized\"]=!0,s.litElementHydrateSupport?.({LitElement:i});const o=s.litElementPolyfillSupport;o?.({LitElement:i});const n={_$AK:(t,e,r)=>{t._$AK(e,r)},_$AL:t=>t._$AL};(s.litElementVersions??=[]).push(\"4.2.2\");export{i as LitElement,n as _$LE};\n//# sourceMappingURL=lit-element.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=t=>(e,o)=>{void 0!==o?o.addInitializer(()=>{customElements.define(t,e)}):customElements.define(t,e)};export{t as customElement};\n//# sourceMappingURL=custom-element.js.map\n","import{notEqual as t,defaultConverter as e}from\"../reactive-element.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */const o={attribute:!0,type:String,converter:e,reflect:!1,hasChanged:t},r=(t=o,e,r)=>{const{kind:n,metadata:i}=r;let s=globalThis.litPropertyMetadata.get(i);if(void 0===s&&globalThis.litPropertyMetadata.set(i,s=new Map),\"setter\"===n&&((t=Object.create(t)).wrapped=!0),s.set(r.name,t),\"accessor\"===n){const{name:o}=r;return{set(r){const n=e.get.call(this);e.set.call(this,r),this.requestUpdate(o,n,t,!0,r)},init(e){return void 0!==e&&this.C(o,void 0,t,e),e}}}if(\"setter\"===n){const{name:o}=r;return function(r){const n=this[o];e.call(this,r),this.requestUpdate(o,n,t,!0,r)}}throw Error(\"Unsupported decorator location: \"+n)};function n(t){return(e,o)=>\"object\"==typeof o?r(t,e,o):((t,e,o)=>{const r=e.hasOwnProperty(o);return e.constructor.createProperty(o,t),r?Object.getOwnPropertyDescriptor(e,o):void 0})(t,e,o)}export{n as property,r as standardProperty};\n//# sourceMappingURL=property.js.map\n","import{property as t}from\"./property.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */function r(r){return t({...r,state:!0,attribute:!1})}export{r as state};\n//# sourceMappingURL=state.js.map\n","/**\n * Styles for ABC Emergency Map Card\n */\n\nimport { css } from \"lit\";\n\nexport const styles = css`\n  :host {\n    display: block;\n  }\n\n  ha-card {\n    height: 100%;\n    overflow: hidden;\n    /* Theme-aware CSS custom properties for consistent styling */\n    --map-shadow-color: rgba(0, 0, 0, 0.15);\n    --map-border-color: var(--divider-color, rgba(0, 0, 0, 0.12));\n  }\n\n  /* Dark theme adjustments */\n  ha-card.theme-dark {\n    --map-shadow-color: rgba(0, 0, 0, 0.4);\n    --map-border-color: var(--divider-color, rgba(255, 255, 255, 0.12));\n  }\n\n  /* Light theme explicit styling (for clarity) */\n  ha-card.theme-light {\n    --map-shadow-color: rgba(0, 0, 0, 0.15);\n    --map-border-color: var(--divider-color, rgba(0, 0, 0, 0.12));\n  }\n\n  .card-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 16px 16px 0;\n    font-size: 1.2em;\n    font-weight: 500;\n  }\n\n  .header-title {\n    flex: 1;\n  }\n\n  /* Incident count badge */\n  .incident-badge {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 4px 10px;\n    border-radius: 16px;\n    color: #ffffff;\n    font-size: 13px;\n    font-weight: 600;\n    white-space: nowrap;\n  }\n\n  .incident-badge ha-icon {\n    --mdc-icon-size: 16px;\n  }\n\n  .badge-count {\n    font-weight: 700;\n  }\n\n  .badge-new {\n    font-size: 11px;\n    font-weight: 400;\n    opacity: 0.9;\n    margin-left: 4px;\n    padding-left: 6px;\n    border-left: 1px solid rgba(255, 255, 255, 0.3);\n  }\n\n  .map-wrapper {\n    position: relative;\n    width: 100%;\n    height: 400px;\n  }\n\n  .map-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    height: 100%;\n    width: 100%;\n  }\n\n  /* Ensure Leaflet container fills the map-container */\n  .map-container .leaflet-container {\n    height: 100% !important;\n    width: 100% !important;\n    border-radius: 0 0 var(--ha-card-border-radius, 12px)\n      var(--ha-card-border-radius, 12px);\n  }\n\n  /* Loading state */\n  .loading-container {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    height: 400px;\n    gap: 16px;\n    color: var(--primary-text-color, #333);\n  }\n\n  .loading-text {\n    font-size: 14px;\n    opacity: 0.7;\n  }\n\n  /* Error state */\n  .error-container {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    height: 400px;\n    gap: 16px;\n    color: var(--error-color, #cc0000);\n    padding: 16px;\n    text-align: center;\n  }\n\n  .error-container ha-icon {\n    --mdc-icon-size: 48px;\n  }\n\n  .error-text {\n    font-size: 14px;\n    max-width: 300px;\n  }\n\n  /* Australian Warning System legend */\n  .legend {\n    background: var(--card-background-color, white);\n    padding: 8px;\n    border-radius: 4px;\n    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);\n  }\n\n  .legend-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin: 4px 0;\n    font-size: 12px;\n  }\n\n  .legend-color {\n    width: 16px;\n    height: 16px;\n    border-radius: 2px;\n  }\n\n  /* Leaflet controls styling to match HA theme */\n  .leaflet-control-zoom a {\n    background: var(--card-background-color, white) !important;\n    color: var(--primary-text-color, #333) !important;\n  }\n\n  .leaflet-control-zoom a:hover {\n    background: var(--secondary-background-color, #f5f5f5) !important;\n  }\n\n  .leaflet-control-attribution {\n    background: var(--card-background-color, rgba(255, 255, 255, 0.8)) !important;\n    color: var(--secondary-text-color, #666) !important;\n    font-size: 10px;\n  }\n\n  .leaflet-control-attribution a {\n    color: var(--primary-color, #03a9f4) !important;\n  }\n\n  /* Entity marker styles */\n  .entity-marker {\n    background: transparent;\n    border: none;\n  }\n\n  .entity-marker > div {\n    transition: transform 0.2s ease;\n  }\n\n  .entity-marker:hover > div {\n    transform: scale(1.1);\n  }\n\n  /* Hidden state for markers (zoom-based visibility) */\n  .entity-marker.zoom-hidden {\n    opacity: 0 !important;\n    pointer-events: none !important;\n    transition: opacity 0.2s ease;\n  }\n\n  .entity-marker:not(.zoom-hidden) {\n    opacity: 1;\n    transition: opacity 0.2s ease;\n  }\n\n  .entity-popup {\n    font-size: 13px;\n    line-height: 1.4;\n  }\n\n  .entity-popup-title {\n    margin: 0 0 4px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--primary-text-color, #333);\n  }\n\n  .entity-popup-id {\n    display: block;\n    margin-bottom: 8px;\n    color: var(--secondary-text-color, #666);\n  }\n\n  .entity-popup-details {\n    margin: 0;\n    display: grid;\n    grid-template-columns: auto 1fr;\n    gap: 4px 8px;\n  }\n\n  .entity-popup-details dt {\n    font-weight: 500;\n    color: var(--secondary-text-color, #666);\n  }\n\n  .entity-popup-details dd {\n    margin: 0;\n    color: var(--primary-text-color, #333);\n  }\n\n  .entity-popup strong {\n    color: var(--primary-text-color, #333);\n  }\n\n  .entity-popup small {\n    color: var(--secondary-text-color, #666);\n  }\n\n  /* Leaflet popup styling to match HA theme */\n  .leaflet-popup-content-wrapper {\n    background: var(--card-background-color, white);\n    color: var(--primary-text-color, #333);\n    border-radius: 8px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n  }\n\n  .leaflet-popup-tip {\n    background: var(--card-background-color, white);\n  }\n\n  /* Leaflet tooltip styling */\n  .leaflet-tooltip {\n    background: var(--card-background-color, white);\n    color: var(--primary-text-color, #333);\n    border: none;\n    border-radius: 4px;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n    padding: 4px 8px;\n    font-size: 12px;\n  }\n\n  .leaflet-tooltip-top:before {\n    border-top-color: var(--card-background-color, white);\n  }\n\n  /* Zone popup styles */\n  .zone-popup {\n    font-size: 13px;\n    line-height: 1.4;\n  }\n\n  .zone-popup strong {\n    color: var(--primary-text-color, #333);\n  }\n\n  .zone-popup small {\n    color: var(--secondary-text-color, #666);\n  }\n\n  .zone-popup em {\n    color: var(--secondary-text-color, #888);\n    font-style: italic;\n  }\n\n  /* Fit to entities control button */\n  .fit-control {\n    margin-top: 10px;\n  }\n\n  .fit-control-button {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 30px;\n    height: 30px;\n    background: var(--card-background-color, white) !important;\n    color: var(--primary-text-color, #333) !important;\n    text-decoration: none;\n    cursor: pointer;\n  }\n\n  .fit-control-button:hover {\n    background: var(--secondary-background-color, #f5f5f5) !important;\n  }\n\n  .fit-control-button ha-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  /* Incident popup styles */\n  .incident-popup {\n    font-size: 13px;\n    line-height: 1.5;\n    min-width: 180px;\n    max-width: 300px;\n  }\n\n  .incident-popup-header {\n    margin-bottom: 8px;\n    padding-bottom: 6px;\n    border-bottom: 1px solid var(--divider-color, #e0e0e0);\n  }\n\n  .incident-popup-header strong,\n  .incident-popup-title {\n    margin: 0;\n    color: var(--primary-text-color, #333);\n    font-size: 14px;\n    font-weight: 600;\n    word-wrap: break-word;\n  }\n\n  .incident-popup-body {\n    color: var(--secondary-text-color, #666);\n  }\n\n  .incident-alert-badge {\n    display: inline-block;\n    padding: 3px 8px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    margin-bottom: 8px;\n  }\n\n  .incident-popup-row {\n    margin: 4px 0;\n    font-size: 12px;\n  }\n\n  .incident-popup-label {\n    color: var(--secondary-text-color, #888);\n    margin-right: 4px;\n  }\n\n  .incident-popup-advice {\n    margin: 8px 0;\n    padding: 8px;\n    background: var(--secondary-background-color, #f5f5f5);\n    border-radius: 4px;\n    font-size: 12px;\n    line-height: 1.4;\n    max-height: 100px;\n    overflow-y: auto;\n  }\n\n  .incident-popup-link {\n    margin-top: 8px;\n    padding-top: 8px;\n    border-top: 1px solid var(--divider-color, #e0e0e0);\n  }\n\n  .incident-popup-link a {\n    color: var(--primary-color, #03a9f4);\n    text-decoration: none;\n    font-size: 12px;\n    font-weight: 500;\n  }\n\n  .incident-popup-link a:hover {\n    text-decoration: underline;\n  }\n\n  /* Responsive popup container */\n  .incident-popup-container .leaflet-popup-content {\n    margin: 12px;\n  }\n\n  .incident-popup-container .leaflet-popup-content-wrapper {\n    padding: 0;\n  }\n\n  /* Incident animation keyframes */\n  @keyframes incident-appear {\n    0% {\n      opacity: 0;\n      filter: drop-shadow(0 0 0 transparent);\n    }\n    30% {\n      opacity: 1;\n      filter: drop-shadow(0 0 12px var(--incident-glow-color, rgba(255, 102, 0, 0.8)));\n    }\n    100% {\n      opacity: 1;\n      filter: drop-shadow(0 0 0 transparent);\n    }\n  }\n\n  @keyframes incident-pulse {\n    0%, 100% {\n      filter: drop-shadow(0 0 0 transparent);\n    }\n    25% {\n      filter: drop-shadow(0 0 8px var(--incident-glow-color, rgba(255, 102, 0, 0.8)));\n    }\n    50% {\n      filter: drop-shadow(0 0 0 transparent);\n    }\n    75% {\n      filter: drop-shadow(0 0 8px var(--incident-glow-color, rgba(255, 102, 0, 0.8)));\n    }\n  }\n\n  @keyframes incident-glow-extreme {\n    0%, 100% {\n      filter: drop-shadow(0 0 4px rgba(204, 0, 0, 0.6));\n    }\n    50% {\n      filter: drop-shadow(0 0 12px rgba(204, 0, 0, 0.9));\n    }\n  }\n\n  /* Incident animation classes */\n  .incident-layer-new {\n    animation: incident-appear var(--incident-animation-duration, 2s) ease-out forwards;\n  }\n\n  .incident-layer-updated {\n    animation: incident-pulse var(--incident-animation-duration, 2s) ease-in-out;\n  }\n\n  .incident-layer-extreme {\n    animation: incident-glow-extreme 2s ease-in-out infinite;\n  }\n\n  /* Respect prefers-reduced-motion */\n  @media (prefers-reduced-motion: reduce) {\n    .incident-layer-new,\n    .incident-layer-updated,\n    .incident-layer-extreme {\n      animation: none !important;\n    }\n  }\n\n  /* Animation disabled via config */\n  .animations-disabled .incident-layer-new,\n  .animations-disabled .incident-layer-updated,\n  .animations-disabled .incident-layer-extreme {\n    animation: none !important;\n  }\n\n  /* ============================================\n   * RESPONSIVE DESIGN\n   * ============================================ */\n\n  /* Responsive map height based on container size */\n  @media (max-height: 500px) {\n    .map-wrapper,\n    .loading-container,\n    .error-container {\n      height: 250px;\n    }\n  }\n\n  @media (min-height: 501px) and (max-height: 700px) {\n    .map-wrapper,\n    .loading-container,\n    .error-container {\n      height: 350px;\n    }\n  }\n\n  @media (min-height: 701px) {\n    .map-wrapper,\n    .loading-container,\n    .error-container {\n      height: 400px;\n    }\n  }\n\n  /* Mobile-specific adjustments */\n  @media (max-width: 480px) {\n    .card-header {\n      padding: 12px 12px 0;\n      font-size: 1em;\n    }\n\n    .incident-badge {\n      padding: 3px 8px;\n      font-size: 12px;\n    }\n\n    .badge-new {\n      display: none; /* Hide \"new\" indicator on very small screens */\n    }\n\n    .incident-popup {\n      min-width: 150px;\n      max-width: 250px;\n    }\n\n    .incident-popup-advice {\n      max-height: 80px;\n    }\n  }\n\n  /* Tablet adjustments */\n  @media (min-width: 481px) and (max-width: 768px) {\n    .card-header {\n      padding: 14px 14px 0;\n    }\n  }\n\n  /* ============================================\n   * ACCESSIBILITY - FOCUS INDICATORS\n   * ============================================ */\n\n  /* Global focus visible style for keyboard navigation */\n  *:focus-visible {\n    outline: 2px solid var(--primary-color, #03a9f4);\n    outline-offset: 2px;\n  }\n\n  /* Leaflet control focus styles */\n  .leaflet-control-zoom a:focus-visible {\n    outline: 2px solid var(--primary-color, #03a9f4) !important;\n    outline-offset: -2px;\n  }\n\n  .fit-control-button:focus-visible {\n    outline: 2px solid var(--primary-color, #03a9f4) !important;\n    outline-offset: -2px;\n  }\n\n  /* Popup close button focus */\n  .leaflet-popup-close-button:focus-visible {\n    outline: 2px solid var(--primary-color, #03a9f4) !important;\n    outline-offset: 2px;\n  }\n\n  /* Link focus within popups */\n  .incident-popup-link a:focus-visible {\n    outline: 2px solid var(--primary-color, #03a9f4);\n    outline-offset: 2px;\n  }\n\n  /* ============================================\n   * ACCESSIBILITY - TOUCH TARGETS (WCAG 2.1 AA)\n   * ============================================ */\n\n  /* Ensure minimum 44x44px touch targets for mobile */\n  @media (pointer: coarse) {\n    .leaflet-control-zoom a {\n      width: 44px !important;\n      height: 44px !important;\n      line-height: 44px !important;\n      font-size: 22px !important;\n    }\n\n    .fit-control-button {\n      width: 44px !important;\n      height: 44px !important;\n    }\n\n    .leaflet-popup-close-button {\n      width: 44px !important;\n      height: 44px !important;\n      font-size: 24px !important;\n      padding: 0 !important;\n      right: 0 !important;\n      top: 0 !important;\n    }\n  }\n\n  /* ============================================\n   * ACCESSIBILITY - HIGH CONTRAST MODE\n   * ============================================ */\n\n  @media (prefers-contrast: more) {\n    ha-card {\n      border: 2px solid var(--primary-text-color, #000) !important;\n    }\n\n    .card-header {\n      border-bottom: 2px solid var(--divider-color, #000);\n    }\n\n    .incident-badge {\n      border: 2px solid currentColor;\n    }\n\n    .leaflet-control-zoom a {\n      border: 2px solid var(--primary-text-color, #000) !important;\n    }\n\n    .fit-control-button {\n      border: 2px solid var(--primary-text-color, #000) !important;\n    }\n\n    /* Increase popup contrast */\n    .leaflet-popup-content-wrapper {\n      border: 2px solid var(--primary-text-color, #000);\n    }\n\n    /* Stronger focus indicators */\n    *:focus-visible {\n      outline-width: 3px;\n    }\n  }\n\n  /* ============================================\n   * ACCESSIBILITY - SCREEN READER UTILITIES\n   * ============================================ */\n\n  /* Visually hidden but accessible to screen readers */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border: 0;\n  }\n\n  /* Live region for announcements */\n  .sr-live-region {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border: 0;\n  }\n\n  /* Skip link for keyboard navigation */\n  .skip-link {\n    position: absolute;\n    top: -40px;\n    left: 0;\n    background: var(--primary-color, #03a9f4);\n    color: white;\n    padding: 8px 16px;\n    z-index: 10000;\n    text-decoration: none;\n    font-weight: 500;\n    border-radius: 0 0 4px 0;\n    transition: top 0.2s ease;\n  }\n\n  .skip-link:focus {\n    top: 0;\n  }\n`;\n\n","/**\n * Type definitions for ABC Emergency Map Card\n */\n\nimport type { LovelaceCardConfig } from \"custom-card-helpers\";\n\n/**\n * Supported tile provider identifiers.\n * - osm: OpenStreetMap (default, no API key required)\n * - cartodb: CartoDB/Carto tiles (light/dark variants available)\n * - mapbox: Mapbox tiles (requires API key)\n * - custom: User-provided tile URL template\n */\nexport type TileProviderId = \"osm\" | \"cartodb\" | \"mapbox\" | \"custom\";\n\n/**\n * Configuration for a tile provider.\n */\nexport interface TileProviderConfig {\n  /** URL template with {s}, {z}, {x}, {y} placeholders */\n  url: string;\n  /** Attribution HTML string */\n  attribution: string;\n  /** Maximum zoom level supported */\n  maxZoom: number;\n  /** Subdomains for load balancing (e.g., ['a', 'b', 'c']) */\n  subdomains?: string | string[];\n  /** Optional API key placeholder in URL */\n  accessToken?: string;\n}\n\n/**\n * A tile provider preset with optional dark mode variant.\n */\nexport interface TileProviderPreset {\n  /** Light mode tile configuration */\n  light: TileProviderConfig;\n  /** Dark mode tile configuration (falls back to light if not provided) */\n  dark?: TileProviderConfig;\n  /** Whether this provider requires an API key */\n  requiresApiKey: boolean;\n  /** Human-readable name for the provider */\n  name: string;\n}\n\n/**\n * Dark mode setting options.\n * - \"auto\": Follows Home Assistant theme setting\n * - \"light\": Always use light mode tiles and UI\n * - \"dark\": Always use dark mode tiles and UI\n * - boolean: Legacy support (true = dark, false = light)\n */\nexport type DarkModeSetting = \"auto\" | \"light\" | \"dark\" | boolean;\n\n/** Default dark mode setting */\nexport const DEFAULT_DARK_MODE: DarkModeSetting = \"auto\";\n\n/**\n * Card configuration for ABC Emergency Map.\n *\n * ## Visibility Configuration Hierarchy\n *\n * The following options control incident visibility. They are applied in priority order:\n *\n * 1. **show_warning_levels** (boolean) - Master toggle for polygon rendering\n *    - When `false`: No polygons rendered, all incidents show as markers only\n *    - When `true` (default): Polygon rendering enabled\n *\n * 2. **hide_markers_for_polygons** (boolean) - Controls marker visibility for polygon entities\n *    - When `true` (default): Incidents with polygons only show the polygon, no marker\n *    - When `false`: Both polygon and marker are displayed\n *    - Has no effect if show_warning_levels is false\n *\n * ## Common Pitfalls\n *\n * - Setting `show_warning_levels: false` with `hide_markers_for_polygons: true` is redundant\n *   since polygons won't render anyway (a validation warning is shown)\n */\nexport interface ABCEmergencyMapCardConfig extends LovelaceCardConfig {\n  type: \"custom:abc-emergency-map-card\";\n  title?: string;\n  entity?: string;\n  entities?: string[];\n  default_zoom?: number;\n  hours_to_show?: number;\n  dark_mode?: DarkModeSetting;\n  /**\n   * Master toggle for polygon/warning level rendering.\n   * When false, all incidents render as markers only.\n   * @default true\n   */\n  show_warning_levels?: boolean;\n  /**\n   * Whether to hide point markers for incidents that have polygon boundaries.\n   * When true (default), incidents with polygon data only show the polygon.\n   * When false, both the polygon and a point marker are displayed.\n   * Point-only geometry always renders as a marker regardless of this setting.\n   *\n   * Note: Has no effect when show_warning_levels is false.\n   * @default true\n   */\n  hide_markers_for_polygons?: boolean;\n  /**\n   * Minimum zoom level at which markers are visible.\n   * Markers are hidden when zoom level is below this value.\n   * When undefined, markers are always visible (subject to other visibility settings).\n   * Valid range: 1-20\n   * @example marker_min_zoom: 12 // Show markers only when zoomed in close\n   */\n  marker_min_zoom?: number;\n  /**\n   * Size threshold in meters for hiding markers based on polygon size.\n   * Markers are hidden for polygons smaller than this extent.\n   * Large polygons (weather warnings) benefit from centroid markers,\n   * while small polygons (bushfire perimeters) are obscured by markers.\n   * When undefined, all polygon sizes use the same visibility logic.\n   * @example marker_polygon_threshold: 5000 // Hide markers for polygons < 5km extent\n   */\n  marker_polygon_threshold?: number;\n  /** Tile provider identifier or 'custom' for custom URL */\n  tile_provider?: TileProviderId;\n  /** Custom tile URL template (required when tile_provider is 'custom') */\n  tile_url?: string;\n  /** Custom tile attribution (for custom provider) */\n  tile_attribution?: string;\n  /** API key for providers that require authentication (e.g., Mapbox) */\n  api_key?: string;\n  /** Whether to show Home Assistant zones on the map (default: true) */\n  show_zones?: boolean;\n  /** Default zone fill color (default: #4285f4) */\n  zone_color?: string;\n  /** Zone fill opacity 0-1 (default: 0.2) */\n  zone_opacity?: number;\n  /** Zone border opacity 0-1 (default: 0.5) */\n  zone_border_opacity?: number;\n  /** Whether to auto-fit bounds to show all entities/zones on load (default: true) */\n  auto_fit?: boolean;\n  /** Padding for fit bounds in pixels [vertical, horizontal] or single value (default: 50) */\n  fit_padding?: number | [number, number];\n  /** Maximum zoom level when auto-fitting bounds (default: 17) */\n  fit_max_zoom?: number;\n  /** Whether to show history trails for entities (default: false) */\n  show_history?: boolean;\n  /** Specific entities to show history for (defaults to all configured entities) */\n  history_entities?: string[];\n  /** Trail line weight in pixels (default: 3) */\n  history_line_weight?: number;\n  /** Whether to enable incident animations (default: true) */\n  animations_enabled?: boolean;\n  /** Duration of pulse animation in milliseconds (default: 2000) */\n  animation_duration?: number;\n  /** Whether to enable smooth geometry transitions (default: true) */\n  geometry_transitions?: boolean;\n  /** Duration of geometry transition in milliseconds (default: 500) */\n  transition_duration?: number;\n  /** Whether to show incident count badge (default: true) */\n  show_badge?: boolean;\n  /** Whether to show new incident indicators (default: true) */\n  show_new_indicator?: boolean;\n  /** Badge position (default: \"top-right\") */\n  badge_position?: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\";\n  /**\n   * Dynamic geo_location entity sources.\n   * Configure sensor or binary_sensor entities that expose `entity_ids` or\n   * `containing_entity_ids` attributes listing geo_location entity IDs.\n   * These entities will be dynamically discovered and rendered on the map.\n   *\n   * Example sources:\n   * - sensor.abc_emergency_*_incidents_total (all incidents)\n   * - sensor.abc_emergency_*_bushfires (bushfire incidents)\n   * - sensor.abc_emergency_*_watch_and_acts (watch and act level incidents)\n   * - binary_sensor.abc_emergency_*_inside_polygon (incidents containing location)\n   */\n  geo_location_sources?: string[];\n  /**\n   * Color preset for alert levels.\n   * Built-in options: \"australian\" (default), \"us_nws\", \"eu_meteo\", \"high_contrast\"\n   */\n  alert_color_preset?: AlertColorPreset;\n  /**\n   * Custom alert level colors. Overrides preset colors for specified levels.\n   * Partial configuration is allowed - unspecified levels use preset/default colors.\n   *\n   * Example:\n   * ```yaml\n   * alert_colors:\n   *   extreme: \"#ff0000\"\n   *   severe: \"#ff8800\"\n   * ```\n   */\n  alert_colors?: AlertColorsConfig;\n}\n\nexport interface EmergencyIncident {\n  id: string;\n  headline: string;\n  latitude: number;\n  longitude: number;\n  alert_level: \"extreme\" | \"severe\" | \"moderate\" | \"minor\";\n  alert_text: string;\n  event_type: string;\n  has_polygon: boolean;\n  geometry_type?: string;\n  /** Last updated timestamp from entity */\n  last_updated?: string;\n  /** External URL for more information */\n  external_link?: string;\n}\n\n/**\n * Supported entity domains for map markers.\n */\nexport type MarkerEntityDomain = \"device_tracker\" | \"person\" | \"geo_location\";\n\n/**\n * Entity data extracted for marker display.\n */\nexport interface EntityMarkerData {\n  /** Entity ID (e.g., \"person.john\") */\n  entityId: string;\n  /** Entity domain */\n  domain: MarkerEntityDomain;\n  /** Display name */\n  name: string;\n  /** Latitude coordinate */\n  latitude: number;\n  /** Longitude coordinate */\n  longitude: number;\n  /** Entity picture URL (if available) */\n  picture?: string;\n  /** Entity state (e.g., \"home\", \"not_home\", \"travelling\") */\n  state: string;\n  /** GPS accuracy in meters (if available) */\n  gpsAccuracy?: number;\n  /** Battery level percentage (if available) */\n  battery?: number;\n  /** Last updated timestamp */\n  lastUpdated?: string;\n}\n\n/**\n * Default icons for each entity domain.\n */\nexport const DOMAIN_ICONS: Record<MarkerEntityDomain, string> = {\n  device_tracker: \"mdi:cellphone\",\n  person: \"mdi:account\",\n  geo_location: \"mdi:map-marker\",\n};\n\n/**\n * Marker colors by entity domain.\n */\nexport const DOMAIN_COLORS: Record<MarkerEntityDomain, string> = {\n  device_tracker: \"#4CAF50\", // Green\n  person: \"#2196F3\", // Blue\n  geo_location: \"#FF9800\", // Orange\n};\n\n/**\n * Valid alert level names.\n */\nexport type AlertLevel = \"extreme\" | \"severe\" | \"moderate\" | \"minor\";\n\n/**\n * Map of alert levels to color strings.\n */\nexport type AlertLevelColors = {\n  [K in AlertLevel]: string;\n};\n\n/**\n * Partial alert colors for user configuration (allows overriding individual levels).\n */\nexport type AlertColorsConfig = Partial<AlertLevelColors>;\n\n/**\n * Available color preset identifiers.\n * - australian: Default Australian Warning System (red/orange/yellow/blue)\n * - us_nws: US National Weather Service style (red/orange/yellow/cyan)\n * - eu_meteo: European Meteorological style (red/orange/yellow/green)\n * - high_contrast: Accessibility-focused darker variants\n */\nexport type AlertColorPreset = \"australian\" | \"us_nws\" | \"eu_meteo\" | \"high_contrast\";\n\n/**\n * Default alert colors (Australian Warning System).\n */\nexport const ALERT_COLORS: AlertLevelColors = {\n  extreme: \"#cc0000\", // Emergency Warning - Red\n  severe: \"#ff6600\", // Watch and Act - Orange\n  moderate: \"#ffcc00\", // Advice - Yellow\n  minor: \"#3366cc\", // Information - Blue\n};\n\n/**\n * Built-in color presets for different regions/use cases.\n */\nexport const ALERT_COLOR_PRESETS: Record<AlertColorPreset, AlertLevelColors> = {\n  /** Australian Warning System (default) */\n  australian: {\n    extreme: \"#cc0000\", // Emergency Warning - Red\n    severe: \"#ff6600\", // Watch and Act - Orange\n    moderate: \"#ffcc00\", // Advice - Yellow\n    minor: \"#3366cc\", // Information - Blue\n  },\n  /** US National Weather Service inspired */\n  us_nws: {\n    extreme: \"#cc0000\", // Warning - Red\n    severe: \"#ff6600\", // Watch - Orange\n    moderate: \"#ffcc00\", // Advisory - Yellow\n    minor: \"#00bfff\", // Statement - Cyan\n  },\n  /** European Meteorological services inspired */\n  eu_meteo: {\n    extreme: \"#cc0000\", // Red alert\n    severe: \"#ff6600\", // Orange alert\n    moderate: \"#ffcc00\", // Yellow alert\n    minor: \"#33cc33\", // Green alert\n  },\n  /** High contrast for accessibility */\n  high_contrast: {\n    extreme: \"#990000\", // Darker red\n    severe: \"#cc5500\", // Darker orange\n    moderate: \"#ccaa00\", // Darker yellow\n    minor: \"#003399\", // Darker blue\n  },\n};\n\n/** Default alert color preset */\nexport const DEFAULT_ALERT_COLOR_PRESET: AlertColorPreset = \"australian\";\n\n/**\n * Resolves the color for a given alert level based on configuration.\n * Priority: config.alert_colors[level]  preset colors  default colors\n *\n * @param level - The alert level to get color for\n * @param config - Card configuration (optional)\n * @returns The resolved color string\n */\nexport function getAlertColor(\n  level: string,\n  config?: { alert_colors?: AlertColorsConfig; alert_color_preset?: AlertColorPreset }\n): string {\n  // Normalize level to valid AlertLevel\n  const normalizedLevel = ([\"extreme\", \"severe\", \"moderate\", \"minor\"].includes(level)\n    ? level\n    : \"minor\") as AlertLevel;\n\n  // Check for custom color override first\n  if (config?.alert_colors?.[normalizedLevel]) {\n    return config.alert_colors[normalizedLevel]!;\n  }\n\n  // Check for preset\n  if (config?.alert_color_preset && ALERT_COLOR_PRESETS[config.alert_color_preset]) {\n    return ALERT_COLOR_PRESETS[config.alert_color_preset][normalizedLevel];\n  }\n\n  // Fall back to default (Australian) colors\n  return ALERT_COLORS[normalizedLevel];\n}\n\n/**\n * Zone data extracted from Home Assistant zone entities.\n */\nexport interface ZoneData {\n  /** Entity ID (e.g., \"zone.home\") */\n  entityId: string;\n  /** Zone display name */\n  name: string;\n  /** Center latitude */\n  latitude: number;\n  /** Center longitude */\n  longitude: number;\n  /** Zone radius in meters */\n  radius: number;\n  /** Whether this is a passive zone (doesn't trigger automations) */\n  passive: boolean;\n  /** Zone icon (e.g., \"mdi:home\") */\n  icon?: string;\n}\n\n/** Default zone color (Google Blue) */\nexport const DEFAULT_ZONE_COLOR = \"#4285f4\";\n\n/** Default zone fill opacity */\nexport const DEFAULT_ZONE_OPACITY = 0.2;\n\n/** Default zone border opacity */\nexport const DEFAULT_ZONE_BORDER_OPACITY = 0.5;\n\n/** Default auto-fit enabled */\nexport const DEFAULT_AUTO_FIT = true;\n\n/** Default fit bounds padding in pixels */\nexport const DEFAULT_FIT_PADDING = 50;\n\n/** Default maximum zoom level when auto-fitting */\nexport const DEFAULT_FIT_MAX_ZOOM = 17;\n\n/** Default show history setting */\nexport const DEFAULT_SHOW_HISTORY = false;\n\n/** Default history line weight in pixels */\nexport const DEFAULT_HISTORY_LINE_WEIGHT = 3;\n\n/** Default hours to show for history trails */\nexport const DEFAULT_HOURS_TO_SHOW = 24;\n\n/** Default animations enabled setting */\nexport const DEFAULT_ANIMATIONS_ENABLED = true;\n\n/** Default animation duration in milliseconds */\nexport const DEFAULT_ANIMATION_DURATION = 2000;\n\n/** Default geometry transitions enabled */\nexport const DEFAULT_GEOMETRY_TRANSITIONS = true;\n\n/** Default geometry transition duration in milliseconds */\nexport const DEFAULT_TRANSITION_DURATION = 500;\n\n/** Default show badge setting */\nexport const DEFAULT_SHOW_BADGE = true;\n\n/** Default show new indicator setting */\nexport const DEFAULT_SHOW_NEW_INDICATOR = true;\n\n/** Default hide markers for polygons setting */\nexport const DEFAULT_HIDE_MARKERS_FOR_POLYGONS = true;\n\n/** Default badge position */\nexport const DEFAULT_BADGE_POSITION = \"top-right\";\n\n/** Duration in ms for an incident to be considered \"new\" */\nexport const NEW_INCIDENT_THRESHOLD_MS = 5 * 60 * 1000; // 5 minutes\n\n/**\n * A single history point with timestamp and coordinates.\n */\nexport interface HistoryPoint {\n  /** Timestamp of the history point */\n  timestamp: Date;\n  /** Latitude coordinate */\n  latitude: number;\n  /** Longitude coordinate */\n  longitude: number;\n}\n\n/**\n * Entity history data for trail rendering.\n */\nexport interface EntityHistoryData {\n  /** Entity ID */\n  entityId: string;\n  /** Entity color for the trail */\n  color: string;\n  /** Array of history points in chronological order */\n  points: HistoryPoint[];\n}\n\n/**\n * Severity levels for configuration warnings.\n */\nexport type ConfigWarningSeverity = \"warning\" | \"info\";\n\n/**\n * A configuration validation warning.\n */\nexport interface ConfigWarning {\n  /** Unique identifier for this warning type */\n  id: string;\n  /** Severity level of the warning */\n  severity: ConfigWarningSeverity;\n  /** Warning message describing the issue */\n  message: string;\n  /** Suggestion for how to fix the issue */\n  suggestion?: string;\n}\n\n/**\n * Validates visibility configuration options and returns any warnings.\n * This helps users understand when their configuration may cause unexpected behavior.\n *\n * @param config - The card configuration to validate\n * @returns Array of configuration warnings (empty if no issues found)\n */\nexport function validateVisibilityConfig(\n  config: Partial<ABCEmergencyMapCardConfig>\n): ConfigWarning[] {\n  const warnings: ConfigWarning[] = [];\n\n  // Check: hide_markers_for_polygons has no effect when show_warning_levels is false\n  if (\n    config.show_warning_levels === false &&\n    config.hide_markers_for_polygons === true\n  ) {\n    warnings.push({\n      id: \"hide-markers-no-effect\",\n      severity: \"warning\",\n      message:\n        \"'hide_markers_for_polygons' has no effect when 'show_warning_levels' is false.\",\n      suggestion:\n        \"Polygon entities will render as markers only. Remove 'hide_markers_for_polygons' or set 'show_warning_levels: true'.\",\n    });\n  }\n\n  return warnings;\n}\n","/**\n * Geometry Utility Functions\n *\n * Pure utility functions for GeoJSON geometry calculations.\n * These functions are designed to be easily testable.\n */\n\nimport type { LatLngBounds } from \"leaflet\";\n\n/**\n * Cache entry for polygon extent calculations.\n */\ninterface ExtentCacheEntry {\n  /** Hash of the geometry coordinates for change detection */\n  hash: string;\n  /** Cached extent value in meters */\n  extent: number;\n}\n\n/**\n * Cache for polygon extent calculations.\n * Stores computed extent values keyed by entity ID with geometry hash invalidation.\n */\nclass PolygonExtentCache {\n  private _cache: Map<string, ExtentCacheEntry> = new Map();\n  private _debugLogging = false;\n\n  /**\n   * Enables or disables debug logging for cache operations.\n   */\n  setDebugLogging(enabled: boolean): void {\n    this._debugLogging = enabled;\n  }\n\n  /**\n   * Generates a hash of GeoJSON geometry for change detection.\n   * Uses JSON stringification of coordinates which is fast enough for our use case.\n   */\n  private _hashGeometry(geojson: GeoJSON.GeoJSON): string {\n    // Hash based on coordinates - this is the part that changes when geometry updates\n    const geo = geojson as { coordinates?: unknown };\n    if (geo.coordinates) {\n      return JSON.stringify(geo.coordinates);\n    }\n    // For GeometryCollection or other types, hash the whole thing\n    return JSON.stringify(geojson);\n  }\n\n  /**\n   * Gets the cached extent for an entity, or computes and caches it.\n   *\n   * @param entityId - The entity ID to cache by\n   * @param geojson - The GeoJSON geometry\n   * @returns The extent in meters\n   */\n  getExtent(entityId: string, geojson: GeoJSON.GeoJSON | undefined): number {\n    if (!geojson) return 0;\n\n    const hash = this._hashGeometry(geojson);\n    const cached = this._cache.get(entityId);\n\n    // Check cache hit\n    if (cached && cached.hash === hash) {\n      if (this._debugLogging) {\n        console.debug(`ABC Emergency Map: Extent cache HIT for ${entityId}`);\n      }\n      return cached.extent;\n    }\n\n    // Cache miss - compute extent\n    const extent = computePolygonExtent(geojson);\n\n    // Store in cache\n    this._cache.set(entityId, { hash, extent });\n\n    if (this._debugLogging) {\n      const reason = cached ? \"geometry changed\" : \"new entry\";\n      console.debug(\n        `ABC Emergency Map: Extent cache MISS for ${entityId} (${reason}), extent: ${Math.round(extent)}m`\n      );\n    }\n\n    return extent;\n  }\n\n  /**\n   * Removes a single entity from the cache.\n   * Call this when an entity is no longer tracked.\n   */\n  remove(entityId: string): void {\n    this._cache.delete(entityId);\n  }\n\n  /**\n   * Removes entities that are not in the provided set.\n   * Call this periodically to clean up stale entries.\n   *\n   * @param activeEntityIds - Set of entity IDs that are still active\n   * @returns Number of entries removed\n   */\n  cleanup(activeEntityIds: Set<string>): number {\n    let removed = 0;\n    for (const entityId of this._cache.keys()) {\n      if (!activeEntityIds.has(entityId)) {\n        this._cache.delete(entityId);\n        removed++;\n      }\n    }\n    if (removed > 0 && this._debugLogging) {\n      console.debug(`ABC Emergency Map: Extent cache cleaned up ${removed} stale entries`);\n    }\n    return removed;\n  }\n\n  /**\n   * Clears all cached entries.\n   */\n  clear(): void {\n    this._cache.clear();\n  }\n\n  /**\n   * Returns the current cache size.\n   */\n  get size(): number {\n    return this._cache.size;\n  }\n}\n\n/** Singleton cache instance for polygon extents */\nexport const polygonExtentCache = new PolygonExtentCache();\n\n/**\n * Computes the polygon extent without caching.\n * This is the raw calculation - use polygonExtentCache.getExtent() for cached access.\n *\n * @param geojson - A GeoJSON geometry object (Polygon, MultiPolygon, GeometryCollection)\n * @returns The maximum extent in meters, or 0 if the geometry is invalid/empty\n */\nfunction computePolygonExtent(geojson: GeoJSON.GeoJSON): number {\n  try {\n    // Create a temporary GeoJSON layer to get bounds\n    const layer = L.geoJSON(geojson);\n    const bounds: LatLngBounds = layer.getBounds();\n\n    if (!bounds.isValid()) return 0;\n\n    const ne = bounds.getNorthEast();\n    const sw = bounds.getSouthWest();\n\n    // Calculate width and height in meters using Leaflet's geodetic distance\n    const width = L.latLng(ne.lat, sw.lng).distanceTo(ne);\n    const height = L.latLng(sw.lat, ne.lng).distanceTo(sw);\n\n    // Return the maximum dimension\n    return Math.max(width, height);\n  } catch {\n    console.warn(\"ABC Emergency Map: Failed to calculate polygon extent\");\n    return 0;\n  }\n}\n\n/**\n * Calculates the maximum extent (width or height) of a GeoJSON geometry in meters.\n * Uses Leaflet's geodetic distance calculation for accuracy.\n *\n * Note: This is the uncached version for backwards compatibility.\n * For better performance with repeated calls, use polygonExtentCache.getExtent().\n *\n * @param geojson - A GeoJSON geometry object (Polygon, MultiPolygon, GeometryCollection)\n * @returns The maximum extent in meters, or 0 if the geometry is invalid/empty\n */\nexport function getPolygonExtentMeters(geojson: GeoJSON.GeoJSON | undefined): number {\n  if (!geojson) return 0;\n  return computePolygonExtent(geojson);\n}\n\n/**\n * Checks if a geometry type represents a polygon (not a point).\n *\n * @param geometryType - The GeoJSON geometry type string\n * @returns True if the geometry is a polygon type\n */\nexport function isPolygonGeometryType(geometryType: string | undefined): boolean {\n  if (!geometryType) return false;\n  return (\n    geometryType === \"Polygon\" ||\n    geometryType === \"MultiPolygon\" ||\n    geometryType === \"GeometryCollection\"\n  );\n}\n\n/**\n * Extracts the geometry type from entity attributes.\n *\n * @param attributes - Entity attributes object\n * @returns The geometry type string or undefined\n */\nexport function getGeometryType(\n  attributes: Record<string, unknown>\n): string | undefined {\n  const geojson = attributes.geojson || attributes.geometry;\n  if (!geojson) return undefined;\n\n  return (\n    (geojson as { type?: string }).type ||\n    (attributes.geometry_type as string) ||\n    undefined\n  );\n}\n","/**\n * Leaflet Dynamic Loader\n *\n * Dynamically loads Leaflet.js and CSS from CDN with SRI verification.\n * Uses a singleton pattern to prevent multiple loads when several cards\n * are on the same page.\n *\n * IMPORTANT: Because our card uses Shadow DOM, we need to inject Leaflet CSS\n * into each shadow root, not just the document head.\n */\n\n// Note: The global L declaration is in leaflet-types.d.ts\n\n/** Leaflet version to load from CDN */\nconst LEAFLET_VERSION = \"1.9.4\";\n\n/** CDN URLs for Leaflet assets */\nconst LEAFLET_CSS_URL = `https://unpkg.com/leaflet@${LEAFLET_VERSION}/dist/leaflet.css`;\nconst LEAFLET_JS_URL = `https://unpkg.com/leaflet@${LEAFLET_VERSION}/dist/leaflet.js`;\n\n/**\n * SRI (Subresource Integrity) hashes for Leaflet 1.9.4\n * These ensure the loaded files haven't been tampered with.\n */\nconst LEAFLET_CSS_INTEGRITY =\n  \"sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=\";\nconst LEAFLET_JS_INTEGRITY =\n  \"sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=\";\n\n/** Loading state tracking */\nlet leafletLoadPromise: Promise<typeof L> | null = null;\nlet leafletLoaded = false;\n\n/** Cached Leaflet CSS content for shadow DOM injection */\nlet leafletCSSContent: string | null = null;\n\n/**\n * Fetches and caches the Leaflet CSS content.\n * This is used to inject CSS into shadow roots.\n *\n * @returns Promise that resolves with the CSS content\n */\nasync function fetchLeafletCSS(): Promise<string> {\n  if (leafletCSSContent) {\n    return leafletCSSContent;\n  }\n\n  const response = await fetch(LEAFLET_CSS_URL);\n  if (!response.ok) {\n    throw new Error(`Failed to fetch Leaflet CSS: ${response.status}`);\n  }\n\n  leafletCSSContent = await response.text();\n  return leafletCSSContent;\n}\n\n/**\n * Injects Leaflet CSS into a shadow root.\n *\n * Because Shadow DOM creates a style boundary, CSS loaded into document.head\n * doesn't apply inside shadow roots. This function injects Leaflet's CSS\n * directly into the shadow root so map styling works correctly.\n *\n * @param shadowRoot - The shadow root to inject CSS into\n * @returns Promise that resolves when CSS is injected\n */\nexport async function injectLeafletCSS(shadowRoot: ShadowRoot): Promise<void> {\n  console.log(\"ABC Emergency Map: Injecting Leaflet CSS into shadow root\");\n\n  // Check if already injected\n  const existingStyle = shadowRoot.querySelector('style[data-leaflet-css]');\n  if (existingStyle) {\n    console.log(\"ABC Emergency Map: Leaflet CSS already injected\");\n    return;\n  }\n\n  // Fetch CSS content if not cached\n  const cssContent = await fetchLeafletCSS();\n  console.log(\"ABC Emergency Map: Fetched Leaflet CSS, length:\", cssContent.length);\n\n  // Create and inject style element\n  const styleElement = document.createElement(\"style\");\n  styleElement.setAttribute(\"data-leaflet-css\", \"true\");\n  styleElement.textContent = cssContent;\n\n  // Insert at the beginning of shadow root so component styles can override\n  shadowRoot.insertBefore(styleElement, shadowRoot.firstChild);\n  console.log(\"ABC Emergency Map: Leaflet CSS injected successfully\");\n}\n\n/**\n * Injects a CSS stylesheet into the document head.\n *\n * @param url - The URL of the stylesheet\n * @param integrity - SRI hash for verification\n * @returns Promise that resolves when CSS is loaded\n */\nfunction loadCSS(url: string, integrity: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    // Check if already loaded\n    const existingLink = document.querySelector(`link[href=\"${url}\"]`);\n    if (existingLink) {\n      resolve();\n      return;\n    }\n\n    const link = document.createElement(\"link\");\n    link.rel = \"stylesheet\";\n    link.href = url;\n    link.integrity = integrity;\n    link.crossOrigin = \"anonymous\";\n\n    link.onload = () => resolve();\n    link.onerror = () =>\n      reject(new Error(`Failed to load Leaflet CSS from ${url}`));\n\n    document.head.appendChild(link);\n  });\n}\n\n/**\n * Injects a JavaScript file into the document.\n *\n * @param url - The URL of the script\n * @param integrity - SRI hash for verification\n * @returns Promise that resolves when script is loaded\n */\nfunction loadScript(url: string, integrity: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    // Check if Leaflet is already available\n    if (typeof window !== \"undefined\" && \"L\" in window) {\n      resolve();\n      return;\n    }\n\n    const script = document.createElement(\"script\");\n    script.src = url;\n    script.integrity = integrity;\n    script.crossOrigin = \"anonymous\";\n    script.async = true;\n\n    script.onload = () => resolve();\n    script.onerror = () =>\n      reject(new Error(`Failed to load Leaflet JS from ${url}`));\n\n    document.head.appendChild(script);\n  });\n}\n\n/**\n * Loads Leaflet library from CDN.\n *\n * Uses a singleton pattern - multiple calls will return the same promise,\n * ensuring Leaflet is only loaded once even with multiple card instances.\n *\n * @returns Promise that resolves with the Leaflet L object\n * @throws Error if Leaflet fails to load\n */\nexport async function loadLeaflet(): Promise<typeof L> {\n  // Return cached promise if already loading/loaded\n  if (leafletLoadPromise) {\n    return leafletLoadPromise;\n  }\n\n  // Return immediately if already loaded\n  if (leafletLoaded && typeof L !== \"undefined\") {\n    return L;\n  }\n\n  // Create loading promise\n  leafletLoadPromise = (async () => {\n    try {\n      // Load CSS first (map rendering depends on styles)\n      await loadCSS(LEAFLET_CSS_URL, LEAFLET_CSS_INTEGRITY);\n\n      // Then load JavaScript\n      await loadScript(LEAFLET_JS_URL, LEAFLET_JS_INTEGRITY);\n\n      // Verify Leaflet loaded correctly\n      if (typeof L === \"undefined\") {\n        throw new Error(\"Leaflet loaded but L is undefined\");\n      }\n\n      leafletLoaded = true;\n      return L;\n    } catch (error) {\n      // Reset promise on failure to allow retry\n      leafletLoadPromise = null;\n      throw error;\n    }\n  })();\n\n  return leafletLoadPromise;\n}\n\n/**\n * Checks if Leaflet is currently loaded.\n *\n * @returns true if Leaflet is available\n */\nexport function isLeafletLoaded(): boolean {\n  return leafletLoaded && typeof L !== \"undefined\";\n}\n","/**\n * Tile Provider Presets\n *\n * Defines built-in tile providers with their configurations.\n * Each provider can have light and dark variants for theme support.\n */\n\nimport type {\n  TileProviderId,\n  TileProviderConfig,\n  TileProviderPreset,\n  ABCEmergencyMapCardConfig,\n} from \"./types\";\n\n/**\n * OpenStreetMap - Free, community-driven map tiles.\n * No API key required. Good default choice.\n */\nconst osmPreset: TileProviderPreset = {\n  name: \"OpenStreetMap\",\n  requiresApiKey: false,\n  light: {\n    url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n    attribution:\n      '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n    maxZoom: 19,\n    subdomains: [\"a\", \"b\", \"c\"],\n  },\n  // OSM doesn't have official dark tiles, so we fall back to light\n};\n\n/**\n * CartoDB/Carto - Clean, minimal map tiles.\n * No API key required for basic usage. Has excellent dark mode support.\n */\nconst cartodbPreset: TileProviderPreset = {\n  name: \"CartoDB\",\n  requiresApiKey: false,\n  light: {\n    url: \"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png\",\n    attribution:\n      '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n    maxZoom: 20,\n    subdomains: [\"a\", \"b\", \"c\", \"d\"],\n  },\n  dark: {\n    url: \"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\",\n    attribution:\n      '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n    maxZoom: 20,\n    subdomains: [\"a\", \"b\", \"c\", \"d\"],\n  },\n};\n\n/**\n * Mapbox - Premium map tiles with extensive customization.\n * Requires API key. Provides high-quality tiles with dark mode support.\n */\nconst mapboxPreset: TileProviderPreset = {\n  name: \"Mapbox\",\n  requiresApiKey: true,\n  light: {\n    url: \"https://api.mapbox.com/styles/v1/mapbox/streets-v12/tiles/{z}/{x}/{y}?access_token={accessToken}\",\n    attribution:\n      '&copy; <a href=\"https://www.mapbox.com/about/maps/\">Mapbox</a> &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n    maxZoom: 22,\n  },\n  dark: {\n    url: \"https://api.mapbox.com/styles/v1/mapbox/dark-v11/tiles/{z}/{x}/{y}?access_token={accessToken}\",\n    attribution:\n      '&copy; <a href=\"https://www.mapbox.com/about/maps/\">Mapbox</a> &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n    maxZoom: 22,\n  },\n};\n\n/**\n * Registry of all built-in tile providers.\n */\nexport const TILE_PROVIDERS: Record<\n  Exclude<TileProviderId, \"custom\">,\n  TileProviderPreset\n> = {\n  osm: osmPreset,\n  cartodb: cartodbPreset,\n  mapbox: mapboxPreset,\n};\n\n/**\n * Default tile provider when none is specified.\n */\nexport const DEFAULT_TILE_PROVIDER: TileProviderId = \"osm\";\n\n/**\n * Resolves the tile configuration for a given card config.\n * Handles provider selection, dark mode variants, and custom URLs.\n *\n * @param config - The card configuration\n * @param darkMode - Whether dark mode is active\n * @returns The resolved tile provider configuration\n */\nexport function resolveTileProvider(\n  config: ABCEmergencyMapCardConfig,\n  darkMode: boolean\n): TileProviderConfig {\n  const providerId = config.tile_provider ?? DEFAULT_TILE_PROVIDER;\n\n  // Handle custom tile provider\n  if (providerId === \"custom\") {\n    return resolveCustomProvider(config);\n  }\n\n  // Get the preset for the specified provider\n  const preset = TILE_PROVIDERS[providerId];\n  if (!preset) {\n    console.warn(\n      `ABC Emergency Map: Unknown tile provider \"${providerId}\", falling back to OSM`\n    );\n    return TILE_PROVIDERS.osm.light;\n  }\n\n  // Check if API key is required but not provided\n  if (preset.requiresApiKey && !config.api_key) {\n    console.warn(\n      `ABC Emergency Map: ${preset.name} requires an API key. Falling back to OSM.`\n    );\n    return TILE_PROVIDERS.osm.light;\n  }\n\n  // Select light or dark variant\n  const variant = darkMode && preset.dark ? preset.dark : preset.light;\n\n  // Inject API key if provided\n  if (config.api_key && variant.url.includes(\"{accessToken}\")) {\n    return {\n      ...variant,\n      url: variant.url.replace(\"{accessToken}\", config.api_key),\n    };\n  }\n\n  return variant;\n}\n\n/**\n * Resolves a custom tile provider from user configuration.\n *\n * @param config - The card configuration\n * @returns The custom tile provider configuration\n */\nfunction resolveCustomProvider(\n  config: ABCEmergencyMapCardConfig\n): TileProviderConfig {\n  if (!config.tile_url) {\n    console.warn(\n      \"ABC Emergency Map: Custom tile provider requires tile_url. Falling back to OSM.\"\n    );\n    return TILE_PROVIDERS.osm.light;\n  }\n\n  let url = config.tile_url;\n\n  // Replace API key placeholder if provided\n  if (config.api_key && url.includes(\"{accessToken}\")) {\n    url = url.replace(\"{accessToken}\", config.api_key);\n  }\n\n  return {\n    url,\n    attribution:\n      config.tile_attribution ?? \"Custom tiles\",\n    maxZoom: 19,\n  };\n}\n\n/**\n * Gets the list of available tile providers for the configuration UI.\n *\n * @returns Array of provider options with id and display name\n */\nexport function getAvailableTileProviders(): Array<{\n  id: TileProviderId;\n  name: string;\n  requiresApiKey: boolean;\n}> {\n  const providers: Array<{\n    id: TileProviderId;\n    name: string;\n    requiresApiKey: boolean;\n  }> = [];\n\n  for (const [id, preset] of Object.entries(TILE_PROVIDERS)) {\n    providers.push({\n      id: id as TileProviderId,\n      name: preset.name,\n      requiresApiKey: preset.requiresApiKey,\n    });\n  }\n\n  // Add custom option\n  providers.push({\n    id: \"custom\",\n    name: \"Custom URL\",\n    requiresApiKey: false,\n  });\n\n  return providers;\n}\n","/**\n * Entity Marker System\n *\n * Handles rendering and management of entity markers on the Leaflet map.\n * Supports device_tracker, person, and geo_location entities.\n */\n\nimport type { HomeAssistant } from \"custom-card-helpers\";\nimport type { HassEntity } from \"home-assistant-js-websocket\";\nimport type { Map as LeafletMap, Marker, DivIcon, LatLngExpression } from \"leaflet\";\nimport type {\n  EntityMarkerData,\n  MarkerEntityDomain,\n  ABCEmergencyMapCardConfig,\n} from \"./types\";\nimport { DOMAIN_COLORS, DOMAIN_ICONS } from \"./types\";\n\n/** Domains that support location tracking */\nconst LOCATION_DOMAINS: MarkerEntityDomain[] = [\n  \"device_tracker\",\n  \"person\",\n  \"geo_location\",\n];\n\n/**\n * Checks if an entity domain supports location markers.\n */\nexport function isLocationDomain(domain: string): domain is MarkerEntityDomain {\n  return LOCATION_DOMAINS.includes(domain as MarkerEntityDomain);\n}\n\n/**\n * Extracts the domain from an entity ID.\n */\nexport function getDomain(entityId: string): string {\n  return entityId.split(\".\")[0];\n}\n\n/**\n * Checks if an entity has valid GPS coordinates.\n */\nexport function hasValidCoordinates(entity: HassEntity): boolean {\n  const lat = entity.attributes.latitude;\n  const lon = entity.attributes.longitude;\n  return (\n    typeof lat === \"number\" &&\n    typeof lon === \"number\" &&\n    !isNaN(lat) &&\n    !isNaN(lon) &&\n    lat >= -90 &&\n    lat <= 90 &&\n    lon >= -180 &&\n    lon <= 180\n  );\n}\n\n/**\n * Extracts marker data from a Home Assistant entity.\n */\nexport function extractEntityMarkerData(\n  entityId: string,\n  entity: HassEntity\n): EntityMarkerData | null {\n  const domain = getDomain(entityId);\n\n  if (!isLocationDomain(domain)) {\n    return null;\n  }\n\n  if (!hasValidCoordinates(entity)) {\n    return null;\n  }\n\n  const attrs = entity.attributes;\n\n  return {\n    entityId,\n    domain,\n    name: attrs.friendly_name || entityId,\n    latitude: attrs.latitude as number,\n    longitude: attrs.longitude as number,\n    picture: attrs.entity_picture as string | undefined,\n    state: entity.state,\n    gpsAccuracy: attrs.gps_accuracy as number | undefined,\n    battery: attrs.battery as number | undefined,\n    lastUpdated: entity.last_updated,\n  };\n}\n\n/**\n * Extracts entity IDs from geo_location source entities.\n *\n * Source entities (sensors or binary_sensors) expose `entity_ids` or\n * `containing_entity_ids` attributes that list geo_location entity IDs\n * matching their filter criteria.\n *\n * @param hass - Home Assistant instance\n * @param sources - Array of source entity IDs (sensors/binary_sensors)\n * @returns Array of geo_location entity IDs discovered from sources\n */\nexport function getEntityIdsFromSources(\n  hass: HomeAssistant,\n  sources: string[]\n): string[] {\n  const entityIds: string[] = [];\n\n  console.log(\"ABC Emergency Map: Processing geo_location_sources:\", sources);\n\n  for (const sourceId of sources) {\n    const source = hass.states[sourceId];\n    if (!source) {\n      console.warn(`ABC Emergency Map: Source entity not found: ${sourceId}`);\n      continue;\n    }\n\n    console.log(`ABC Emergency Map: Source ${sourceId} state:`, source.state, \"attrs:\", source.attributes);\n\n    const attrs = source.attributes;\n\n    // Check for entity_ids attribute (used by sensors)\n    if (Array.isArray(attrs.entity_ids)) {\n      console.log(`ABC Emergency Map: Found entity_ids in ${sourceId}:`, attrs.entity_ids);\n      entityIds.push(...(attrs.entity_ids as string[]));\n    }\n\n    // Check for containing_entity_ids attribute (used by binary_sensors)\n    if (Array.isArray(attrs.containing_entity_ids)) {\n      console.log(`ABC Emergency Map: Found containing_entity_ids in ${sourceId}:`, attrs.containing_entity_ids);\n      entityIds.push(...(attrs.containing_entity_ids as string[]));\n    }\n\n    if (!attrs.entity_ids && !attrs.containing_entity_ids) {\n      console.warn(`ABC Emergency Map: Source ${sourceId} has no entity_ids or containing_entity_ids attribute`);\n    }\n  }\n\n  console.log(\"ABC Emergency Map: Total entity IDs from sources:\", entityIds);\n\n  // Deduplicate and return\n  return [...new Set(entityIds)];\n}\n\n/**\n * Gets explicitly configured entities from card config.\n */\nexport function getConfiguredEntities(\n  hass: HomeAssistant,\n  config: ABCEmergencyMapCardConfig\n): EntityMarkerData[] {\n  const entities: EntityMarkerData[] = [];\n  const processedIds = new Set<string>();\n\n  // Process explicitly configured entities\n  const configuredEntityIds: string[] = [];\n  if (config.entity) {\n    configuredEntityIds.push(config.entity);\n  }\n  if (config.entities) {\n    configuredEntityIds.push(...config.entities);\n  }\n\n  for (const entityId of configuredEntityIds) {\n    if (processedIds.has(entityId)) continue;\n    processedIds.add(entityId);\n\n    const entity = hass.states[entityId];\n    if (!entity) continue;\n\n    const data = extractEntityMarkerData(entityId, entity);\n    if (data) {\n      entities.push(data);\n    }\n  }\n\n  return entities;\n}\n\n/**\n * Gets all entities to display, combining:\n * 1. Explicitly configured entities (entity, entities)\n * 2. Dynamically discovered entities from geo_location_sources\n *\n * This allows cards to be configured with both static entity IDs and\n * dynamic sources that discover entities based on filter criteria.\n *\n * @param hass - Home Assistant instance\n * @param config - Card configuration\n * @returns Combined array of EntityMarkerData for all entities\n */\nexport function getAllEntities(\n  hass: HomeAssistant,\n  config: ABCEmergencyMapCardConfig\n): EntityMarkerData[] {\n  const processedIds = new Set<string>();\n  const entities: EntityMarkerData[] = [];\n\n  // 1. Add explicitly configured entities first\n  const staticEntities = getConfiguredEntities(hass, config);\n  for (const entity of staticEntities) {\n    if (!processedIds.has(entity.entityId)) {\n      processedIds.add(entity.entityId);\n      entities.push(entity);\n    }\n  }\n\n  // 2. Add entities discovered from geo_location_sources\n  if (config.geo_location_sources && config.geo_location_sources.length > 0) {\n    const sourceEntityIds = getEntityIdsFromSources(hass, config.geo_location_sources);\n\n    // Debug: List all geo_location entities in hass.states\n    const geoLocationEntities = Object.keys(hass.states).filter(id => id.startsWith('geo_location.'));\n    console.log(\"ABC Emergency Map: All geo_location entities in hass.states:\", geoLocationEntities);\n\n    for (const entityId of sourceEntityIds) {\n      if (processedIds.has(entityId)) continue;\n      processedIds.add(entityId);\n\n      const entity = hass.states[entityId];\n      if (!entity) {\n        console.warn(`ABC Emergency Map: Entity from source not found in hass.states: ${entityId}`);\n        continue;\n      }\n\n      const data = extractEntityMarkerData(entityId, entity);\n      if (data) {\n        entities.push(data);\n      } else {\n        console.warn(`ABC Emergency Map: Entity ${entityId} has no valid coordinates`);\n      }\n    }\n  }\n\n  return entities;\n}\n\n/**\n * Creates a CSS style string for a marker icon.\n */\nfunction createMarkerIconStyle(\n  data: EntityMarkerData,\n  size: number\n): string {\n  const color = DOMAIN_COLORS[data.domain];\n  const hasImage = !!data.picture;\n\n  if (hasImage) {\n    return `\n      width: ${size}px;\n      height: ${size}px;\n      border-radius: 50%;\n      border: 3px solid ${color};\n      background-image: url('${data.picture}');\n      background-size: cover;\n      background-position: center;\n      box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n    `;\n  }\n\n  return `\n    width: ${size}px;\n    height: ${size}px;\n    border-radius: 50%;\n    background-color: ${color};\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n    color: white;\n    font-size: ${size * 0.5}px;\n  `;\n}\n\n/**\n * Creates the inner HTML for a marker icon.\n */\nfunction createMarkerIconHtml(data: EntityMarkerData, size: number): string {\n  const style = createMarkerIconStyle(data, size);\n\n  if (data.picture) {\n    return `<div style=\"${style}\"></div>`;\n  }\n\n  // Use MDI icon mapping for fallback\n  const iconName = DOMAIN_ICONS[data.domain];\n  // Convert mdi:icon-name to ha-icon format\n  return `\n    <div style=\"${style}\">\n      <ha-icon icon=\"${iconName}\" style=\"--mdc-icon-size: ${size * 0.6}px;\"></ha-icon>\n    </div>\n  `;\n}\n\n/**\n * Creates a popup content HTML for an entity marker.\n * Uses semantic HTML for accessibility (dl/dt/dd structure).\n */\nexport function createPopupContent(data: EntityMarkerData): string {\n  // Escape HTML to prevent XSS\n  const escape = (str: string) =>\n    str.replace(/[&<>\"']/g, (c) =>\n      ({ \"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", '\"': \"&quot;\", \"'\": \"&#39;\" }[c] || c)\n    );\n\n  const safeEntityId = escape(data.entityId);\n  const uniqueId = `popup-${safeEntityId.replace(/\\./g, \"-\")}`;\n\n  const items: string[] = [\n    `<dt class=\"sr-only\">State</dt><dd>${escape(data.state)}</dd>`,\n  ];\n\n  if (data.battery !== undefined) {\n    items.push(`<dt>Battery</dt><dd>${data.battery}%</dd>`);\n  }\n\n  if (data.gpsAccuracy !== undefined) {\n    items.push(`<dt>GPS Accuracy</dt><dd>${data.gpsAccuracy}m</dd>`);\n  }\n\n  return `\n    <article class=\"entity-popup\" role=\"dialog\" aria-labelledby=\"${uniqueId}\">\n      <h3 id=\"${uniqueId}\" class=\"entity-popup-title\">${escape(data.name)}</h3>\n      <small class=\"entity-popup-id\">${safeEntityId}</small>\n      <dl class=\"entity-popup-details\">${items.join(\"\")}</dl>\n    </article>\n  `;\n}\n\n/**\n * Manages entity markers on a Leaflet map.\n */\nexport class EntityMarkerManager {\n  private _map: LeafletMap;\n  private _markers: Map<string, Marker> = new Map();\n  private _markerSize = 40;\n\n  constructor(map: LeafletMap) {\n    this._map = map;\n  }\n\n  /**\n   * Updates all markers based on current entity data.\n   */\n  public updateMarkers(entities: EntityMarkerData[]): void {\n    const currentIds = new Set(entities.map((e) => e.entityId));\n\n    // Remove markers for entities that are no longer present\n    for (const [entityId, marker] of this._markers) {\n      if (!currentIds.has(entityId)) {\n        marker.remove();\n        this._markers.delete(entityId);\n      }\n    }\n\n    // Update or create markers for each entity\n    for (const data of entities) {\n      this._updateOrCreateMarker(data);\n    }\n  }\n\n  /**\n   * Updates an existing marker or creates a new one.\n   */\n  private _updateOrCreateMarker(data: EntityMarkerData): void {\n    const position: LatLngExpression = [data.latitude, data.longitude];\n    const existingMarker = this._markers.get(data.entityId);\n\n    if (existingMarker) {\n      // Update existing marker position\n      existingMarker.setLatLng(position);\n\n      // Update icon (in case picture changed)\n      const icon = this._createIcon(data);\n      existingMarker.setIcon(icon);\n\n      // Update popup content\n      existingMarker.setPopupContent(createPopupContent(data));\n    } else {\n      // Create new marker\n      const icon = this._createIcon(data);\n      const marker = L.marker(position, { icon })\n        .bindPopup(createPopupContent(data))\n        .addTo(this._map);\n\n      // Add tooltip with entity name on hover\n      marker.bindTooltip(data.name, {\n        permanent: false,\n        direction: \"top\",\n        offset: [0, -this._markerSize / 2],\n      });\n\n      this._markers.set(data.entityId, marker);\n    }\n  }\n\n  /**\n   * Creates a Leaflet DivIcon for an entity marker.\n   */\n  private _createIcon(data: EntityMarkerData): DivIcon {\n    return L.divIcon({\n      className: \"entity-marker\",\n      html: createMarkerIconHtml(data, this._markerSize),\n      iconSize: [this._markerSize, this._markerSize],\n      iconAnchor: [this._markerSize / 2, this._markerSize / 2],\n      popupAnchor: [0, -this._markerSize / 2],\n    });\n  }\n\n  /**\n   * Gets all current marker positions for bounds calculation.\n   */\n  public getMarkerPositions(): [number, number][] {\n    const positions: [number, number][] = [];\n    for (const marker of this._markers.values()) {\n      const latLng = marker.getLatLng();\n      positions.push([latLng.lat, latLng.lng]);\n    }\n    return positions;\n  }\n\n  /**\n   * Gets the number of active markers.\n   */\n  public get markerCount(): number {\n    return this._markers.size;\n  }\n\n  /**\n   * Sets visibility of all markers based on zoom level.\n   * Uses CSS class for smooth opacity transition.\n   * @param visible - Whether markers should be visible\n   */\n  public setZoomVisibility(visible: boolean): void {\n    for (const marker of this._markers.values()) {\n      const element = marker.getElement();\n      if (element) {\n        if (visible) {\n          element.classList.remove(\"zoom-hidden\");\n        } else {\n          element.classList.add(\"zoom-hidden\");\n        }\n      }\n    }\n  }\n\n  /**\n   * Removes all markers from the map.\n   */\n  public clear(): void {\n    for (const marker of this._markers.values()) {\n      marker.remove();\n    }\n    this._markers.clear();\n  }\n\n  /**\n   * Cleans up resources.\n   */\n  public destroy(): void {\n    this.clear();\n  }\n}\n","/**\n * Zone Renderer\n *\n * Handles rendering of Home Assistant zones on the Leaflet map.\n * Zones are displayed as circles with configurable styling.\n */\n\nimport type { HomeAssistant } from \"custom-card-helpers\";\nimport type { HassEntity } from \"home-assistant-js-websocket\";\nimport type { Map as LeafletMap, Circle, LatLngExpression } from \"leaflet\";\nimport type { ZoneData, ABCEmergencyMapCardConfig } from \"./types\";\nimport {\n  DEFAULT_ZONE_COLOR,\n  DEFAULT_ZONE_OPACITY,\n  DEFAULT_ZONE_BORDER_OPACITY,\n} from \"./types\";\n\n/** Default zone radius in meters when not specified */\nconst DEFAULT_ZONE_RADIUS = 100;\n\n/**\n * Checks if an entity is a zone entity.\n */\nexport function isZoneEntity(entityId: string): boolean {\n  return entityId.startsWith(\"zone.\");\n}\n\n/**\n * Extracts zone data from a Home Assistant zone entity.\n */\nexport function extractZoneData(\n  entityId: string,\n  entity: HassEntity\n): ZoneData | null {\n  const attrs = entity.attributes;\n\n  // Zones must have coordinates\n  const lat = attrs.latitude;\n  const lon = attrs.longitude;\n\n  if (\n    typeof lat !== \"number\" ||\n    typeof lon !== \"number\" ||\n    isNaN(lat) ||\n    isNaN(lon)\n  ) {\n    return null;\n  }\n\n  return {\n    entityId,\n    name: attrs.friendly_name || entityId.replace(\"zone.\", \"\"),\n    latitude: lat,\n    longitude: lon,\n    radius:\n      typeof attrs.radius === \"number\" ? attrs.radius : DEFAULT_ZONE_RADIUS,\n    passive: attrs.passive === true,\n    icon: attrs.icon as string | undefined,\n  };\n}\n\n/**\n * Gets all zone entities from Home Assistant state.\n */\nexport function getAllZones(hass: HomeAssistant): ZoneData[] {\n  const zones: ZoneData[] = [];\n\n  for (const entityId of Object.keys(hass.states)) {\n    if (!isZoneEntity(entityId)) continue;\n\n    const entity = hass.states[entityId];\n    const zoneData = extractZoneData(entityId, entity);\n\n    if (zoneData) {\n      zones.push(zoneData);\n    }\n  }\n\n  return zones;\n}\n\n/**\n * Creates popup content for a zone.\n */\nfunction createZonePopup(zone: ZoneData): string {\n  const parts: string[] = [\n    `<strong>${zone.name}</strong>`,\n    `<br><small>${zone.entityId}</small>`,\n    `<br>Radius: ${zone.radius}m`,\n  ];\n\n  if (zone.passive) {\n    parts.push(\"<br><em>Passive zone</em>\");\n  }\n\n  return `<div class=\"zone-popup\">${parts.join(\"\")}</div>`;\n}\n\n/**\n * Manages zone rendering on a Leaflet map.\n */\nexport class ZoneManager {\n  private _map: LeafletMap;\n  private _circles: Map<string, Circle> = new Map();\n  private _config: ABCEmergencyMapCardConfig;\n\n  constructor(map: LeafletMap, config: ABCEmergencyMapCardConfig) {\n    this._map = map;\n    this._config = config;\n  }\n\n  /**\n   * Updates the configuration.\n   */\n  public updateConfig(config: ABCEmergencyMapCardConfig): void {\n    this._config = config;\n  }\n\n  /**\n   * Updates all zone circles based on current zone data.\n   */\n  public updateZones(zones: ZoneData[]): void {\n    // If zones are disabled, clear all and return\n    if (this._config.show_zones === false) {\n      this.clear();\n      return;\n    }\n\n    const currentIds = new Set(zones.map((z) => z.entityId));\n\n    // Remove circles for zones that no longer exist\n    for (const [entityId, circle] of this._circles) {\n      if (!currentIds.has(entityId)) {\n        circle.remove();\n        this._circles.delete(entityId);\n      }\n    }\n\n    // Update or create circles for each zone\n    for (const zone of zones) {\n      this._updateOrCreateCircle(zone);\n    }\n  }\n\n  /**\n   * Updates an existing circle or creates a new one.\n   */\n  private _updateOrCreateCircle(zone: ZoneData): void {\n    const center: LatLngExpression = [zone.latitude, zone.longitude];\n    const existingCircle = this._circles.get(zone.entityId);\n\n    const fillColor = this._config.zone_color ?? DEFAULT_ZONE_COLOR;\n    const fillOpacity = this._config.zone_opacity ?? DEFAULT_ZONE_OPACITY;\n    const borderOpacity =\n      this._config.zone_border_opacity ?? DEFAULT_ZONE_BORDER_OPACITY;\n\n    const style = {\n      color: fillColor,\n      fillColor: fillColor,\n      fillOpacity: fillOpacity,\n      weight: 2,\n      opacity: borderOpacity,\n      dashArray: zone.passive ? \"5, 5\" : undefined,\n    };\n\n    if (existingCircle) {\n      // Update existing circle\n      existingCircle.setLatLng(center);\n      existingCircle.setRadius(zone.radius);\n      existingCircle.setStyle(style);\n      existingCircle.setPopupContent(createZonePopup(zone));\n    } else {\n      // Create new circle\n      const circle = L.circle(center, {\n        radius: zone.radius,\n        ...style,\n      })\n        .bindPopup(createZonePopup(zone))\n        .bindTooltip(zone.name, {\n          permanent: false,\n          direction: \"center\",\n        })\n        .addTo(this._map);\n\n      this._circles.set(zone.entityId, circle);\n    }\n  }\n\n  /**\n   * Gets all zone positions for bounds calculation.\n   */\n  public getZonePositions(): [number, number][] {\n    const positions: [number, number][] = [];\n    for (const circle of this._circles.values()) {\n      const latLng = circle.getLatLng();\n      positions.push([latLng.lat, latLng.lng]);\n    }\n    return positions;\n  }\n\n  /**\n   * Gets the number of rendered zones.\n   */\n  public get zoneCount(): number {\n    return this._circles.size;\n  }\n\n  /**\n   * Removes all zone circles from the map.\n   */\n  public clear(): void {\n    for (const circle of this._circles.values()) {\n      circle.remove();\n    }\n    this._circles.clear();\n  }\n\n  /**\n   * Cleans up resources.\n   */\n  public destroy(): void {\n    this.clear();\n  }\n}\n","/**\n * Bounds Manager\n *\n * Handles auto-fitting map bounds to show all entities and zones,\n * and provides a custom control button for manual fit-to-entities.\n */\n\nimport type {\n  Map as LeafletMap,\n  Control,\n  LatLngBounds,\n  FitBoundsOptions,\n} from \"leaflet\";\nimport type { ABCEmergencyMapCardConfig } from \"./types\";\nimport {\n  DEFAULT_AUTO_FIT,\n  DEFAULT_FIT_PADDING,\n  DEFAULT_FIT_MAX_ZOOM,\n} from \"./types\";\n\n/** Minimum number of positions required to calculate bounds */\nconst MIN_POSITIONS_FOR_BOUNDS = 1;\n\n/** Debounce delay for auto-fit on entity updates (ms) */\nconst AUTO_FIT_DEBOUNCE_MS = 300;\n\n/**\n * Normalizes padding config to Leaflet's expected format.\n * Leaflet expects [topBottom, leftRight] or a single number.\n */\nfunction normalizePadding(\n  padding: number | [number, number] | undefined\n): [number, number] {\n  if (padding === undefined) {\n    return [DEFAULT_FIT_PADDING, DEFAULT_FIT_PADDING];\n  }\n  if (typeof padding === \"number\") {\n    return [padding, padding];\n  }\n  return padding;\n}\n\n/**\n * Creates a custom Leaflet control for the \"Fit to Entities\" button.\n */\nfunction createFitControl(onClick: () => void): Control {\n  const FitControl = L.Control.extend({\n    options: {\n      position: \"topleft\" as const,\n    },\n\n    onAdd(): HTMLElement {\n      const container = L.DomUtil.create(\n        \"div\",\n        \"leaflet-bar leaflet-control fit-control\"\n      );\n\n      const button = L.DomUtil.create(\"a\", \"fit-control-button\", container);\n      button.href = \"#\";\n      button.title = \"Fit to all entities\";\n      button.setAttribute(\"role\", \"button\");\n      button.setAttribute(\"aria-label\", \"Fit map to show all entities\");\n      button.innerHTML = `<ha-icon icon=\"mdi:fit-to-screen\" style=\"--mdc-icon-size: 18px;\"></ha-icon>`;\n\n      L.DomEvent.disableClickPropagation(container);\n      L.DomEvent.on(button, \"click\", (e: Event) => {\n        L.DomEvent.preventDefault(e);\n        onClick();\n      });\n\n      return container;\n    },\n  });\n\n  return new FitControl();\n}\n\n/**\n * Manages map bounds fitting and provides fit-to-entities control.\n */\nexport class BoundsManager {\n  private _map: LeafletMap;\n  private _config: ABCEmergencyMapCardConfig;\n  private _fitControl?: Control;\n  private _debounceTimer?: number;\n  private _hasUserInteracted = false;\n  private _initialFitDone = false;\n\n  constructor(map: LeafletMap, config: ABCEmergencyMapCardConfig) {\n    this._map = map;\n    this._config = config;\n    this._setupUserInteractionTracking();\n  }\n\n  /**\n   * Updates the configuration.\n   */\n  public updateConfig(config: ABCEmergencyMapCardConfig): void {\n    this._config = config;\n  }\n\n  /**\n   * Adds the fit-to-entities control button to the map.\n   */\n  public addFitControl(): void {\n    if (this._fitControl) {\n      return;\n    }\n\n    this._fitControl = createFitControl(() => {\n      this.fitToPositionsAndBounds(this._lastKnownPositions, this._lastKnownPolygonBounds, true);\n    });\n\n    this._fitControl.addTo(this._map);\n  }\n\n  /**\n   * Removes the fit-to-entities control button from the map.\n   */\n  public removeFitControl(): void {\n    if (this._fitControl) {\n      this._fitControl.remove();\n      this._fitControl = undefined;\n    }\n  }\n\n  /** Stores the last known positions for the fit control button */\n  private _lastKnownPositions: [number, number][] = [];\n  /** Stores the last known polygon bounds for the fit control button */\n  private _lastKnownPolygonBounds?: LatLngBounds;\n\n  /**\n   * Fits the map to show all provided positions.\n   *\n   * @param positions Array of [lat, lng] coordinate pairs\n   * @param force If true, fits even if user has interacted with map\n   */\n  public fitToPositions(\n    positions: [number, number][],\n    force = false\n  ): void {\n    this.fitToPositionsAndBounds(positions, undefined, force);\n  }\n\n  /**\n   * Fits the map to show all provided positions AND polygon bounds.\n   * This properly handles polygons by using their actual bounds, not just centroids.\n   *\n   * @param positions Array of [lat, lng] coordinate pairs (markers, zones)\n   * @param polygonBounds Optional LatLngBounds from polygon layers\n   * @param force If true, fits even if user has interacted with map\n   */\n  public fitToPositionsAndBounds(\n    positions: [number, number][],\n    polygonBounds?: LatLngBounds | null,\n    force = false\n  ): void {\n    // Store for the fit control button\n    this._lastKnownPositions = positions;\n    this._lastKnownPolygonBounds = polygonBounds || undefined;\n\n    // Check if auto-fit is enabled\n    const autoFit = this._config.auto_fit ?? DEFAULT_AUTO_FIT;\n\n    // Skip if auto-fit disabled and not forced (unless initial fit)\n    if (!autoFit && !force && this._initialFitDone) {\n      return;\n    }\n\n    // Skip if user has manually interacted with map (unless forced or initial)\n    if (this._hasUserInteracted && !force && this._initialFitDone) {\n      return;\n    }\n\n    // Need at least one position OR polygon bounds to fit\n    const hasPositions = positions.length >= MIN_POSITIONS_FOR_BOUNDS;\n    const hasPolygonBounds = polygonBounds?.isValid();\n    if (!hasPositions && !hasPolygonBounds) {\n      return;\n    }\n\n    // Clear any pending debounce\n    if (this._debounceTimer) {\n      window.clearTimeout(this._debounceTimer);\n    }\n\n    // Debounce to avoid rapid updates\n    this._debounceTimer = window.setTimeout(() => {\n      this._performFitWithPolygons(positions, polygonBounds);\n      this._initialFitDone = true;\n    }, force ? 0 : AUTO_FIT_DEBOUNCE_MS);\n  }\n\n  /**\n   * Performs the actual bounds fitting, including polygon bounds.\n   */\n  private _performFitWithPolygons(\n    positions: [number, number][],\n    polygonBounds?: LatLngBounds | null\n  ): void {\n    const padding = normalizePadding(this._config.fit_padding);\n    const maxZoom = this._config.fit_max_zoom ?? DEFAULT_FIT_MAX_ZOOM;\n\n    // Start with polygon bounds if available, or create empty bounds\n    let combinedBounds: LatLngBounds;\n    if (polygonBounds?.isValid()) {\n      combinedBounds = L.latLngBounds(polygonBounds.getSouthWest(), polygonBounds.getNorthEast());\n    } else {\n      combinedBounds = L.latLngBounds([]);\n    }\n\n    // Extend bounds with all positions\n    for (const [lat, lng] of positions) {\n      combinedBounds.extend([lat, lng]);\n    }\n\n    // Check if we have valid bounds\n    if (!combinedBounds.isValid()) {\n      return;\n    }\n\n    // Check if bounds represent a single point (or very small area)\n    const boundsSize = combinedBounds.getNorthEast().distanceTo(combinedBounds.getSouthWest());\n    const isSinglePoint = boundsSize < 1; // Less than 1 meter\n\n    if (isSinglePoint) {\n      // Single position: center and use default zoom\n      const center = combinedBounds.getCenter();\n      const zoom = Math.min(\n        this._config.default_zoom ?? 10,\n        maxZoom\n      );\n      this._map.setView(center, zoom, { animate: true });\n    } else {\n      // Multiple positions or polygon: fit to bounds\n      const options: FitBoundsOptions = {\n        padding: padding,\n        maxZoom: maxZoom,\n        animate: true,\n      };\n\n      this._map.fitBounds(combinedBounds, options);\n    }\n  }\n\n  /**\n   * Sets up tracking for user interaction with the map.\n   * Once the user manually pans or zooms, auto-fit is disabled\n   * until they explicitly use the fit control button.\n   */\n  private _setupUserInteractionTracking(): void {\n    // Track user-initiated drag/zoom\n    this._map.on(\"dragstart\", () => {\n      this._hasUserInteracted = true;\n    });\n\n    this._map.on(\"zoomstart\", () => {\n      // Only mark as user interaction if triggered by user (not programmatic)\n      // Unfortunately Leaflet doesn't distinguish, so we use a flag approach\n      // The fit methods will temporarily ignore this by using force=true\n    });\n  }\n\n  /**\n   * Resets the user interaction flag.\n   * Called when user explicitly clicks \"fit to entities\".\n   */\n  public resetUserInteraction(): void {\n    this._hasUserInteracted = false;\n  }\n\n  /**\n   * Cleans up resources.\n   */\n  public destroy(): void {\n    if (this._debounceTimer) {\n      window.clearTimeout(this._debounceTimer);\n      this._debounceTimer = undefined;\n    }\n\n    this.removeFitControl();\n  }\n}\n","/**\n * History Trails Manager\n *\n * Fetches entity location history from Home Assistant and renders\n * polyline trails on the Leaflet map with age-based gradient coloring.\n */\n\nimport type { HomeAssistant } from \"custom-card-helpers\";\nimport type { Map as LeafletMap, Polyline, LatLngExpression } from \"leaflet\";\nimport type {\n  ABCEmergencyMapCardConfig,\n  HistoryPoint,\n  EntityHistoryData,\n  MarkerEntityDomain,\n} from \"./types\";\nimport {\n  DEFAULT_SHOW_HISTORY,\n  DEFAULT_HISTORY_LINE_WEIGHT,\n  DEFAULT_HOURS_TO_SHOW,\n  DOMAIN_COLORS,\n} from \"./types\";\nimport { getDomain, isLocationDomain } from \"./entity-markers\";\n\n/** Minimum time between history fetches (ms) */\nconst FETCH_DEBOUNCE_MS = 5000;\n\n/** Maximum gap in minutes before breaking the trail */\nconst MAX_GAP_MINUTES = 30;\n\n/** Number of segments for gradient effect */\nconst GRADIENT_SEGMENTS = 10;\n\n/**\n * Fetches entity history from Home Assistant.\n * Uses the history/period WebSocket API.\n */\nasync function fetchEntityHistory(\n  hass: HomeAssistant,\n  entityId: string,\n  hoursToShow: number\n): Promise<HistoryPoint[]> {\n  const endTime = new Date();\n  const startTime = new Date(endTime.getTime() - hoursToShow * 60 * 60 * 1000);\n\n  try {\n    // Define the history state type\n    interface HistoryState {\n      last_changed: string;\n      attributes: {\n        latitude?: number;\n        longitude?: number;\n      };\n    }\n\n    // Use the history/period API via WebSocket\n    // The API returns a Record keyed by entity_id\n    const history = await hass.callWS<Record<string, HistoryState[]>>({\n      type: \"history/history_during_period\",\n      start_time: startTime.toISOString(),\n      end_time: endTime.toISOString(),\n      entity_ids: [entityId],\n      minimal_response: false,\n      significant_changes_only: false,\n    });\n\n    if (!history || !history[entityId]) {\n      return [];\n    }\n\n    const points: HistoryPoint[] = [];\n    const entityHistory = history[entityId];\n\n    for (const state of entityHistory) {\n      const lat = state.attributes?.latitude;\n      const lon = state.attributes?.longitude;\n\n      if (\n        typeof lat === \"number\" &&\n        typeof lon === \"number\" &&\n        !isNaN(lat) &&\n        !isNaN(lon)\n      ) {\n        points.push({\n          timestamp: new Date(state.last_changed),\n          latitude: lat,\n          longitude: lon,\n        });\n      }\n    }\n\n    // Sort by timestamp (oldest first)\n    points.sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n\n    return points;\n  } catch (error) {\n    console.warn(`Failed to fetch history for ${entityId}:`, error);\n    return [];\n  }\n}\n\n/**\n * Splits points into segments based on time gaps.\n * This prevents drawing lines across large gaps in data.\n */\nfunction splitByGaps(\n  points: HistoryPoint[],\n  maxGapMinutes: number\n): HistoryPoint[][] {\n  if (points.length === 0) return [];\n\n  const segments: HistoryPoint[][] = [];\n  let currentSegment: HistoryPoint[] = [points[0]];\n\n  for (let i = 1; i < points.length; i++) {\n    const gap =\n      (points[i].timestamp.getTime() - points[i - 1].timestamp.getTime()) /\n      (1000 * 60);\n\n    if (gap > maxGapMinutes) {\n      // Start a new segment\n      if (currentSegment.length > 1) {\n        segments.push(currentSegment);\n      }\n      currentSegment = [points[i]];\n    } else {\n      currentSegment.push(points[i]);\n    }\n  }\n\n  // Add the last segment\n  if (currentSegment.length > 1) {\n    segments.push(currentSegment);\n  }\n\n  return segments;\n}\n\n/**\n * Calculates opacity based on age of the point.\n * Newer points are more opaque, older points are more transparent.\n */\nfunction calculateOpacity(\n  timestamp: Date,\n  startTime: Date,\n  endTime: Date\n): number {\n  const totalRange = endTime.getTime() - startTime.getTime();\n  if (totalRange === 0) return 1;\n\n  const age = endTime.getTime() - timestamp.getTime();\n  const ageRatio = age / totalRange;\n\n  // Opacity ranges from 0.2 (oldest) to 0.8 (newest)\n  return 0.8 - ageRatio * 0.6;\n}\n\n/**\n * Creates gradient polyline segments for a trail.\n */\nfunction createGradientPolylines(\n  map: LeafletMap,\n  points: HistoryPoint[],\n  color: string,\n  weight: number,\n  hoursToShow: number\n): Polyline[] {\n  if (points.length < 2) return [];\n\n  const polylines: Polyline[] = [];\n  const endTime = new Date();\n  const startTime = new Date(endTime.getTime() - hoursToShow * 60 * 60 * 1000);\n\n  // Create segments with varying opacity\n  const segmentSize = Math.max(1, Math.floor(points.length / GRADIENT_SEGMENTS));\n\n  for (let i = 0; i < points.length - 1; i += segmentSize) {\n    const segmentEnd = Math.min(i + segmentSize + 1, points.length);\n    const segmentPoints = points.slice(i, segmentEnd);\n\n    if (segmentPoints.length < 2) continue;\n\n    const midPoint = segmentPoints[Math.floor(segmentPoints.length / 2)];\n    const opacity = calculateOpacity(midPoint.timestamp, startTime, endTime);\n\n    const latlngs: LatLngExpression[] = segmentPoints.map((p) => [\n      p.latitude,\n      p.longitude,\n    ]);\n\n    const polyline = L.polyline(latlngs, {\n      color: color,\n      weight: weight,\n      opacity: opacity,\n      lineCap: \"round\",\n      lineJoin: \"round\",\n    }).addTo(map);\n\n    polylines.push(polyline);\n  }\n\n  return polylines;\n}\n\n/**\n * Manages entity history trails on a Leaflet map.\n */\nexport class HistoryTrailManager {\n  private _map: LeafletMap;\n  private _config: ABCEmergencyMapCardConfig;\n  private _polylines: Map<string, Polyline[]> = new Map();\n  private _lastFetch = 0;\n  private _fetchTimeout?: number;\n  private _cachedHistory: Map<string, EntityHistoryData> = new Map();\n\n  constructor(map: LeafletMap, config: ABCEmergencyMapCardConfig) {\n    this._map = map;\n    this._config = config;\n  }\n\n  /**\n   * Updates the configuration.\n   */\n  public updateConfig(config: ABCEmergencyMapCardConfig): void {\n    this._config = config;\n  }\n\n  /**\n   * Updates history trails for the given entities.\n   */\n  public async updateTrails(\n    hass: HomeAssistant,\n    entityIds: string[]\n  ): Promise<void> {\n    // Check if history is enabled\n    const showHistory = this._config.show_history ?? DEFAULT_SHOW_HISTORY;\n    if (!showHistory) {\n      this.clear();\n      return;\n    }\n\n    // Determine which entities to show history for\n    const historyEntities = this._config.history_entities ?? entityIds;\n    const entitiesToShow = historyEntities.filter((id) => {\n      const domain = getDomain(id);\n      return isLocationDomain(domain);\n    });\n\n    // Debounce fetches\n    const now = Date.now();\n    if (now - this._lastFetch < FETCH_DEBOUNCE_MS) {\n      // Schedule a delayed fetch if not already scheduled\n      if (!this._fetchTimeout) {\n        this._fetchTimeout = window.setTimeout(() => {\n          this._fetchTimeout = undefined;\n          this.updateTrails(hass, entityIds);\n        }, FETCH_DEBOUNCE_MS);\n      }\n      return;\n    }\n    this._lastFetch = now;\n\n    // Clear scheduled fetch\n    if (this._fetchTimeout) {\n      window.clearTimeout(this._fetchTimeout);\n      this._fetchTimeout = undefined;\n    }\n\n    const hoursToShow = this._config.hours_to_show ?? DEFAULT_HOURS_TO_SHOW;\n    const weight = this._config.history_line_weight ?? DEFAULT_HISTORY_LINE_WEIGHT;\n\n    // Remove trails for entities no longer being shown\n    const currentIds = new Set(entitiesToShow);\n    for (const entityId of this._polylines.keys()) {\n      if (!currentIds.has(entityId)) {\n        this._removeTrail(entityId);\n      }\n    }\n\n    // Fetch and render trails for each entity\n    for (const entityId of entitiesToShow) {\n      const domain = getDomain(entityId) as MarkerEntityDomain;\n      const color = DOMAIN_COLORS[domain] || \"#888888\";\n\n      const points = await fetchEntityHistory(hass, entityId, hoursToShow);\n\n      if (points.length < 2) {\n        this._removeTrail(entityId);\n        continue;\n      }\n\n      // Cache the history data\n      this._cachedHistory.set(entityId, { entityId, color, points });\n\n      // Remove existing polylines for this entity\n      this._removeTrail(entityId);\n\n      // Split by gaps and render\n      const segments = splitByGaps(points, MAX_GAP_MINUTES);\n\n      const polylines: Polyline[] = [];\n      for (const segment of segments) {\n        const segmentPolylines = createGradientPolylines(\n          this._map,\n          segment,\n          color,\n          weight,\n          hoursToShow\n        );\n        polylines.push(...segmentPolylines);\n      }\n\n      this._polylines.set(entityId, polylines);\n    }\n  }\n\n  /**\n   * Removes a trail for a specific entity.\n   */\n  private _removeTrail(entityId: string): void {\n    const polylines = this._polylines.get(entityId);\n    if (polylines) {\n      for (const polyline of polylines) {\n        polyline.remove();\n      }\n      this._polylines.delete(entityId);\n    }\n  }\n\n  /**\n   * Gets all trail positions for bounds calculation.\n   */\n  public getTrailPositions(): [number, number][] {\n    const positions: [number, number][] = [];\n    for (const history of this._cachedHistory.values()) {\n      for (const point of history.points) {\n        positions.push([point.latitude, point.longitude]);\n      }\n    }\n    return positions;\n  }\n\n  /**\n   * Gets the number of active trails.\n   */\n  public get trailCount(): number {\n    return this._polylines.size;\n  }\n\n  /**\n   * Removes all trails from the map.\n   */\n  public clear(): void {\n    for (const entityId of this._polylines.keys()) {\n      this._removeTrail(entityId);\n    }\n    this._polylines.clear();\n    this._cachedHistory.clear();\n  }\n\n  /**\n   * Cleans up resources.\n   */\n  public destroy(): void {\n    if (this._fetchTimeout) {\n      window.clearTimeout(this._fetchTimeout);\n      this._fetchTimeout = undefined;\n    }\n    this.clear();\n  }\n}\n","/**\n * Incident Polygon Manager\n *\n * Renders ABC Emergency incident polygons from GeoJSON data\n * with Australian Warning System colors.\n */\n\nimport type { HomeAssistant } from \"custom-card-helpers\";\nimport type { HassEntity } from \"home-assistant-js-websocket\";\nimport type {\n  Map as LeafletMap,\n  GeoJSON as LeafletGeoJSON,\n  Layer,\n  PathOptions,\n  LatLngBounds,\n} from \"leaflet\";\nimport type { ABCEmergencyMapCardConfig, EmergencyIncident } from \"./types\";\nimport {\n  getAlertColor,\n  DEFAULT_ANIMATIONS_ENABLED,\n  DEFAULT_ANIMATION_DURATION,\n  DEFAULT_GEOMETRY_TRANSITIONS,\n  DEFAULT_TRANSITION_DURATION,\n} from \"./types\";\n\n\n/** Default polygon fill opacity */\nconst DEFAULT_FILL_OPACITY = 0.35;\n\n/** Default polygon stroke opacity */\nconst DEFAULT_STROKE_OPACITY = 0.8;\n\n/** Default polygon stroke weight */\nconst DEFAULT_STROKE_WEIGHT = 2;\n\n/**\n * GeoJSON geometry types we support\n */\ntype SupportedGeometryType = \"Polygon\" | \"MultiPolygon\" | \"Point\";\n\n/**\n * GeoJSON geometry object\n */\ninterface GeoJSONGeometry {\n  type: SupportedGeometryType;\n  coordinates: number[] | number[][] | number[][][] | number[][][][];\n}\n\n/**\n * GeoJSON Feature object\n */\ninterface GeoJSONFeature {\n  type: \"Feature\";\n  geometry: GeoJSONGeometry;\n  properties: Record<string, unknown>;\n}\n\n/**\n * Extracts incident data from a Home Assistant entity.\n */\nfunction extractIncidentData(\n  entityId: string,\n  entity: HassEntity\n): EmergencyIncident | null {\n  const attrs = entity.attributes;\n\n  // Get coordinates - required for map placement\n  const lat = attrs.latitude;\n  const lon = attrs.longitude;\n\n  if (\n    typeof lat !== \"number\" ||\n    typeof lon !== \"number\" ||\n    isNaN(lat) ||\n    isNaN(lon)\n  ) {\n    return null;\n  }\n\n  // Determine alert level with fallback\n  const alertLevel = (attrs.alert_level as string)?.toLowerCase() || \"minor\";\n  const validLevels = [\"extreme\", \"severe\", \"moderate\", \"minor\"];\n  const normalizedLevel = validLevels.includes(alertLevel)\n    ? (alertLevel as EmergencyIncident[\"alert_level\"])\n    : \"minor\";\n\n  return {\n    id: entityId,\n    headline: (attrs.friendly_name as string) || entityId,\n    latitude: lat,\n    longitude: lon,\n    alert_level: normalizedLevel,\n    alert_text: (attrs.alert_text as string) || \"\",\n    event_type: (attrs.event_type as string) || \"unknown\",\n    has_polygon: !!attrs.geojson || !!attrs.geometry,\n    geometry_type: attrs.geometry_type as string | undefined,\n    last_updated: entity.last_updated || entity.last_changed,\n    external_link: (attrs.external_link as string) ||\n      (attrs.link as string) ||\n      (attrs.url as string) ||\n      undefined,\n  };\n}\n\n/**\n * Formats a timestamp as a relative time string (e.g., \"2 mins ago\").\n */\nfunction formatRelativeTime(timestamp: string | undefined): string {\n  if (!timestamp) return \"\";\n\n  const date = new Date(timestamp);\n  if (isNaN(date.getTime())) return \"\";\n\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffMins = Math.floor(diffMs / (1000 * 60));\n  const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n  if (diffMins < 1) return \"Just now\";\n  if (diffMins === 1) return \"1 min ago\";\n  if (diffMins < 60) return `${diffMins} mins ago`;\n  if (diffHours === 1) return \"1 hour ago\";\n  if (diffHours < 24) return `${diffHours} hours ago`;\n  if (diffDays === 1) return \"1 day ago\";\n  return `${diffDays} days ago`;\n}\n\n/**\n * Extracts GeoJSON geometry from entity attributes.\n * Handles both 'geojson' and 'geometry' attribute formats.\n */\nfunction extractGeoJSON(entity: HassEntity): GeoJSONGeometry | null {\n  const attrs = entity.attributes;\n\n  // Try 'geojson' attribute first (preferred format)\n  if (attrs.geojson) {\n    const geojson = attrs.geojson as unknown;\n    if (isValidGeometry(geojson)) {\n      return geojson;\n    }\n  }\n\n  // Try 'geometry' attribute as fallback\n  if (attrs.geometry) {\n    const geometry = attrs.geometry as unknown;\n    if (isValidGeometry(geometry)) {\n      return geometry;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Type guard to check if an object is a valid GeoJSON geometry.\n */\nfunction isValidGeometry(obj: unknown): obj is GeoJSONGeometry {\n  if (!obj || typeof obj !== \"object\") return false;\n\n  const geo = obj as Record<string, unknown>;\n\n  if (typeof geo.type !== \"string\") return false;\n  if (!Array.isArray(geo.coordinates)) return false;\n\n  const validTypes = [\"Polygon\", \"MultiPolygon\", \"Point\"];\n  return validTypes.includes(geo.type);\n}\n\n/**\n * Gets the style for a polygon based on its alert level.\n * @param alertLevel - The alert level (extreme, severe, moderate, minor)\n * @param config - Optional card configuration for custom colors\n */\nfunction getPolygonStyle(alertLevel: string, config?: ABCEmergencyMapCardConfig): PathOptions {\n  const color = getAlertColor(alertLevel, config);\n\n  return {\n    color: color,\n    weight: DEFAULT_STROKE_WEIGHT,\n    opacity: DEFAULT_STROKE_OPACITY,\n    fillColor: color,\n    fillOpacity: DEFAULT_FILL_OPACITY,\n  };\n}\n\n/**\n * Creates a GeoJSON Feature from incident data and geometry.\n */\nfunction createFeature(\n  incident: EmergencyIncident,\n  geometry: GeoJSONGeometry\n): GeoJSONFeature {\n  return {\n    type: \"Feature\",\n    geometry: geometry,\n    properties: {\n      id: incident.id,\n      headline: incident.headline,\n      alert_level: incident.alert_level,\n      event_type: incident.event_type,\n      alert_text: incident.alert_text,\n    },\n  };\n}\n\n/**\n * Checks if an entity has GeoJSON/polygon data that can be rendered as a polygon.\n * Point-only geometry returns false since those are rendered as markers instead.\n */\nexport function hasPolygonData(entity: HassEntity): boolean {\n  const attrs = entity.attributes;\n  const geojson = attrs.geojson || attrs.geometry;\n  if (!geojson) return false;\n\n  // Check geometry type - only true polygon types should be rendered by polygon manager\n  // Point geometry is handled by the marker system instead\n  const geometryType = (geojson as { type?: string }).type ||\n    (attrs.geometry_type as string);\n\n  return geometryType === \"Polygon\" ||\n    geometryType === \"MultiPolygon\" ||\n    geometryType === \"GeometryCollection\";\n}\n\n/**\n * Severity order for layering: lower index = rendered first (bottom)\n * Most severe (extreme) is last = rendered on top\n */\nconst SEVERITY_ORDER: Record<string, number> = {\n  minor: 0,\n  moderate: 1,\n  severe: 2,\n  extreme: 3,\n};\n\n/**\n * Gets the sort order for a severity level.\n */\nfunction getSeverityOrder(alertLevel: string): number {\n  return SEVERITY_ORDER[alertLevel] ?? 0;\n}\n\n/**\n * Manages incident polygon rendering on a Leaflet map.\n */\nexport class IncidentPolygonManager {\n  private _map: LeafletMap;\n  private _config: ABCEmergencyMapCardConfig;\n  private _layers: Map<string, LeafletGeoJSON> = new Map();\n  private _incidents: Map<string, EmergencyIncident> = new Map();\n  /** Track last known hash of each incident for change detection */\n  private _incidentHashes: Map<string, string> = new Map();\n  /** Track known entity IDs to detect new incidents */\n  private _knownEntityIds: Set<string> = new Set();\n  /** Track previous geometry for smooth transitions */\n  private _previousGeometries: Map<string, GeoJSONGeometry> = new Map();\n  /** Track active geometry transitions (animation frame IDs) */\n  private _activeTransitions: Map<string, number> = new Map();\n\n  constructor(map: LeafletMap, config: ABCEmergencyMapCardConfig) {\n    this._map = map;\n    this._config = config;\n  }\n\n  /**\n   * Creates a hash of incident data for change detection.\n   */\n  private _hashIncident(incident: EmergencyIncident): string {\n    return `${incident.alert_level}|${incident.headline}|${incident.alert_text}|${incident.last_updated}`;\n  }\n\n  /**\n   * Checks if animations are enabled.\n   */\n  private _animationsEnabled(): boolean {\n    return this._config.animations_enabled ?? DEFAULT_ANIMATIONS_ENABLED;\n  }\n\n  /**\n   * Gets the animation duration in seconds.\n   */\n  private _getAnimationDuration(): string {\n    const ms = this._config.animation_duration ?? DEFAULT_ANIMATION_DURATION;\n    return `${ms / 1000}s`;\n  }\n\n  /**\n   * Checks if geometry transitions are enabled.\n   */\n  private _geometryTransitionsEnabled(): boolean {\n    return this._config.geometry_transitions ?? DEFAULT_GEOMETRY_TRANSITIONS;\n  }\n\n  /**\n   * Gets the transition duration in milliseconds.\n   */\n  private _getTransitionDurationMs(): number {\n    return this._config.transition_duration ?? DEFAULT_TRANSITION_DURATION;\n  }\n\n  /**\n   * Creates a hash of geometry coordinates for change detection.\n   */\n  private _hashGeometry(geometry: GeoJSONGeometry): string {\n    return JSON.stringify(geometry.coordinates);\n  }\n\n  /**\n   * Checks if geometry has changed.\n   */\n  private _hasGeometryChanged(entityId: string, newGeometry: GeoJSONGeometry): boolean {\n    const oldGeometry = this._previousGeometries.get(entityId);\n    if (!oldGeometry) return false;\n    return this._hashGeometry(oldGeometry) !== this._hashGeometry(newGeometry);\n  }\n\n  /**\n   * Interpolates between two coordinate arrays.\n   * Handles different array lengths by resampling.\n   */\n  private _interpolateCoordinates(\n    from: number[][],\n    to: number[][],\n    t: number\n  ): number[][] {\n    // Normalize to same length by resampling the shorter array\n    const maxLen = Math.max(from.length, to.length);\n    const normalizedFrom = this._resampleCoordinates(from, maxLen);\n    const normalizedTo = this._resampleCoordinates(to, maxLen);\n\n    // Linear interpolation between corresponding points\n    return normalizedFrom.map((fromPoint, i) => {\n      const toPoint = normalizedTo[i];\n      return [\n        fromPoint[0] + (toPoint[0] - fromPoint[0]) * t,\n        fromPoint[1] + (toPoint[1] - fromPoint[1]) * t,\n      ];\n    });\n  }\n\n  /**\n   * Resamples a coordinate array to a target length.\n   * Uses linear interpolation along the path.\n   */\n  private _resampleCoordinates(coords: number[][], targetLength: number): number[][] {\n    if (coords.length === 0) return [];\n    if (coords.length === targetLength) return coords;\n    if (coords.length === 1) {\n      // Repeat single point\n      return Array(targetLength).fill(coords[0]);\n    }\n\n    const result: number[][] = [];\n    const totalLength = coords.length - 1;\n\n    for (let i = 0; i < targetLength; i++) {\n      const t = (i / (targetLength - 1)) * totalLength;\n      const index = Math.floor(t);\n      const frac = t - index;\n\n      if (index >= totalLength) {\n        result.push(coords[totalLength]);\n      } else {\n        const p1 = coords[index];\n        const p2 = coords[index + 1];\n        result.push([\n          p1[0] + (p2[0] - p1[0]) * frac,\n          p1[1] + (p2[1] - p1[1]) * frac,\n        ]);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Interpolates between two geometry objects.\n   * Supports Polygon and MultiPolygon types.\n   */\n  private _interpolateGeometry(\n    from: GeoJSONGeometry,\n    to: GeoJSONGeometry,\n    t: number\n  ): GeoJSONGeometry {\n    // Only interpolate if types match\n    if (from.type !== to.type) {\n      return t < 0.5 ? from : to;\n    }\n\n    if (from.type === \"Polygon\" && to.type === \"Polygon\") {\n      const fromRings = from.coordinates as number[][][];\n      const toRings = to.coordinates as number[][][];\n      const maxRings = Math.max(fromRings.length, toRings.length);\n\n      const interpolatedRings: number[][][] = [];\n      for (let i = 0; i < maxRings; i++) {\n        const fromRing = fromRings[i] || fromRings[0] || [];\n        const toRing = toRings[i] || toRings[0] || [];\n        interpolatedRings.push(this._interpolateCoordinates(fromRing, toRing, t));\n      }\n\n      return {\n        type: \"Polygon\",\n        coordinates: interpolatedRings,\n      };\n    }\n\n    if (from.type === \"MultiPolygon\" && to.type === \"MultiPolygon\") {\n      const fromPolygons = from.coordinates as number[][][][];\n      const toPolygons = to.coordinates as number[][][][];\n      const maxPolygons = Math.max(fromPolygons.length, toPolygons.length);\n\n      const interpolatedPolygons: number[][][][] = [];\n      for (let i = 0; i < maxPolygons; i++) {\n        const fromPoly = fromPolygons[i] || fromPolygons[0] || [[]];\n        const toPoly = toPolygons[i] || toPolygons[0] || [[]];\n        const maxRings = Math.max(fromPoly.length, toPoly.length);\n\n        const interpolatedRings: number[][][] = [];\n        for (let j = 0; j < maxRings; j++) {\n          const fromRing = fromPoly[j] || fromPoly[0] || [];\n          const toRing = toPoly[j] || toPoly[0] || [];\n          interpolatedRings.push(this._interpolateCoordinates(fromRing, toRing, t));\n        }\n        interpolatedPolygons.push(interpolatedRings);\n      }\n\n      return {\n        type: \"MultiPolygon\",\n        coordinates: interpolatedPolygons,\n      };\n    }\n\n    // For Point or unsupported types, just switch at midpoint\n    return t < 0.5 ? from : to;\n  }\n\n  /**\n   * Animates a geometry transition using requestAnimationFrame.\n   */\n  private _animateGeometryTransition(\n    entityId: string,\n    incident: EmergencyIncident,\n    fromGeometry: GeoJSONGeometry,\n    toGeometry: GeoJSONGeometry,\n    style: PathOptions\n  ): void {\n    // Cancel any existing transition for this entity\n    const existingTransition = this._activeTransitions.get(entityId);\n    if (existingTransition) {\n      cancelAnimationFrame(existingTransition);\n    }\n\n    const duration = this._getTransitionDurationMs();\n    const startTime = performance.now();\n    const layer = this._layers.get(entityId);\n\n    if (!layer) return;\n\n    const animate = (currentTime: number) => {\n      const elapsed = currentTime - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n\n      // Easing function (ease-out cubic)\n      const t = 1 - Math.pow(1 - progress, 3);\n\n      // Interpolate geometry\n      const interpolatedGeometry = this._interpolateGeometry(fromGeometry, toGeometry, t);\n      const feature = createFeature(incident, interpolatedGeometry);\n\n      // Update layer with interpolated geometry\n      layer.clearLayers();\n      layer.addData(feature as GeoJSON.Feature);\n      layer.setStyle(style);\n\n      if (progress < 1) {\n        // Continue animation\n        const frameId = requestAnimationFrame(animate);\n        this._activeTransitions.set(entityId, frameId);\n      } else {\n        // Animation complete - clean up\n        this._activeTransitions.delete(entityId);\n        // Store final geometry\n        this._previousGeometries.set(entityId, toGeometry);\n      }\n    };\n\n    // Start animation\n    const frameId = requestAnimationFrame(animate);\n    this._activeTransitions.set(entityId, frameId);\n  }\n\n  /**\n   * Updates the configuration.\n   */\n  public updateConfig(config: ABCEmergencyMapCardConfig): void {\n    this._config = config;\n  }\n\n  /**\n   * Updates polygons for the specified entity IDs.\n   * Only renders polygons for entities that have GeoJSON/geometry data.\n   * Polygons are layered by severity: least severe (minor) at bottom, most severe (extreme) on top.\n   */\n  public updatePolygonsForEntities(hass: HomeAssistant, entityIds: string[]): void {\n    console.log(\"ABC Emergency Map: updatePolygonsForEntities called with\", entityIds.length, \"entities\");\n    const currentIds = new Set(entityIds);\n\n    // Remove layers for entities that are no longer tracked\n    for (const [entityId, layer] of this._layers) {\n      if (!currentIds.has(entityId)) {\n        layer.remove();\n        this._layers.delete(entityId);\n        this._incidents.delete(entityId);\n      }\n    }\n\n    // First pass: collect all incidents with polygon data\n    const incidentsToRender: Array<{\n      entityId: string;\n      entity: HassEntity;\n      incident: EmergencyIncident;\n      geometry: GeoJSONGeometry;\n      isNew: boolean;\n      isUpdated: boolean;\n    }> = [];\n\n    for (const entityId of entityIds) {\n      const entity = hass.states[entityId];\n      if (!entity) {\n        console.log(\"ABC Emergency Map: Entity not found:\", entityId);\n        continue;\n      }\n\n      // Debug: Show entity attributes\n      console.log(\"ABC Emergency Map: Entity\", entityId, \"attributes:\", {\n        has_polygon: entity.attributes.has_polygon,\n        geometry_type: entity.attributes.geometry_type,\n        hasGeojson: !!entity.attributes.geojson,\n        hasGeometry: !!entity.attributes.geometry,\n      });\n\n      // Only process entities that have polygon/geometry data\n      if (!hasPolygonData(entity)) {\n        console.log(\"ABC Emergency Map: No polygon data for\", entityId);\n        continue;\n      }\n\n      const incident = extractIncidentData(entityId, entity);\n      if (!incident) continue;\n\n      const geometry = extractGeoJSON(entity);\n      if (!geometry) {\n        console.log(\"ABC Emergency Map: No geometry extracted for\", entityId);\n        // Remove polygon layer if geometry was removed\n        const existingLayer = this._layers.get(entityId);\n        if (existingLayer) {\n          existingLayer.remove();\n          this._layers.delete(entityId);\n        }\n        continue;\n      }\n\n      // Detect new vs updated for animation\n      const isNew = !this._knownEntityIds.has(entityId);\n      const currentHash = this._hashIncident(incident);\n      const previousHash = this._incidentHashes.get(entityId);\n      const isUpdated = !isNew && previousHash !== currentHash;\n\n      // Update tracking state\n      this._incidents.set(entityId, incident);\n      this._incidentHashes.set(entityId, currentHash);\n      this._knownEntityIds.add(entityId);\n\n      incidentsToRender.push({\n        entityId,\n        entity,\n        incident,\n        geometry,\n        isNew,\n        isUpdated,\n      });\n    }\n\n    // Sort by severity: minor (0) first (bottom), extreme (3) last (top)\n    incidentsToRender.sort((a, b) => {\n      return getSeverityOrder(a.incident.alert_level) - getSeverityOrder(b.incident.alert_level);\n    });\n\n    console.log(\"ABC Emergency Map: Rendering order (bottom to top):\",\n      incidentsToRender.map(i => `${i.entityId} (${i.incident.alert_level})`));\n\n    // Second pass: render in severity order\n    // Remove all existing layers first to ensure correct z-order\n    for (const item of incidentsToRender) {\n      const existingLayer = this._layers.get(item.entityId);\n      if (existingLayer) {\n        existingLayer.remove();\n        this._layers.delete(item.entityId);\n      }\n    }\n\n    // Re-add in sorted order (first added = bottom, last added = top)\n    for (const item of incidentsToRender) {\n      console.log(\"ABC Emergency Map: Rendering polygon for\", item.entityId,\n        \"severity:\", item.incident.alert_level, \"type:\", item.geometry.type);\n      this._updatePolygonLayer(item.entityId, item.incident, item.geometry, item.isNew, item.isUpdated);\n    }\n\n    console.log(\"ABC Emergency Map: Polygon rendering complete.\",\n      incidentsToRender.length, \"entities with polygon data,\",\n      this._layers.size, \"layers rendered\");\n  }\n\n  /**\n   * Updates or creates a polygon layer for an incident.\n   */\n  private _updatePolygonLayer(\n    entityId: string,\n    incident: EmergencyIncident,\n    geometry: GeoJSONGeometry,\n    isNew: boolean = false,\n    isUpdated: boolean = false\n  ): void {\n    const existingLayer = this._layers.get(entityId);\n    const feature = createFeature(incident, geometry);\n    const style = getPolygonStyle(incident.alert_level, this._config);\n\n    // Check if geometry has changed for smooth transitions\n    const geometryChanged = this._hasGeometryChanged(entityId, geometry);\n    const previousGeometry = this._previousGeometries.get(entityId);\n\n    if (existingLayer) {\n      // Check if we should animate the geometry transition\n      if (\n        geometryChanged &&\n        previousGeometry &&\n        this._geometryTransitionsEnabled() &&\n        geometry.type !== \"Point\"\n      ) {\n        // Animate transition from old geometry to new\n        this._animateGeometryTransition(\n          entityId,\n          incident,\n          previousGeometry,\n          geometry,\n          style\n        );\n\n        // Apply update animation alongside geometry transition\n        if (isUpdated) {\n          this._applyAnimation(existingLayer, incident, \"updated\");\n        }\n      } else {\n        // Update immediately without transition\n        existingLayer.clearLayers();\n        existingLayer.addData(feature as GeoJSON.Feature);\n        existingLayer.setStyle(style);\n\n        // Store current geometry for future transitions\n        this._previousGeometries.set(entityId, geometry);\n\n        // Apply update animation if data changed\n        if (isUpdated) {\n          this._applyAnimation(existingLayer, incident, \"updated\");\n        }\n      }\n    } else {\n      // Create new GeoJSON layer\n      console.log(\"ABC Emergency Map: Creating GeoJSON layer for\", entityId);\n      console.log(\"ABC Emergency Map: Feature:\", JSON.stringify(feature, null, 2));\n      console.log(\"ABC Emergency Map: Style:\", style);\n\n      try {\n        const layer = L.geoJSON(feature as GeoJSON.Feature, {\n          style: () => style,\n          onEachFeature: (_feat, lyr) => {\n            this._bindPopup(lyr, incident);\n          },\n        }).addTo(this._map);\n\n        console.log(\"ABC Emergency Map: Layer created, bounds:\", layer.getBounds());\n\n        this._layers.set(entityId, layer);\n\n        // Store initial geometry for future transitions\n        this._previousGeometries.set(entityId, geometry);\n\n        // Apply new incident animation\n        if (isNew) {\n          this._applyAnimation(layer, incident, \"new\");\n        }\n      } catch (error) {\n        console.error(\"ABC Emergency Map: Error creating GeoJSON layer:\", error);\n      }\n    }\n\n    // Apply persistent extreme animation for emergency warnings\n    if (incident.alert_level === \"extreme\") {\n      const layer = this._layers.get(entityId);\n      if (layer) {\n        this._applyAnimation(layer, incident, \"extreme\");\n      }\n    }\n  }\n\n  /**\n   * Binds a popup to a polygon layer.\n   */\n  private _bindPopup(layer: Layer, incident: EmergencyIncident): void {\n    const alertColor = getAlertColor(incident.alert_level, this._config);\n    const alertLabel = this._getAlertLabel(incident.alert_level);\n    const relativeTime = formatRelativeTime(incident.last_updated);\n\n    // Build popup content with all available information\n    const typeInfo = incident.event_type && incident.event_type !== \"unknown\"\n      ? `<div class=\"incident-popup-row\"><span class=\"incident-popup-label\">Type:</span> ${this._escapeHtml(incident.event_type)}</div>`\n      : \"\";\n\n    const timeInfo = relativeTime\n      ? `<div class=\"incident-popup-row\"><span class=\"incident-popup-label\">Updated:</span> ${relativeTime}</div>`\n      : \"\";\n\n    const adviceInfo = incident.alert_text\n      ? `<div class=\"incident-popup-advice\">${this._escapeHtml(incident.alert_text)}</div>`\n      : \"\";\n\n    const linkInfo = incident.external_link\n      ? `<div class=\"incident-popup-link\"><a href=\"${this._escapeHtml(incident.external_link)}\" target=\"_blank\" rel=\"noopener noreferrer\">More Info </a></div>`\n      : \"\";\n\n    // Create unique ID for ARIA labelling\n    const popupId = `incident-popup-${incident.id.replace(/[^a-zA-Z0-9]/g, \"-\")}`;\n\n    const content = `\n      <article class=\"incident-popup\" role=\"dialog\" aria-labelledby=\"${popupId}-title\">\n        <header class=\"incident-popup-header\" style=\"border-left: 4px solid ${alertColor}; padding-left: 8px;\">\n          <h3 id=\"${popupId}-title\" class=\"incident-popup-title\">${this._escapeHtml(incident.headline)}</h3>\n        </header>\n        <div class=\"incident-popup-body\">\n          <div class=\"incident-alert-badge\" style=\"background: ${alertColor}; color: ${this._getContrastColor(alertColor)};\" role=\"status\" aria-label=\"Alert level: ${alertLabel}\">\n            <span aria-hidden=\"true\">${alertLabel}</span>\n          </div>\n          ${typeInfo}\n          ${timeInfo}\n          ${adviceInfo}\n          ${linkInfo}\n        </div>\n      </article>\n    `;\n\n    (layer as Layer & { bindPopup: (content: string, options?: object) => void }).bindPopup(\n      content,\n      {\n        maxWidth: 300,\n        minWidth: 200,\n        className: \"incident-popup-container\",\n      }\n    );\n  }\n\n  /**\n   * Escapes HTML special characters to prevent XSS.\n   */\n  private _escapeHtml(text: string): string {\n    const div = document.createElement(\"div\");\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  /**\n   * Returns black or white text color based on background luminance.\n   */\n  private _getContrastColor(hexColor: string): string {\n    // Remove # if present\n    const hex = hexColor.replace(\"#\", \"\");\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n\n    // Calculate relative luminance\n    const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;\n\n    return luminance > 0.5 ? \"#000000\" : \"#ffffff\";\n  }\n\n  /**\n   * Gets a human-readable label for an alert level.\n   */\n  private _getAlertLabel(alertLevel: string): string {\n    const labels: Record<string, string> = {\n      extreme: \"Emergency Warning\",\n      severe: \"Watch and Act\",\n      moderate: \"Advice\",\n      minor: \"Information\",\n    };\n    return labels[alertLevel] || \"Information\";\n  }\n\n  /**\n   * Applies animation to a GeoJSON layer.\n   */\n  private _applyAnimation(\n    layer: LeafletGeoJSON,\n    incident: EmergencyIncident,\n    animationType: \"new\" | \"updated\" | \"extreme\"\n  ): void {\n    if (!this._animationsEnabled()) {\n      return;\n    }\n\n    // Get the underlying SVG path elements from the layer\n    layer.eachLayer((sublayer) => {\n      const element = (sublayer as Layer & { getElement?: () => HTMLElement | undefined }).getElement?.();\n      if (element) {\n        this._applyAnimationToElement(element, incident, animationType);\n      }\n    });\n  }\n\n  /**\n   * Applies animation classes and styles to an SVG element.\n   */\n  private _applyAnimationToElement(\n    element: HTMLElement,\n    incident: EmergencyIncident,\n    animationType: \"new\" | \"updated\" | \"extreme\"\n  ): void {\n    // Set CSS custom properties for animation\n    const alertColor = getAlertColor(incident.alert_level, this._config);\n    element.style.setProperty(\"--incident-glow-color\", `${alertColor}80`);\n    element.style.setProperty(\"--incident-animation-duration\", this._getAnimationDuration());\n\n    // Remove any existing animation classes\n    element.classList.remove(\n      \"incident-layer-new\",\n      \"incident-layer-updated\",\n      \"incident-layer-extreme\"\n    );\n\n    // Add appropriate animation class\n    switch (animationType) {\n      case \"new\":\n        element.classList.add(\"incident-layer-new\");\n        break;\n      case \"updated\":\n        element.classList.add(\"incident-layer-updated\");\n        break;\n      case \"extreme\":\n        element.classList.add(\"incident-layer-extreme\");\n        break;\n    }\n  }\n\n  /**\n   * Gets all polygon bounds for map fitting.\n   */\n  public getPolygonBounds(): LatLngBounds | null {\n    if (this._layers.size === 0) {\n      return null;\n    }\n\n    let combinedBounds: LatLngBounds | null = null;\n\n    for (const layer of this._layers.values()) {\n      const bounds = layer.getBounds();\n      if (bounds.isValid()) {\n        if (combinedBounds) {\n          combinedBounds.extend(bounds);\n        } else {\n          combinedBounds = bounds;\n        }\n      }\n    }\n\n    return combinedBounds;\n  }\n\n  /**\n   * Gets all incident center positions for bounds calculation.\n   */\n  public getIncidentPositions(): [number, number][] {\n    const positions: [number, number][] = [];\n    for (const incident of this._incidents.values()) {\n      positions.push([incident.latitude, incident.longitude]);\n    }\n    return positions;\n  }\n\n  /**\n   * Gets the number of active incident polygons.\n   */\n  public get polygonCount(): number {\n    return this._layers.size;\n  }\n\n  /**\n   * Gets the total number of incidents (with or without polygons).\n   */\n  public get incidentCount(): number {\n    return this._incidents.size;\n  }\n\n  /**\n   * Removes all incident layers from the map.\n   */\n  public clear(): void {\n    // Cancel any active geometry transitions\n    for (const frameId of this._activeTransitions.values()) {\n      cancelAnimationFrame(frameId);\n    }\n    this._activeTransitions.clear();\n\n    for (const layer of this._layers.values()) {\n      layer.remove();\n    }\n    this._layers.clear();\n    this._incidents.clear();\n    this._incidentHashes.clear();\n    this._knownEntityIds.clear();\n    this._previousGeometries.clear();\n  }\n\n  /**\n   * Cleans up resources.\n   */\n  public destroy(): void {\n    this.clear();\n  }\n}\n","/**\n * Card Editor for ABC Emergency Map Card\n *\n * Provides a visual configuration interface for the card in the Lovelace UI.\n */\n\nimport { LitElement, html, css, TemplateResult, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport type { HomeAssistant } from \"custom-card-helpers\";\nimport type {\n  ABCEmergencyMapCardConfig,\n  TileProviderId,\n  DarkModeSetting,\n  AlertColorPreset,\n  AlertLevel,\n  ConfigWarning,\n} from \"./types\";\nimport { ALERT_COLOR_PRESETS, ALERT_COLORS, validateVisibilityConfig } from \"./types\";\n\n/** Available tile provider options */\nconst TILE_PROVIDERS: { value: TileProviderId; label: string }[] = [\n  { value: \"osm\", label: \"OpenStreetMap\" },\n  { value: \"cartodb\", label: \"CartoDB\" },\n  { value: \"mapbox\", label: \"Mapbox (requires API key)\" },\n  { value: \"custom\", label: \"Custom URL\" },\n];\n\n/** Dark mode setting options */\nconst DARK_MODE_OPTIONS: { value: DarkModeSetting; label: string }[] = [\n  { value: \"auto\", label: \"Auto (from Home Assistant)\" },\n  { value: \"light\", label: \"Always Light\" },\n  { value: \"dark\", label: \"Always Dark\" },\n];\n\n/** Alert color preset options */\nconst ALERT_COLOR_PRESET_OPTIONS: { value: AlertColorPreset | \"custom\"; label: string }[] = [\n  { value: \"australian\", label: \"Australian Warning System (Default)\" },\n  { value: \"us_nws\", label: \"US National Weather Service\" },\n  { value: \"eu_meteo\", label: \"European Meteorological\" },\n  { value: \"high_contrast\", label: \"High Contrast (Accessibility)\" },\n  { value: \"custom\", label: \"Custom Colors\" },\n];\n\n/** Alert level labels for the color editor */\nconst ALERT_LEVEL_LABELS: { level: AlertLevel; label: string }[] = [\n  { level: \"extreme\", label: \"Emergency Warning\" },\n  { level: \"severe\", label: \"Watch and Act\" },\n  { level: \"moderate\", label: \"Advice\" },\n  { level: \"minor\", label: \"Information\" },\n];\n\n@customElement(\"abc-emergency-map-card-editor\")\nexport class ABCEmergencyMapCardEditor extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n  @state() private _config?: ABCEmergencyMapCardConfig;\n\n  static styles = css`\n    .editor-container {\n      padding: 16px;\n    }\n\n    .section {\n      margin-bottom: 24px;\n    }\n\n    .section-title {\n      font-weight: 500;\n      margin-bottom: 12px;\n      color: var(--primary-text-color);\n      border-bottom: 1px solid var(--divider-color);\n      padding-bottom: 8px;\n    }\n\n    .form-row {\n      margin-bottom: 16px;\n    }\n\n    .form-row-inline {\n      display: flex;\n      gap: 16px;\n      margin-bottom: 16px;\n    }\n\n    .form-row-inline > * {\n      flex: 1;\n    }\n\n    ha-textfield,\n    ha-select {\n      width: 100%;\n    }\n\n    ha-entity-picker {\n      width: 100%;\n    }\n\n    .toggle-row {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 8px 0;\n    }\n\n    .toggle-label {\n      font-size: 14px;\n    }\n\n    .toggle-description {\n      font-size: 12px;\n      color: var(--secondary-text-color);\n    }\n\n    .slider-row {\n      margin-bottom: 16px;\n    }\n\n    .slider-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 8px;\n    }\n\n    .slider-label {\n      font-size: 14px;\n    }\n\n    .slider-value {\n      font-size: 14px;\n      font-weight: 500;\n      color: var(--primary-color);\n    }\n\n    ha-slider {\n      width: 100%;\n    }\n\n    .source-help {\n      padding: 12px;\n      background: var(--card-background-color, #f5f5f5);\n      border-radius: 4px;\n      margin-top: 8px;\n    }\n\n    .help-text {\n      font-size: 12px;\n      color: var(--secondary-text-color);\n      margin-bottom: 8px;\n    }\n\n    .help-list {\n      margin: 0;\n      padding-left: 20px;\n      font-size: 12px;\n      color: var(--secondary-text-color);\n    }\n\n    .help-list li {\n      margin-bottom: 4px;\n    }\n\n    .help-list code {\n      background: var(--code-background-color, rgba(0,0,0,0.1));\n      padding: 2px 4px;\n      border-radius: 2px;\n      font-family: monospace;\n      font-size: 11px;\n    }\n\n    .color-row {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      margin-bottom: 12px;\n    }\n\n    .color-swatch {\n      width: 32px;\n      height: 32px;\n      border-radius: 4px;\n      border: 1px solid var(--divider-color);\n      flex-shrink: 0;\n    }\n\n    .color-label {\n      flex: 1;\n      font-size: 14px;\n    }\n\n    .color-input {\n      width: 80px;\n      padding: 4px 8px;\n      border: 1px solid var(--divider-color);\n      border-radius: 4px;\n      font-family: monospace;\n      font-size: 12px;\n      background: var(--card-background-color);\n      color: var(--primary-text-color);\n    }\n\n    .color-input:focus {\n      outline: none;\n      border-color: var(--primary-color);\n    }\n\n    .color-picker-wrapper {\n      position: relative;\n    }\n\n    .color-picker {\n      width: 32px;\n      height: 32px;\n      padding: 0;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .color-preview-row {\n      display: flex;\n      gap: 8px;\n      margin-top: 12px;\n      padding: 8px;\n      background: var(--card-background-color);\n      border-radius: 4px;\n    }\n\n    .color-preview-swatch {\n      flex: 1;\n      height: 24px;\n      border-radius: 4px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 10px;\n      font-weight: 500;\n    }\n\n    .config-warning {\n      padding: 12px;\n      margin: 8px 0;\n      border-radius: 4px;\n      font-size: 13px;\n    }\n\n    .config-warning.severity-warning {\n      background-color: rgba(255, 152, 0, 0.1);\n      border-left: 4px solid #ff9800;\n    }\n\n    .config-warning.severity-info {\n      background-color: rgba(33, 150, 243, 0.1);\n      border-left: 4px solid #2196f3;\n    }\n\n    .config-warning-message {\n      color: var(--primary-text-color);\n      margin-bottom: 4px;\n    }\n\n    .config-warning-suggestion {\n      color: var(--secondary-text-color);\n      font-size: 12px;\n    }\n\n    .input-header {\n      margin-bottom: 8px;\n    }\n\n    .input-label {\n      font-size: 14px;\n    }\n\n    .input-with-unit {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .input-with-unit ha-textfield {\n      flex: 1;\n    }\n\n    .unit-label {\n      font-size: 14px;\n      color: var(--secondary-text-color);\n      min-width: 50px;\n    }\n  `;\n\n  public setConfig(config: ABCEmergencyMapCardConfig): void {\n    this._config = config;\n  }\n\n  protected render(): TemplateResult {\n    if (!this.hass || !this._config) {\n      return html``;\n    }\n\n    return html`\n      <div class=\"editor-container\">\n        <!-- Basic Settings -->\n        <div class=\"section\">\n          <div class=\"section-title\">Basic Settings</div>\n\n          <div class=\"form-row\">\n            <ha-textfield\n              label=\"Title\"\n              .value=${this._config.title || \"\"}\n              @input=${this._valueChanged}\n              .configKey=${\"title\"}\n            ></ha-textfield>\n          </div>\n\n          <div class=\"form-row\">\n            <ha-entity-picker\n              .hass=${this.hass}\n              .value=${this._config.entity || \"\"}\n              .label=${\"Primary Entity (optional)\"}\n              .includeDomains=${[\"person\", \"device_tracker\", \"geo_location\"]}\n              @value-changed=${this._entityChanged}\n              allow-custom-entity\n            ></ha-entity-picker>\n          </div>\n        </div>\n\n        <!-- Map Settings -->\n        <div class=\"section\">\n          <div class=\"section-title\">Map Settings</div>\n\n          ${this._renderSlider(\n            \"Default Zoom\",\n            \"default_zoom\",\n            this._config.default_zoom ?? 10,\n            1,\n            20\n          )}\n\n          <div class=\"form-row\">\n            <ha-select\n              label=\"Tile Provider\"\n              .value=${this._config.tile_provider || \"osm\"}\n              @selected=${this._tileProviderChanged}\n              @closed=${(e: Event) => e.stopPropagation()}\n            >\n              ${TILE_PROVIDERS.map(\n                (provider) => html`\n                  <mwc-list-item .value=${provider.value}>\n                    ${provider.label}\n                  </mwc-list-item>\n                `\n              )}\n            </ha-select>\n          </div>\n\n          ${this._config.tile_provider === \"mapbox\"\n            ? html`\n                <div class=\"form-row\">\n                  <ha-textfield\n                    label=\"Mapbox API Key\"\n                    .value=${this._config.api_key || \"\"}\n                    @input=${this._valueChanged}\n                    .configKey=${\"api_key\"}\n                    type=\"password\"\n                  ></ha-textfield>\n                </div>\n              `\n            : nothing}\n\n          ${this._config.tile_provider === \"custom\"\n            ? html`\n                <div class=\"form-row\">\n                  <ha-textfield\n                    label=\"Custom Tile URL\"\n                    .value=${this._config.tile_url || \"\"}\n                    @input=${this._valueChanged}\n                    .configKey=${\"tile_url\"}\n                    placeholder=\"https://{s}.tile.example.com/{z}/{x}/{y}.png\"\n                  ></ha-textfield>\n                </div>\n              `\n            : nothing}\n\n          <div class=\"form-row\">\n            <ha-select\n              label=\"Theme Mode\"\n              .value=${this._normalizeDarkMode(this._config.dark_mode)}\n              @selected=${this._darkModeChanged}\n              @closed=${(e: Event) => e.stopPropagation()}\n            >\n              ${DARK_MODE_OPTIONS.map(\n                (option) => html`\n                  <mwc-list-item .value=${option.value}>\n                    ${option.label}\n                  </mwc-list-item>\n                `\n              )}\n            </ha-select>\n          </div>\n\n          ${this._renderToggle(\n            \"Auto-fit Bounds\",\n            \"Automatically zoom to show all entities\",\n            \"auto_fit\",\n            this._config.auto_fit ?? true\n          )}\n        </div>\n\n        <!-- Display Options -->\n        <div class=\"section\">\n          <div class=\"section-title\">Display Options</div>\n\n          ${this._renderToggle(\n            \"Show Zones\",\n            \"Display Home Assistant zones on map\",\n            \"show_zones\",\n            this._config.show_zones ?? true\n          )}\n\n          ${this._renderToggle(\n            \"Show Warning Levels\",\n            \"Display ABC Emergency incident polygons\",\n            \"show_warning_levels\",\n            this._config.show_warning_levels ?? true\n          )}\n\n          ${this._renderToggle(\n            \"Hide Markers for Polygons\",\n            \"Don't show point markers for incidents with polygon boundaries\",\n            \"hide_markers_for_polygons\",\n            this._config.hide_markers_for_polygons ?? true\n          )}\n\n          ${this._renderOptionalSlider(\n            \"Marker Minimum Zoom\",\n            \"Only show markers when zoomed in (0 = always visible)\",\n            \"marker_min_zoom\",\n            this._config.marker_min_zoom,\n            0,\n            20\n          )}\n\n          ${this._renderNumberInputWithUnit(\n            \"Polygon Size Threshold\",\n            \"Show markers for polygons larger than this (0 = disabled)\",\n            \"marker_polygon_threshold\",\n            this._config.marker_polygon_threshold,\n            \"meters\",\n            0,\n            100000,\n            500\n          )}\n\n          ${this._renderConfigWarnings()}\n\n          ${this._renderToggle(\n            \"Show History Trails\",\n            \"Display movement history for entities\",\n            \"show_history\",\n            this._config.show_history ?? false\n          )}\n\n          ${this._config.show_history\n            ? this._renderSlider(\n                \"History Hours\",\n                \"hours_to_show\",\n                this._config.hours_to_show ?? 24,\n                1,\n                168\n              )\n            : nothing}\n\n          ${this._renderToggle(\n            \"Show Badge\",\n            \"Display incident count badge in header\",\n            \"show_badge\",\n            this._config.show_badge ?? true\n          )}\n        </div>\n\n        <!-- Alert Colors -->\n        <div class=\"section\">\n          <div class=\"section-title\">Alert Colors</div>\n\n          <div class=\"form-row\">\n            <ha-select\n              label=\"Color Preset\"\n              .value=${this._getEffectivePreset()}\n              @selected=${this._alertColorPresetChanged}\n              @closed=${(e: Event) => e.stopPropagation()}\n            >\n              ${ALERT_COLOR_PRESET_OPTIONS.map(\n                (option) => html`\n                  <mwc-list-item .value=${option.value}>\n                    ${option.label}\n                  </mwc-list-item>\n                `\n              )}\n            </ha-select>\n          </div>\n\n          ${this._getEffectivePreset() === \"custom\" ? this._renderCustomColors() : nothing}\n\n          <!-- Color Preview -->\n          <div class=\"color-preview-row\">\n            ${ALERT_LEVEL_LABELS.map(({ level, label }) => {\n              const color = this._getEffectiveColor(level);\n              const textColor = this._getContrastColor(color);\n              return html`\n                <div\n                  class=\"color-preview-swatch\"\n                  style=\"background: ${color}; color: ${textColor};\"\n                  title=\"${label}\"\n                >\n                  ${level.charAt(0).toUpperCase()}\n                </div>\n              `;\n            })}\n          </div>\n        </div>\n\n        <!-- Dynamic Entity Sources -->\n        <div class=\"section\">\n          <div class=\"section-title\">Dynamic Entity Sources (ABC Emergency)</div>\n\n          <div class=\"form-row\">\n            <ha-textfield\n              label=\"Geo-Location Sources (comma-separated)\"\n              .value=${(this._config.geo_location_sources ?? []).join(\", \")}\n              @input=${this._geoLocationSourcesChanged}\n              placeholder=\"sensor.abc_emergency_treehouse_incidents_total\"\n              helper=\"Sensors exposing entity_ids attribute for dynamic geo_location discovery\"\n            ></ha-textfield>\n          </div>\n\n          <div class=\"source-help\">\n            <div class=\"help-text\">\n              Configure sensors or binary_sensors that expose lists of geo_location entities:\n            </div>\n            <ul class=\"help-list\">\n              <li><code>sensor.*_incidents_total</code> - All incidents</li>\n              <li><code>sensor.*_bushfires</code> - Bushfire incidents</li>\n              <li><code>sensor.*_watch_and_acts</code> - Watch and Act level</li>\n              <li><code>binary_sensor.*_inside_polygon</code> - Containing incidents</li>\n            </ul>\n          </div>\n        </div>\n\n        <!-- Animation Settings -->\n        <div class=\"section\">\n          <div class=\"section-title\">Animation Settings</div>\n\n          ${this._renderToggle(\n            \"Enable Animations\",\n            \"Pulse/glow effects for incidents\",\n            \"animations_enabled\",\n            this._config.animations_enabled ?? true\n          )}\n\n          ${this._renderToggle(\n            \"Geometry Transitions\",\n            \"Smooth polygon boundary transitions\",\n            \"geometry_transitions\",\n            this._config.geometry_transitions ?? true\n          )}\n\n          ${this._config.geometry_transitions\n            ? this._renderSlider(\n                \"Transition Duration (ms)\",\n                \"transition_duration\",\n                this._config.transition_duration ?? 500,\n                100,\n                2000\n              )\n            : nothing}\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Renders a toggle switch row.\n   */\n  private _renderToggle(\n    label: string,\n    description: string,\n    configKey: string,\n    value: boolean\n  ): TemplateResult {\n    return html`\n      <div class=\"toggle-row\">\n        <div>\n          <div class=\"toggle-label\">${label}</div>\n          <div class=\"toggle-description\">${description}</div>\n        </div>\n        <ha-switch\n          .checked=${value}\n          @change=${(e: Event) => this._toggleChanged(e, configKey)}\n        ></ha-switch>\n      </div>\n    `;\n  }\n\n  /**\n   * Renders a slider with value display.\n   */\n  private _renderSlider(\n    label: string,\n    configKey: string,\n    value: number,\n    min: number,\n    max: number\n  ): TemplateResult {\n    return html`\n      <div class=\"slider-row\">\n        <div class=\"slider-header\">\n          <span class=\"slider-label\">${label}</span>\n          <span class=\"slider-value\">${value}</span>\n        </div>\n        <ha-slider\n          .value=${value}\n          .min=${min}\n          .max=${max}\n          .step=${1}\n          pin\n          @change=${(e: Event) => this._sliderChanged(e, configKey)}\n        ></ha-slider>\n      </div>\n    `;\n  }\n\n  /**\n   * Renders an optional slider where 0 means \"disabled/not set\".\n   * When value is 0 or undefined, the feature is disabled.\n   */\n  private _renderOptionalSlider(\n    label: string,\n    description: string,\n    configKey: string,\n    value: number | undefined,\n    min: number,\n    max: number\n  ): TemplateResult {\n    const displayValue = value ?? 0;\n    const displayText = displayValue === 0 ? \"Always\" : String(displayValue);\n\n    return html`\n      <div class=\"slider-row\">\n        <div class=\"slider-header\">\n          <div>\n            <span class=\"slider-label\">${label}</span>\n            <div class=\"toggle-description\">${description}</div>\n          </div>\n          <span class=\"slider-value\">${displayText}</span>\n        </div>\n        <ha-slider\n          .value=${displayValue}\n          .min=${min}\n          .max=${max}\n          .step=${1}\n          pin\n          @change=${(e: Event) => this._optionalSliderChanged(e, configKey)}\n        ></ha-slider>\n      </div>\n    `;\n  }\n\n  /**\n   * Renders configuration warnings for conflicting visibility options.\n   */\n  private _renderConfigWarnings(): TemplateResult | typeof nothing {\n    if (!this._config) return nothing;\n\n    const warnings = validateVisibilityConfig(this._config);\n    if (warnings.length === 0) return nothing;\n\n    return html`\n      ${warnings.map(\n        (warning: ConfigWarning) => html`\n          <div class=\"config-warning severity-${warning.severity}\">\n            <div class=\"config-warning-message\">${warning.message}</div>\n            ${warning.suggestion\n              ? html`<div class=\"config-warning-suggestion\">\n                  ${warning.suggestion}\n                </div>`\n              : nothing}\n          </div>\n        `\n      )}\n    `;\n  }\n\n  /**\n   * Handles optional slider changes.\n   * Value of 0 means undefined (disabled).\n   */\n  private _optionalSliderChanged(ev: Event, configKey: string): void {\n    const target = ev.target as HTMLInputElement;\n    const numValue = Number(target.value);\n    // 0 means \"always visible\" = undefined in config\n    this._updateConfig({ [configKey]: numValue === 0 ? undefined : numValue });\n  }\n\n  /**\n   * Renders a number input with unit label.\n   * Empty or 0 value means the feature is disabled.\n   */\n  private _renderNumberInputWithUnit(\n    label: string,\n    description: string,\n    configKey: string,\n    value: number | undefined,\n    unit: string,\n    min: number,\n    max: number,\n    step: number = 100\n  ): TemplateResult {\n    const displayValue = value ?? \"\";\n\n    return html`\n      <div class=\"form-row\">\n        <div class=\"input-header\">\n          <span class=\"input-label\">${label}</span>\n          <div class=\"toggle-description\">${description}</div>\n        </div>\n        <div class=\"input-with-unit\">\n          <ha-textfield\n            type=\"number\"\n            .value=${String(displayValue)}\n            .min=${String(min)}\n            .max=${String(max)}\n            .step=${String(step)}\n            @change=${(e: Event) => this._numberInputChanged(e, configKey)}\n            placeholder=\"Disabled\"\n          ></ha-textfield>\n          <span class=\"unit-label\">${unit}</span>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Handles number input changes.\n   * Empty or 0 means undefined (disabled).\n   */\n  private _numberInputChanged(ev: Event, configKey: string): void {\n    const target = ev.target as HTMLInputElement;\n    const strValue = target.value.trim();\n    if (strValue === \"\" || strValue === \"0\") {\n      this._updateConfig({ [configKey]: undefined });\n    } else {\n      const numValue = Number(strValue);\n      if (!isNaN(numValue) && numValue > 0) {\n        this._updateConfig({ [configKey]: numValue });\n      }\n    }\n  }\n\n  /**\n   * Handles text input changes.\n   */\n  private _valueChanged(ev: Event): void {\n    const target = ev.target as HTMLInputElement & { configKey: string };\n    const configKey = target.configKey;\n    const value = target.value;\n\n    if (!configKey) return;\n\n    this._updateConfig({ [configKey]: value || undefined });\n  }\n\n  /**\n   * Handles entity picker changes.\n   */\n  private _entityChanged(ev: CustomEvent): void {\n    const value = ev.detail.value;\n    this._updateConfig({ entity: value || undefined });\n  }\n\n  /**\n   * Handles tile provider selection.\n   */\n  private _tileProviderChanged(ev: CustomEvent): void {\n    const target = ev.target as HTMLSelectElement;\n    const value = target.value as TileProviderId;\n    this._updateConfig({ tile_provider: value });\n  }\n\n  /**\n   * Normalizes dark mode value for the dropdown.\n   * Converts legacy boolean values to string format.\n   */\n  private _normalizeDarkMode(value: DarkModeSetting | undefined): string {\n    if (value === undefined) return \"auto\";\n    if (typeof value === \"boolean\") {\n      return value ? \"dark\" : \"light\";\n    }\n    return value;\n  }\n\n  /**\n   * Handles dark mode dropdown selection.\n   */\n  private _darkModeChanged(ev: CustomEvent): void {\n    const target = ev.target as HTMLSelectElement;\n    const value = target.value as DarkModeSetting;\n    this._updateConfig({ dark_mode: value });\n  }\n\n  /**\n   * Handles toggle switch changes.\n   */\n  private _toggleChanged(ev: Event, configKey: string): void {\n    const target = ev.target as HTMLInputElement;\n    this._updateConfig({ [configKey]: target.checked });\n  }\n\n  /**\n   * Handles slider changes.\n   */\n  private _sliderChanged(ev: Event, configKey: string): void {\n    const target = ev.target as HTMLInputElement;\n    this._updateConfig({ [configKey]: Number(target.value) });\n  }\n\n  /**\n   * Handles geo_location_sources input changes.\n   * Parses comma-separated entity IDs into an array.\n   */\n  private _geoLocationSourcesChanged(ev: Event): void {\n    const target = ev.target as HTMLInputElement;\n    const value = target.value.trim();\n\n    if (!value) {\n      this._updateConfig({ geo_location_sources: undefined });\n      return;\n    }\n\n    // Parse comma-separated entity IDs, trim whitespace\n    const sources = value\n      .split(\",\")\n      .map((s) => s.trim())\n      .filter((s) => s.length > 0);\n\n    this._updateConfig({\n      geo_location_sources: sources.length > 0 ? sources : undefined,\n    });\n  }\n\n  /**\n   * Gets the effective preset value for the dropdown.\n   * Returns \"custom\" if custom colors are defined, otherwise returns the preset or \"australian\".\n   */\n  private _getEffectivePreset(): AlertColorPreset | \"custom\" {\n    // If custom colors are defined, show \"custom\" in dropdown\n    if (this._config?.alert_colors && Object.keys(this._config.alert_colors).length > 0) {\n      return \"custom\";\n    }\n    return this._config?.alert_color_preset || \"australian\";\n  }\n\n  /**\n   * Gets the effective color for a given alert level based on config.\n   */\n  private _getEffectiveColor(level: AlertLevel): string {\n    // Check for custom color first\n    if (this._config?.alert_colors?.[level]) {\n      return this._config.alert_colors[level]!;\n    }\n    // Use preset colors\n    const preset = this._config?.alert_color_preset || \"australian\";\n    return ALERT_COLOR_PRESETS[preset]?.[level] || ALERT_COLORS[level];\n  }\n\n  /**\n   * Returns contrasting text color (black or white) based on background luminance.\n   */\n  private _getContrastColor(hexColor: string): string {\n    const hex = hexColor.replace(\"#\", \"\");\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;\n    return luminance > 0.5 ? \"#000000\" : \"#ffffff\";\n  }\n\n  /**\n   * Handles alert color preset selection.\n   */\n  private _alertColorPresetChanged(ev: CustomEvent): void {\n    const target = ev.target as HTMLSelectElement;\n    const value = target.value as AlertColorPreset | \"custom\";\n\n    if (value === \"custom\") {\n      // When switching to custom, initialize with current effective colors\n      const customColors: Partial<Record<AlertLevel, string>> = {};\n      for (const { level } of ALERT_LEVEL_LABELS) {\n        customColors[level] = this._getEffectiveColor(level);\n      }\n      this._updateConfig({\n        alert_color_preset: undefined,\n        alert_colors: customColors,\n      });\n    } else {\n      // When selecting a preset, clear custom colors\n      this._updateConfig({\n        alert_color_preset: value,\n        alert_colors: undefined,\n      });\n    }\n  }\n\n  /**\n   * Renders custom color inputs for each alert level.\n   */\n  private _renderCustomColors(): TemplateResult {\n    return html`\n      <div class=\"form-row\">\n        ${ALERT_LEVEL_LABELS.map(({ level, label }) => {\n          const color = this._config?.alert_colors?.[level] || ALERT_COLORS[level];\n          return html`\n            <div class=\"color-row\">\n              <input\n                type=\"color\"\n                class=\"color-picker\"\n                .value=${color}\n                @input=${(e: Event) => this._customColorChanged(e, level)}\n              />\n              <span class=\"color-label\">${label}</span>\n              <input\n                type=\"text\"\n                class=\"color-input\"\n                .value=${color}\n                @input=${(e: Event) => this._customColorTextChanged(e, level)}\n                placeholder=\"#000000\"\n              />\n            </div>\n          `;\n        })}\n      </div>\n    `;\n  }\n\n  /**\n   * Handles color picker changes.\n   */\n  private _customColorChanged(ev: Event, level: AlertLevel): void {\n    const target = ev.target as HTMLInputElement;\n    const color = target.value;\n    this._updateAlertColor(level, color);\n  }\n\n  /**\n   * Handles color text input changes.\n   */\n  private _customColorTextChanged(ev: Event, level: AlertLevel): void {\n    const target = ev.target as HTMLInputElement;\n    const color = target.value.trim();\n    // Only update if it looks like a valid hex color\n    if (/^#[0-9A-Fa-f]{6}$/.test(color)) {\n      this._updateAlertColor(level, color);\n    }\n  }\n\n  /**\n   * Updates a single alert color in the config.\n   */\n  private _updateAlertColor(level: AlertLevel, color: string): void {\n    const currentColors = this._config?.alert_colors || {};\n    this._updateConfig({\n      alert_colors: {\n        ...currentColors,\n        [level]: color,\n      },\n    });\n  }\n\n  /**\n   * Updates the configuration and fires the config-changed event.\n   */\n  private _updateConfig(update: Partial<ABCEmergencyMapCardConfig>): void {\n    if (!this._config) return;\n\n    const newConfig = { ...this._config, ...update };\n    this._config = newConfig;\n\n    const event = new CustomEvent(\"config-changed\", {\n      detail: { config: newConfig },\n      bubbles: true,\n      composed: true,\n    });\n    this.dispatchEvent(event);\n  }\n}\n\n// Register the editor element\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"abc-emergency-map-card-editor\": ABCEmergencyMapCardEditor;\n  }\n}\n","/**\n * ABC Emergency Map Card\n *\n * A custom Lovelace card for Home Assistant that displays\n * ABC Emergency incident polygons on a Leaflet map.\n */\n\nimport { LitElement, html, PropertyValues, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport type { HomeAssistant } from \"custom-card-helpers\";\nimport { styles } from \"./styles\";\nimport type { ABCEmergencyMapCardConfig, TileProviderConfig } from \"./types\";\nimport {\n  DEFAULT_DARK_MODE,\n  DEFAULT_HIDE_MARKERS_FOR_POLYGONS,\n  validateVisibilityConfig,\n} from \"./types\";\nimport { isPolygonGeometryType, polygonExtentCache } from \"./geometry-utils\";\nimport { loadLeaflet, injectLeafletCSS } from \"./leaflet-loader\";\nimport { resolveTileProvider } from \"./tile-providers\";\nimport { EntityMarkerManager, getAllEntities } from \"./entity-markers\";\nimport { ZoneManager, getAllZones } from \"./zone-renderer\";\nimport { BoundsManager } from \"./bounds-manager\";\nimport { HistoryTrailManager } from \"./history-trails\";\nimport { IncidentPolygonManager } from \"./incident-polygons\";\nimport type { Map as LeafletMap, TileLayer } from \"leaflet\";\n\n// Import editor component so it's bundled\nimport \"./editor\";\n\n// Note: The global L declaration is in leaflet-types.d.ts\n\n/** Default center point for Australia */\nconst DEFAULT_CENTER: [number, number] = [-25.2744, 133.7751];\n\n/** Default zoom level showing most of Australia */\nconst DEFAULT_ZOOM = 4;\n\n/** Card loading states */\ntype LoadingState = \"loading\" | \"ready\" | \"error\";\n\n@customElement(\"abc-emergency-map-card\")\nexport class ABCEmergencyMapCard extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n  @state() private _config?: ABCEmergencyMapCardConfig;\n  @state() private _loadingState: LoadingState = \"loading\";\n  @state() private _errorMessage?: string;\n  @state() private _currentDarkMode: boolean = false;\n\n  /** Leaflet map instance */\n  private _map?: LeafletMap;\n\n  /** Tile layer instance */\n  private _tileLayer?: TileLayer;\n\n  /** Current tile provider configuration for change detection */\n  private _currentTileConfig?: TileProviderConfig;\n\n  /** Entity marker manager */\n  private _markerManager?: EntityMarkerManager;\n\n  /** Zone renderer manager */\n  private _zoneManager?: ZoneManager;\n\n  /** Bounds manager for auto-fit functionality */\n  private _boundsManager?: BoundsManager;\n\n  /** History trail manager */\n  private _historyManager?: HistoryTrailManager;\n\n  /** Incident polygon manager */\n  private _incidentManager?: IncidentPolygonManager;\n\n  /** ResizeObserver for container size changes */\n  private _resizeObserver?: ResizeObserver;\n\n  /** Debounce timer for resize events */\n  private _resizeDebounce?: number;\n\n  /** Bound theme change handler for cleanup */\n  private _boundThemeHandler?: () => void;\n\n  /** Bound zoom event handler for cleanup */\n  private _boundZoomHandler?: () => void;\n\n  /** Live region element for screen reader announcements */\n  private _liveRegion?: HTMLElement;\n\n  /** Previous marker count for change detection */\n  private _previousMarkerCount = 0;\n\n  /** Previous marker visibility state for change detection */\n  private _previousMarkersVisible = true;\n\n  static styles = styles;\n\n  /**\n   * Sets the card configuration.\n   * Called by Home Assistant when the card is configured.\n   */\n  public setConfig(config: ABCEmergencyMapCardConfig): void {\n    if (!config) {\n      throw new Error(\"Invalid configuration\");\n    }\n\n    // Validate visibility configuration and log any warnings\n    const warnings = validateVisibilityConfig(config);\n    warnings.forEach((warning) => {\n      const prefix = \"ABC Emergency Map: Config\";\n      if (warning.severity === \"warning\") {\n        console.warn(`${prefix} Warning - ${warning.message}`);\n        if (warning.suggestion) {\n          console.warn(`${prefix} Suggestion - ${warning.suggestion}`);\n        }\n      } else {\n        console.info(`${prefix} Info - ${warning.message}`);\n        if (warning.suggestion) {\n          console.info(`${prefix} Suggestion - ${warning.suggestion}`);\n        }\n      }\n    });\n\n    this._config = {\n      title: \"ABC Emergency Map\",\n      default_zoom: 10,\n      hours_to_show: 24,\n      dark_mode: DEFAULT_DARK_MODE,\n      show_warning_levels: true,\n      ...config,\n    };\n  }\n\n  /**\n   * Renders the card HTML.\n   */\n  protected render(): TemplateResult {\n    if (!this._config) {\n      return html`<ha-card>Invalid configuration</ha-card>`;\n    }\n\n    const themeClass = this._currentDarkMode ? \"theme-dark\" : \"theme-light\";\n    const cardTitle = this._config.title || \"Map\";\n\n    return html`\n      <ha-card class=\"${themeClass}\">\n        <!-- Skip link for keyboard navigation -->\n        <a\n          href=\"#map-content-end\"\n          class=\"skip-link\"\n          @click=${this._handleSkipLink}\n        >\n          Skip map content\n        </a>\n\n        ${this._config.title\n          ? html`\n            <div class=\"card-header\">\n              <span class=\"header-title\" id=\"map-title\">${this._config.title}</span>\n            </div>\n          `\n          : \"\"}\n        <div\n          class=\"map-wrapper\"\n          role=\"region\"\n          aria-label=\"${cardTitle}\"\n        >\n          ${this._renderMapContent()}\n        </div>\n\n        <!-- Live region for screen reader announcements -->\n        <div\n          id=\"accessibility-live-region\"\n          class=\"sr-live-region\"\n          role=\"status\"\n          aria-live=\"polite\"\n          aria-atomic=\"true\"\n        ></div>\n\n        <!-- End marker for skip link -->\n        <div id=\"map-content-end\" tabindex=\"-1\"></div>\n      </ha-card>\n    `;\n  }\n\n  /**\n   * Handles skip link click to move focus past the map.\n   */\n  private _handleSkipLink(e: Event): void {\n    e.preventDefault();\n    const target = this.shadowRoot?.getElementById('map-content-end');\n    if (target) {\n      target.focus();\n    }\n  }\n\n  /**\n   * Renders the map content based on loading state.\n   */\n  private _renderMapContent(): TemplateResult {\n    switch (this._loadingState) {\n      case \"loading\":\n        return html`\n          <div class=\"loading-container\" role=\"status\" aria-label=\"Loading map\">\n            <ha-circular-progress indeterminate></ha-circular-progress>\n            <div class=\"loading-text\">Loading map...</div>\n          </div>\n        `;\n      case \"error\":\n        return html`\n          <div class=\"error-container\" role=\"alert\">\n            <ha-icon icon=\"mdi:alert-circle\" aria-hidden=\"true\"></ha-icon>\n            <div class=\"error-text\">\n              ${this._errorMessage || \"Failed to load map\"}\n            </div>\n            <mwc-button @click=${this._retryLoad}>Retry</mwc-button>\n          </div>\n        `;\n      case \"ready\":\n      default:\n        return html`\n          <div\n            class=\"map-container\"\n            id=\"map\"\n            role=\"application\"\n            aria-label=\"Interactive emergency map. Use arrow keys to pan, plus and minus to zoom.\"\n            tabindex=\"0\"\n            @keydown=${this._handleMapKeydown}\n          ></div>\n        `;\n    }\n  }\n\n  /**\n   * Handles keyboard navigation within the map.\n   * Arrow keys pan, +/- zoom, Home resets view.\n   */\n  private _handleMapKeydown(e: KeyboardEvent): void {\n    if (!this._map) return;\n\n    const panAmount = 100; // pixels\n    const zoomAmount = 1;\n\n    switch (e.key) {\n      case 'ArrowUp':\n        e.preventDefault();\n        this._map.panBy([0, -panAmount]);\n        break;\n      case 'ArrowDown':\n        e.preventDefault();\n        this._map.panBy([0, panAmount]);\n        break;\n      case 'ArrowLeft':\n        e.preventDefault();\n        this._map.panBy([-panAmount, 0]);\n        break;\n      case 'ArrowRight':\n        e.preventDefault();\n        this._map.panBy([panAmount, 0]);\n        break;\n      case '+':\n      case '=':\n        e.preventDefault();\n        this._map.zoomIn(zoomAmount);\n        break;\n      case '-':\n      case '_':\n        e.preventDefault();\n        this._map.zoomOut(zoomAmount);\n        break;\n      case 'Home':\n        e.preventDefault();\n        // Trigger fit to bounds\n        if (this._boundsManager) {\n          const positions: [number, number][] = [];\n          if (this._markerManager) positions.push(...this._markerManager.getMarkerPositions());\n          if (this._zoneManager) positions.push(...this._zoneManager.getZonePositions());\n          if (this._incidentManager) positions.push(...this._incidentManager.getIncidentPositions());\n          this._boundsManager.fitToPositions(positions, true);\n        }\n        break;\n    }\n  }\n\n  /**\n   * Called after the first render.\n   * Initializes the Leaflet map.\n   */\n  protected async firstUpdated(\n    _changedProperties: PropertyValues\n  ): Promise<void> {\n    super.firstUpdated(_changedProperties);\n    await this._initializeMap();\n  }\n\n  /**\n   * Called when properties change.\n   * Updates map data and tile layer when Home Assistant state changes.\n   */\n  protected updated(changedProperties: PropertyValues): void {\n    super.updated(changedProperties);\n    if (changedProperties.has(\"hass\") && this._map) {\n      // Check if theme changed and update tiles if needed\n      this._checkThemeChange();\n      this._updateTileLayer();\n      this._updateMapData();\n    }\n  }\n\n  /**\n   * Checks if the theme has changed and updates the dark mode state.\n   * This triggers a re-render if the theme changed.\n   */\n  private _checkThemeChange(): void {\n    const newDarkMode = this._isDarkMode();\n    if (newDarkMode !== this._currentDarkMode) {\n      this._currentDarkMode = newDarkMode;\n      // Force tile layer update on theme change\n      this._currentTileConfig = undefined;\n    }\n  }\n\n  /**\n   * Called when the element is removed from the DOM.\n   * Cleans up map resources.\n   */\n  public disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._removeThemeListener();\n    this._cleanup();\n  }\n\n  /**\n   * Called when the element is re-added to the DOM.\n   * Re-initializes the map if needed.\n   */\n  public connectedCallback(): void {\n    super.connectedCallback();\n\n    // Add theme change listener\n    this._addThemeListener();\n\n    // If we were previously initialized and got disconnected, re-initialize\n    if (this._loadingState === \"ready\" && !this._map) {\n      this._initializeMap();\n    }\n  }\n\n  /**\n   * Adds a listener for Home Assistant theme-change events.\n   * This enables real-time theme switching when HA theme changes.\n   */\n  private _addThemeListener(): void {\n    this._boundThemeHandler = () => {\n      this._checkThemeChange();\n      if (this._map) {\n        this._updateTileLayer();\n      }\n    };\n\n    // Listen for Home Assistant theme changes\n    window.addEventListener(\"settheme\", this._boundThemeHandler);\n    window.addEventListener(\"theme-changed\", this._boundThemeHandler);\n  }\n\n  /**\n   * Removes the theme change listener.\n   */\n  private _removeThemeListener(): void {\n    if (this._boundThemeHandler) {\n      window.removeEventListener(\"settheme\", this._boundThemeHandler);\n      window.removeEventListener(\"theme-changed\", this._boundThemeHandler);\n      this._boundThemeHandler = undefined;\n    }\n  }\n\n  /**\n   * Initializes the Leaflet map.\n   * Loads Leaflet dynamically if not already loaded.\n   */\n  private async _initializeMap(): Promise<void> {\n    console.log(\"ABC Emergency Map: Initializing map (v2.0 - Shadow DOM CSS fix)\");\n    this._loadingState = \"loading\";\n    this._errorMessage = undefined;\n\n    // Set initial dark mode state\n    this._currentDarkMode = this._isDarkMode();\n\n    try {\n      // Load Leaflet from CDN if needed\n      await loadLeaflet();\n\n      // Inject Leaflet CSS into our shadow root\n      // (CSS in document.head doesn't penetrate Shadow DOM)\n      if (this.shadowRoot) {\n        await injectLeafletCSS(this.shadowRoot);\n      }\n\n      // Set state to ready so the map container div is rendered\n      this._loadingState = \"ready\";\n\n      // Wait for next render cycle to ensure map container exists\n      await this.updateComplete;\n\n      // Get the map container from shadow DOM\n      const mapContainer = this.shadowRoot?.getElementById(\"map\");\n      if (!mapContainer) {\n        throw new Error(\"Map container not found in shadow DOM\");\n      }\n\n      // Initialize the Leaflet map\n      const center = this._getInitialCenter();\n      const zoom = this._config?.default_zoom ?? DEFAULT_ZOOM;\n\n      this._map = L.map(mapContainer, {\n        center: center,\n        zoom: zoom,\n        zoomControl: true,\n        attributionControl: true,\n      });\n\n      // Add the tile layer using the configured provider\n      this._updateTileLayer();\n\n      // Initialize entity marker manager\n      this._markerManager = new EntityMarkerManager(this._map);\n\n      // Initialize zone renderer (zones render below markers)\n      this._zoneManager = new ZoneManager(this._map, this._config!);\n\n      // Initialize bounds manager for auto-fit functionality\n      this._boundsManager = new BoundsManager(this._map, this._config!);\n      this._boundsManager.addFitControl();\n\n      // Initialize history trail manager (renders below markers)\n      this._historyManager = new HistoryTrailManager(this._map, this._config!);\n\n      // Initialize incident polygon manager for ABC Emergency\n      this._incidentManager = new IncidentPolygonManager(this._map, this._config!);\n\n      // Set up zoom event listener for marker visibility control\n      if (this._config?.marker_min_zoom !== undefined) {\n        this._boundZoomHandler = () => this._updateMarkerZoomVisibility();\n        this._map.on(\"zoomend\", this._boundZoomHandler);\n        // Apply initial visibility based on current zoom\n        this._updateMarkerZoomVisibility();\n      }\n\n      // Set up ResizeObserver for container size changes\n      this._setupResizeObserver(mapContainer);\n\n      // Trigger initial resize to ensure proper sizing\n      this._handleResize();\n\n      // Load initial data if hass is available\n      if (this.hass) {\n        this._updateMapData();\n      }\n    } catch (error) {\n      console.error(\"ABC Emergency Map: Failed to initialize map:\", error);\n      this._loadingState = \"error\";\n      this._errorMessage =\n        error instanceof Error ? error.message : \"Unknown error occurred\";\n    }\n  }\n\n  /**\n   * Gets the initial center point for the map.\n   * Uses Home Assistant's location if available, otherwise defaults to Australia center.\n   */\n  private _getInitialCenter(): [number, number] {\n    // Try to use Home Assistant's configured location\n    if (\n      this.hass?.config?.latitude !== undefined &&\n      this.hass?.config?.longitude !== undefined\n    ) {\n      console.log(\"ABC Emergency Map: Using HA home location:\",\n        this.hass.config.latitude, this.hass.config.longitude);\n      return [this.hass.config.latitude, this.hass.config.longitude];\n    }\n\n    // Fall back to center of Australia\n    console.log(\"ABC Emergency Map: No HA location, using default:\", DEFAULT_CENTER);\n    return DEFAULT_CENTER;\n  }\n\n  /**\n   * Determines if dark mode is active.\n   * Handles \"auto\", \"light\", \"dark\" settings and legacy boolean values.\n   * In \"auto\" mode, follows Home Assistant's theme setting.\n   */\n  private _isDarkMode(): boolean {\n    const setting = this._config?.dark_mode ?? DEFAULT_DARK_MODE;\n\n    // Handle legacy boolean values\n    if (typeof setting === \"boolean\") {\n      return setting;\n    }\n\n    // Handle string settings\n    switch (setting) {\n      case \"dark\":\n        return true;\n      case \"light\":\n        return false;\n      case \"auto\":\n      default:\n        return this._detectHADarkMode();\n    }\n  }\n\n  /**\n   * Detects dark mode from Home Assistant theme settings.\n   * Checks multiple sources for maximum compatibility.\n   */\n  private _detectHADarkMode(): boolean {\n    // Method 1: Check hass.themes.darkMode (HA 2021.6+)\n    const themes = this.hass?.themes as unknown as\n      | { darkMode?: boolean }\n      | undefined;\n    if (themes?.darkMode !== undefined) {\n      return themes.darkMode;\n    }\n\n    // Method 2: Check CSS prefers-color-scheme media query\n    // This respects system dark mode when HA is in \"auto\" mode\n    if (window.matchMedia?.(\"(prefers-color-scheme: dark)\").matches) {\n      return true;\n    }\n\n    // Method 3: Check if HA theme name contains \"dark\"\n    const themeName = (this.hass?.themes as unknown as { theme?: string })?.theme;\n    if (themeName && themeName.toLowerCase().includes(\"dark\")) {\n      return true;\n    }\n\n    // Default to light mode\n    return false;\n  }\n\n  /**\n   * Updates the tile layer based on current configuration and theme.\n   * Called on initialization and when config/theme changes.\n   */\n  private _updateTileLayer(): void {\n    if (!this._map || !this._config) {\n      return;\n    }\n\n    const darkMode = this._isDarkMode();\n    const tileConfig = resolveTileProvider(this._config, darkMode);\n\n    // Skip update if tile config hasn't changed\n    if (\n      this._currentTileConfig &&\n      this._currentTileConfig.url === tileConfig.url &&\n      this._currentTileConfig.attribution === tileConfig.attribution\n    ) {\n      return;\n    }\n\n    // Remove existing tile layer\n    if (this._tileLayer) {\n      this._tileLayer.remove();\n    }\n\n    // Create new tile layer with resolved configuration\n    this._tileLayer = L.tileLayer(tileConfig.url, {\n      attribution: tileConfig.attribution,\n      maxZoom: tileConfig.maxZoom,\n      subdomains: tileConfig.subdomains,\n    }).addTo(this._map);\n\n    // Store current config for change detection\n    this._currentTileConfig = tileConfig;\n  }\n\n  /**\n   * Sets up a ResizeObserver to handle container size changes.\n   * This ensures the map properly fills its container even after resizes.\n   */\n  private _setupResizeObserver(container: HTMLElement): void {\n    // Clean up any existing observer\n    if (this._resizeObserver) {\n      this._resizeObserver.disconnect();\n    }\n\n    this._resizeObserver = new ResizeObserver(() => {\n      // Debounce resize events\n      if (this._resizeDebounce) {\n        window.clearTimeout(this._resizeDebounce);\n      }\n      this._resizeDebounce = window.setTimeout(() => {\n        this._handleResize();\n      }, 100);\n    });\n\n    this._resizeObserver.observe(container);\n  }\n\n  /**\n   * Handles container resize events.\n   * Invalidates the map size so Leaflet recalculates dimensions.\n   */\n  private _handleResize(): void {\n    if (this._map) {\n      // invalidateSize tells Leaflet to recalculate its size\n      this._map.invalidateSize({ animate: false });\n    }\n  }\n\n  /**\n   * Cleans up map resources.\n   * Called on disconnectedCallback to prevent memory leaks.\n   */\n  private _cleanup(): void {\n    // Clear any pending resize debounce\n    if (this._resizeDebounce) {\n      window.clearTimeout(this._resizeDebounce);\n      this._resizeDebounce = undefined;\n    }\n\n    // Disconnect ResizeObserver\n    if (this._resizeObserver) {\n      this._resizeObserver.disconnect();\n      this._resizeObserver = undefined;\n    }\n\n    // Remove tile layer\n    if (this._tileLayer) {\n      this._tileLayer.remove();\n      this._tileLayer = undefined;\n    }\n\n    // Destroy marker manager\n    if (this._markerManager) {\n      this._markerManager.destroy();\n      this._markerManager = undefined;\n    }\n\n    // Destroy zone manager\n    if (this._zoneManager) {\n      this._zoneManager.destroy();\n      this._zoneManager = undefined;\n    }\n\n    // Destroy bounds manager\n    if (this._boundsManager) {\n      this._boundsManager.destroy();\n      this._boundsManager = undefined;\n    }\n\n    // Destroy history manager\n    if (this._historyManager) {\n      this._historyManager.destroy();\n      this._historyManager = undefined;\n    }\n\n    // Destroy incident manager\n    if (this._incidentManager) {\n      this._incidentManager.destroy();\n      this._incidentManager = undefined;\n    }\n\n    // Clear tile config cache\n    this._currentTileConfig = undefined;\n\n    // Remove zoom event listener\n    if (this._map && this._boundZoomHandler) {\n      this._map.off(\"zoomend\", this._boundZoomHandler);\n      this._boundZoomHandler = undefined;\n    }\n\n    // Remove and cleanup map\n    if (this._map) {\n      this._map.remove();\n      this._map = undefined;\n    }\n  }\n\n  /**\n   * Retries loading the map after an error.\n   */\n  private async _retryLoad(): Promise<void> {\n    await this._initializeMap();\n  }\n\n  /**\n   * Updates marker visibility based on current zoom level.\n   * Called on zoom changes when marker_min_zoom is configured.\n   */\n  private _updateMarkerZoomVisibility(): void {\n    if (!this._map || !this._markerManager || !this._config) {\n      return;\n    }\n\n    const minZoom = this._config.marker_min_zoom;\n    if (minZoom === undefined) {\n      return;\n    }\n\n    const currentZoom = this._map.getZoom();\n    const shouldShow = currentZoom >= minZoom;\n\n    this._markerManager.setZoomVisibility(shouldShow);\n\n    // Announce visibility change to screen readers\n    if (shouldShow !== this._previousMarkersVisible) {\n      this._previousMarkersVisible = shouldShow;\n      const message = shouldShow\n        ? \"Entity markers now visible\"\n        : \"Entity markers hidden at current zoom level\";\n      this._announceChange(message);\n    }\n  }\n\n  /**\n   * Announces a change to screen readers via the live region.\n   * Uses requestAnimationFrame to ensure the announcement is processed.\n   */\n  private _announceChange(message: string): void {\n    if (!this._liveRegion) {\n      this._liveRegion = this.shadowRoot?.getElementById(\"accessibility-live-region\") as HTMLElement;\n    }\n\n    if (!this._liveRegion || !message) return;\n\n    // Clear and reset to trigger announcement\n    this._liveRegion.textContent = \"\";\n    requestAnimationFrame(() => {\n      if (this._liveRegion) {\n        this._liveRegion.textContent = message;\n      }\n    });\n  }\n\n  /**\n   * Updates map data when entity states change.\n   * Renders zones, entity markers, history trails, and incident polygons.\n   */\n  private _updateMapData(): void {\n    if (!this._map || !this.hass || !this._config) {\n      return;\n    }\n\n    // Update zones (rendered first, below markers)\n    if (this._zoneManager) {\n      this._zoneManager.updateConfig(this._config);\n      const zones = getAllZones(this.hass);\n      console.log(\"ABC Emergency Map: Found zones:\", zones.length, zones.map(z => z.entityId));\n      this._zoneManager.updateZones(zones);\n    }\n\n    // Update entity markers (includes both static entities and geo_location_sources)\n    const allEntities = this._markerManager\n      ? getAllEntities(this.hass, this._config)\n      : [];\n    console.log(\"ABC Emergency Map: Found entities:\", allEntities.length, allEntities.map(e => e.entityId));\n\n    // Determine if we should hide markers for polygon entities\n    const hideMarkersForPolygons = this._config.hide_markers_for_polygons ??\n      DEFAULT_HIDE_MARKERS_FOR_POLYGONS;\n    const polygonThreshold = this._config.marker_polygon_threshold;\n\n    // Filter out entities that have polygon/multipolygon data (if configured)\n    // Point-only geometry should always render as markers since they have no polygon bounds\n    const entitiesForMarkers = hideMarkersForPolygons\n      ? allEntities.filter(e => {\n          const entity = this.hass.states[e.entityId];\n          if (!entity) return true; // Keep if not found (shouldn't happen)\n\n          // Check if entity has geometry data\n          const geojson = entity.attributes.geojson || entity.attributes.geometry;\n          if (!geojson) return true; // No geometry = render as marker\n\n          // Check geometry type - only filter out actual polygon types\n          // Point geometry should render as a marker, not as a bare GeoJSON point\n          const geometryType = (geojson as { type?: string }).type ||\n            (entity.attributes.geometry_type as string);\n\n          if (isPolygonGeometryType(geometryType)) {\n            // If polygon threshold is configured, check polygon size\n            if (polygonThreshold !== undefined) {\n              const extent = polygonExtentCache.getExtent(e.entityId, geojson as GeoJSON.GeoJSON);\n              // Large polygons (>= threshold) get markers, small ones don't\n              if (extent >= polygonThreshold) {\n                console.log(\"ABC Emergency Map: Large polygon, showing marker:\", e.entityId, \"extent:\", Math.round(extent), \"m\");\n                return true; // Show marker for large polygon\n              }\n              console.log(\"ABC Emergency Map: Small polygon, hiding marker:\", e.entityId, \"extent:\", Math.round(extent), \"m, threshold:\", polygonThreshold, \"m\");\n              return false; // Hide marker for small polygon\n            }\n\n            console.log(\"ABC Emergency Map: Skipping marker for polygon entity:\", e.entityId, \"type:\", geometryType);\n            return false; // Filter out - will be rendered as polygon\n          }\n\n          // Point or unknown geometry type - render as marker\n          if (geometryType === \"Point\") {\n            console.log(\"ABC Emergency Map: Rendering Point geometry as marker:\", e.entityId);\n          }\n          return true;\n        })\n      : allEntities; // Show all entities as markers when hide_markers_for_polygons is false\n\n    // Clean up stale cache entries for entities that no longer exist\n    if (polygonThreshold !== undefined) {\n      const activeEntityIds = new Set(allEntities.map(e => e.entityId));\n      polygonExtentCache.cleanup(activeEntityIds);\n    }\n\n    if (this._markerManager) {\n      this._markerManager.updateMarkers(entitiesForMarkers);\n      // Apply zoom-based visibility to newly created markers\n      this._updateMarkerZoomVisibility();\n\n      // Announce marker count changes to screen readers\n      const newCount = this._markerManager.markerCount;\n      if (newCount !== this._previousMarkerCount) {\n        this._previousMarkerCount = newCount;\n        if (newCount > 0) {\n          const plural = newCount === 1 ? \"marker\" : \"markers\";\n          this._announceChange(`${newCount} entity ${plural} displayed`);\n        }\n      }\n    }\n\n    // Update history trails (async, will render when data arrives)\n    // Only track history for non-polygon entities (markers)\n    if (this._historyManager) {\n      this._historyManager.updateConfig(this._config);\n      const entityIds = entitiesForMarkers.map((e) => e.entityId);\n      // Fire and forget - trails will update asynchronously\n      this._historyManager.updateTrails(this.hass, entityIds);\n    }\n\n    // Update polygons for entities that have GeoJSON data\n    if (this._incidentManager && this._config.show_warning_levels !== false) {\n      this._incidentManager.updateConfig(this._config);\n      // Pass all entities - polygon manager will filter to only those with GeoJSON\n      const entityIds = allEntities.map(e => e.entityId);\n      this._incidentManager.updatePolygonsForEntities(this.hass, entityIds);\n    }\n\n    // Update bounds manager config and fit to all positions\n    if (this._boundsManager) {\n      this._boundsManager.updateConfig(this._config);\n\n      // Collect all positions from markers and zones\n      const positions: [number, number][] = [];\n\n      if (this._markerManager) {\n        positions.push(...this._markerManager.getMarkerPositions());\n      }\n\n      if (this._zoneManager) {\n        positions.push(...this._zoneManager.getZonePositions());\n      }\n\n      // Get polygon bounds separately - these are actual bounds, not centroids\n      const polygonBounds = this._incidentManager?.getPolygonBounds();\n\n      // Note: History trail positions are not included in bounds calculation\n      // to avoid sudden map jumps when history loads\n\n      console.log(\"ABC Emergency Map: Total positions for bounds:\", positions.length, positions);\n      console.log(\"ABC Emergency Map: Polygon bounds:\", polygonBounds?.toBBoxString());\n\n      // Fit bounds to show all positions, including polygon bounds\n      this._boundsManager.fitToPositionsAndBounds(positions, polygonBounds);\n    }\n  }\n\n\n  /**\n   * Returns the card size for Home Assistant layout calculations.\n   */\n  public getCardSize(): number {\n    return 5;\n  }\n\n  /**\n   * Returns the configuration element for the card editor.\n   */\n  static getConfigElement(): HTMLElement {\n    return document.createElement(\"abc-emergency-map-card-editor\");\n  }\n\n  /**\n   * Returns stub configuration for new card instances.\n   */\n  static getStubConfig(): ABCEmergencyMapCardConfig {\n    return {\n      type: \"custom:abc-emergency-map-card\",\n      title: \"ABC Emergency Map\",\n    };\n  }\n}\n\n// Register the card with the custom elements registry\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"abc-emergency-map-card\": ABCEmergencyMapCard;\n  }\n}\n\n// Card registration for HACS and Home Assistant\n(window as unknown as Record<string, unknown[]>).customCards =\n  (window as unknown as Record<string, unknown[]>).customCards || [];\n(window as unknown as Record<string, unknown[]>).customCards.push({\n  type: \"abc-emergency-map-card\",\n  name: \"ABC Emergency Map Card\",\n  description:\n    \"Display ABC Emergency incident polygons on a Leaflet map with Australian Warning System colors\",\n  preview: true,\n});\n"],"names":["__decorate","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","SuppressedError","t","globalThis","e","ShadowRoot","ShadyCSS","nativeShadow","Document","prototype","CSSStyleSheet","s","Symbol","o","WeakMap","n$3","constructor","this","_$cssResult$","Error","cssText","styleSheet","get","replaceSync","set","toString","reduce","n","cssRules","is","h","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","a","trustedTypes","l","emptyScript","p","reactiveElementPolyfillSupport","u","toAttribute","Boolean","Array","JSON","stringify","fromAttribute","Number","parse","f","b","attribute","type","String","converter","reflect","useDefault","hasChanged","metadata","litPropertyMetadata","y$1","HTMLElement","addInitializer","_$Ei","push","observedAttributes","finalize","_$Eh","keys","createProperty","state","hasOwnProperty","create","wrapped","elementProperties","noAccessor","getPropertyDescriptor","call","requestUpdate","configurable","enumerable","getPropertyOptions","Map","finalized","properties","_$Eu","elementStyles","finalizeStyles","styles","isArray","Set","flat","reverse","unshift","toLowerCase","super","_$Ep","isUpdatePending","hasUpdated","_$Em","_$Ev","_$ES","Promise","enableUpdating","_$AL","_$E_","forEach","addController","_$EO","add","renderRoot","isConnected","hostConnected","removeController","delete","size","createRenderRoot","shadowRoot","attachShadow","shadowRootOptions","adoptedStyleSheets","map","document","createElement","litNonce","setAttribute","textContent","appendChild","connectedCallback","disconnectedCallback","hostDisconnected","attributeChangedCallback","_$AK","_$ET","removeAttribute","_$Ej","hasAttribute","C","_$EP","has","_$Eq","reject","scheduleUpdate","performUpdate","shouldUpdate","willUpdate","hostUpdate","update","_$EM","_$AE","hostUpdated","firstUpdated","updated","updateComplete","getUpdateComplete","y","mode","ReactiveElement","reactiveElementVersions","createPolicy","createHTML","Math","random","toFixed","slice","createComment","v","_","m","RegExp","g","$","_$litType$","strings","values","x","E","for","A","P","createTreeWalker","V","N","lastIndex","exec","test","startsWith","S","parts","el","currentNode","content","firstChild","replaceWith","childNodes","nextNode","nodeType","hasAttributes","getAttributeNames","endsWith","getAttribute","split","index","name","ctor","I","L","z","H","tagName","append","data","indexOf","innerHTML","M","_$Co","_$Cl","_$litDirective$","_$AO","_$AT","_$AS","R","_$AV","_$AN","_$AD","_$AM","parentNode","_$AU","creationScope","importNode","k","nextSibling","Z","_$AI","_$Cv","_$AH","_$AA","_$AB","options","startNode","endNode","_$AR","T","iterator","O","insertBefore","createTextNode","_$AC","_$AP","remove","setConnected","element","fill","j","L$1","toggleAttribute","capture","once","passive","removeEventListener","addEventListener","handleEvent","host","B","litHtmlPolyfillSupport","litHtmlVersions","renderOptions","_$Do","renderBefore","render","_$litPart$","_$litElement$","litElementHydrateSupport","LitElement","litElementPolyfillSupport","litElementVersions","customElements","define","kind","init","css","DEFAULT_DARK_MODE","DOMAIN_ICONS","device_tracker","person","geo_location","DOMAIN_COLORS","ALERT_COLORS","extreme","severe","moderate","minor","ALERT_COLOR_PRESETS","australian","us_nws","eu_meteo","high_contrast","getAlertColor","level","config","normalizedLevel","includes","alert_colors","alert_color_preset","validateVisibilityConfig","warnings","show_warning_levels","hide_markers_for_polygons","id","severity","message","suggestion","polygonExtentCache","_cache","_debugLogging","setDebugLogging","enabled","_hashGeometry","geojson","coordinates","getExtent","entityId","hash","cached","console","debug","extent","bounds","geoJSON","getBounds","isValid","ne","getNorthEast","sw","getSouthWest","width","latLng","lat","lng","distanceTo","height","max","warn","computePolygonExtent","round","cleanup","activeEntityIds","removed","clear","LEAFLET_VERSION","LEAFLET_CSS_URL","LEAFLET_JS_URL","leafletLoadPromise","leafletLoaded","leafletCSSContent","async","injectLeafletCSS","log","querySelector","cssContent","response","fetch","ok","status","text","fetchLeafletCSS","styleElement","loadLeaflet","url","integrity","resolve","link","rel","href","crossOrigin","onload","onerror","head","window","script","src","loadScript","error","TILE_PROVIDERS","osm","requiresApiKey","light","attribution","maxZoom","subdomains","cartodb","dark","mapbox","resolveTileProvider","darkMode","providerId","tile_provider","tile_url","api_key","replace","tile_attribution","resolveCustomProvider","preset","variant","LOCATION_DOMAINS","isLocationDomain","domain","getDomain","extractEntityMarkerData","entity","attributes","latitude","lon","longitude","isNaN","hasValidCoordinates","attrs","friendly_name","picture","entity_picture","gpsAccuracy","gps_accuracy","battery","lastUpdated","last_updated","getAllEntities","hass","processedIds","entities","staticEntities","configuredEntityIds","states","getConfiguredEntities","geo_location_sources","sourceEntityIds","sources","entityIds","sourceId","source","entity_ids","containing_entity_ids","getEntityIdsFromSources","geoLocationEntities","filter","createMarkerIconHtml","style","color","createMarkerIconStyle","createPopupContent","escape","str","safeEntityId","uniqueId","items","undefined","join","EntityMarkerManager","_markers","_markerSize","_map","updateMarkers","currentIds","marker","_updateOrCreateMarker","position","existingMarker","setLatLng","icon","_createIcon","setIcon","setPopupContent","bindPopup","addTo","bindTooltip","permanent","direction","offset","divIcon","className","html","iconSize","iconAnchor","popupAnchor","getMarkerPositions","positions","getLatLng","markerCount","setZoomVisibility","visible","getElement","classList","destroy","isZoneEntity","extractZoneData","radius","createZonePopup","zone","ZoneManager","_circles","_config","updateConfig","updateZones","zones","show_zones","circle","_updateOrCreateCircle","center","existingCircle","fillColor","zone_color","fillOpacity","zone_opacity","weight","opacity","zone_border_opacity","dashArray","setRadius","setStyle","getZonePositions","zoneCount","BoundsManager","_hasUserInteracted","_initialFitDone","_lastKnownPositions","_setupUserInteractionTracking","addFitControl","_fitControl","onClick","FitControl","Control","extend","onAdd","container","DomUtil","button","title","DomEvent","disableClickPropagation","on","preventDefault","createFitControl","fitToPositionsAndBounds","_lastKnownPolygonBounds","removeFitControl","fitToPositions","force","polygonBounds","auto_fit","hasPositions","hasPolygonBounds","_debounceTimer","clearTimeout","setTimeout","_performFitWithPolygons","padding","normalizePadding","fit_padding","fit_max_zoom","combinedBounds","latLngBounds","getCenter","zoom","min","default_zoom","setView","animate","fitBounds","resetUserInteraction","fetchEntityHistory","hoursToShow","endTime","Date","startTime","getTime","history","callWS","start_time","toISOString","end_time","minimal_response","significant_changes_only","points","entityHistory","timestamp","last_changed","sort","splitByGaps","maxGapMinutes","segments","currentSegment","calculateOpacity","totalRange","createGradientPolylines","polylines","segmentSize","floor","segmentEnd","segmentPoints","latlngs","polyline","lineCap","lineJoin","HistoryTrailManager","_polylines","_lastFetch","_cachedHistory","updateTrails","show_history","entitiesToShow","history_entities","now","_fetchTimeout","hours_to_show","history_line_weight","_removeTrail","segment","segmentPolylines","getTrailPositions","point","trailCount","extractIncidentData","alertLevel","alert_level","headline","alert_text","event_type","has_polygon","geometry","geometry_type","external_link","extractGeoJSON","isValidGeometry","obj","geo","createFeature","incident","hasPolygonData","geometryType","SEVERITY_ORDER","getSeverityOrder","IncidentPolygonManager","_layers","_incidents","_incidentHashes","_knownEntityIds","_previousGeometries","_activeTransitions","_hashIncident","_animationsEnabled","animations_enabled","_getAnimationDuration","animation_duration","_geometryTransitionsEnabled","geometry_transitions","_getTransitionDurationMs","transition_duration","_hasGeometryChanged","newGeometry","oldGeometry","_interpolateCoordinates","from","to","maxLen","normalizedFrom","_resampleCoordinates","normalizedTo","fromPoint","toPoint","coords","targetLength","result","totalLength","frac","p1","p2","_interpolateGeometry","fromRings","toRings","maxRings","interpolatedRings","fromPolygons","toPolygons","maxPolygons","interpolatedPolygons","fromPoly","toPoly","_animateGeometryTransition","fromGeometry","toGeometry","existingTransition","cancelAnimationFrame","duration","performance","layer","currentTime","progress","pow","interpolatedGeometry","feature","clearLayers","addData","frameId","requestAnimationFrame","updatePolygonsForEntities","incidentsToRender","hasGeojson","hasGeometry","existingLayer","isNew","currentHash","previousHash","isUpdated","item","_updatePolygonLayer","getPolygonStyle","geometryChanged","previousGeometry","_applyAnimation","onEachFeature","_feat","lyr","_bindPopup","alertColor","alertLabel","_getAlertLabel","relativeTime","date","diffMs","diffMins","diffHours","diffDays","formatRelativeTime","typeInfo","_escapeHtml","timeInfo","adviceInfo","linkInfo","popupId","_getContrastColor","maxWidth","minWidth","div","hexColor","hex","parseInt","substring","animationType","eachLayer","sublayer","_applyAnimationToElement","setProperty","getPolygonBounds","getIncidentPositions","polygonCount","incidentCount","value","label","DARK_MODE_OPTIONS","ALERT_COLOR_PRESET_OPTIONS","ALERT_LEVEL_LABELS","ABCEmergencyMapCardEditor","setConfig","_valueChanged","_entityChanged","_renderSlider","_tileProviderChanged","stopPropagation","provider","nothing","_normalizeDarkMode","dark_mode","_darkModeChanged","option","_renderToggle","_renderOptionalSlider","marker_min_zoom","_renderNumberInputWithUnit","marker_polygon_threshold","_renderConfigWarnings","show_badge","_getEffectivePreset","_alertColorPresetChanged","_renderCustomColors","_getEffectiveColor","textColor","charAt","toUpperCase","_geoLocationSourcesChanged","description","configKey","_toggleChanged","_sliderChanged","displayValue","displayText","_optionalSliderChanged","warning","ev","numValue","_updateConfig","unit","step","_numberInputChanged","strValue","trim","detail","checked","customColors","_customColorChanged","_customColorTextChanged","_updateAlertColor","newConfig","event","CustomEvent","bubbles","composed","dispatchEvent","property","customElement","DEFAULT_CENTER","ABCEmergencyMapCard","_loadingState","_currentDarkMode","_previousMarkerCount","_previousMarkersVisible","prefix","info","_handleSkipLink","_renderMapContent","getElementById","focus","_errorMessage","_retryLoad","_handleMapKeydown","panAmount","panBy","zoomIn","zoomOut","_boundsManager","_markerManager","_zoneManager","_incidentManager","_changedProperties","_initializeMap","changedProperties","_checkThemeChange","_updateTileLayer","_updateMapData","newDarkMode","_isDarkMode","_currentTileConfig","_removeThemeListener","_cleanup","_addThemeListener","_boundThemeHandler","mapContainer","_getInitialCenter","zoomControl","attributionControl","_historyManager","_boundZoomHandler","_updateMarkerZoomVisibility","_setupResizeObserver","_handleResize","setting","_detectHADarkMode","themes","matchMedia","matches","themeName","theme","tileConfig","_tileLayer","tileLayer","_resizeObserver","disconnect","ResizeObserver","_resizeDebounce","observe","invalidateSize","off","minZoom","shouldShow","getZoom","_announceChange","_liveRegion","zoneData","getAllZones","allEntities","polygonThreshold","entitiesForMarkers","isPolygonGeometryType","newCount","toBBoxString","getCardSize","getConfigElement","getStubConfig","customCards","preview"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7]}